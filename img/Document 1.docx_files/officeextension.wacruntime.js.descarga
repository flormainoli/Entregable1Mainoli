var __extends=this&&this.__extends||function(){var a=function(c,b){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(c,a){for(var b in a)if(a.hasOwnProperty(b))c[b]=a[b]};return a(c,b)};return function(c,b){a(c,b);function d(){this.constructor=c}c.prototype=b===null?Object.create(b):(d.prototype=b.prototype,new d)}}(),OfficeExtension;(function(a){var b;(function(a){var b;(function(a){a[a.none=0]="none";a[a.restrictedResource=4]="restrictedResource";a[a.makerSafe=128]="makerSafe";a[a.excludedFromDefaultLoad=256]="excludedFromDefaultLoad";a[a.notNull=1024]="notNull";a[a.copilotSafe=4096]="copilotSafe"})(b=a.ApiFlags||(a.ApiFlags={}))})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function a(){}a.httpMethodGet="GET";a.httpMethodPost="POST";a.httpMethodPatch="PATCH";a.httpMethodDelete="DELETE";a.processQuery="ProcessQuery";a.actionId="ActionId";a.actionIndex="ActionIndex";a.actions="Actions";a.arrayTypeSufix="[]";a.code="Code";a.count="Count";a.error="Error";a.expand="Expand";a.getAsyncEnumeratorJsName="getAsyncEnumerator";a.getCount="GetCount";a.getItemAt="GetItemAt";a.getObjectByReferenceId="_GetObjectByReferenceId";a.getReferenceCount="_GetReferenceCount";a.id="Id";a.idLowerCase="id";a.idPrivate="_Id";a.idPrivateLowerCase="_id";a.index="_Index";a.isNull="_IsNull";a.items="_Items";a.keepReference="_KeepReference";a.location="Location";a.maxRecursiveQueryDepth=100;a.message="Message";a.nullableTypeSuffix="?";a.objectPathIdPrivate="_ObjectPathId";a.onAccess="_OnAccess";a.processedResults="ProcessedResults";a.referenceId="_ReferenceId";a.referenceIdLowerCase="_referenceid";a.removeAllReferences="_RemoveAllReferences";a.removeReference="_RemoveReference";a.results="Results";a.traceIds="TraceIds";a.value="Value";a.performanceMetadata="PerformanceMetadata";a.latency="Latency";return a}();a.Constants=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_eventIdControlMapByTarget={};this.m_richApiMessageEntriesByControl={};this.m_batchFireEventScheduled=false}b.prototype.initHost=function(a){this.m_host=a};b.prototype.register=function(c,d,e){d=this.normalizeTargetId(d);var b=this.m_eventIdControlMapByTarget[d];if(!b){b={};this.m_eventIdControlMapByTarget[d]=b}var a=b[e];if(!a){a={};b[e]=a}if(typeof a[c]==="undefined")a[c]=1;else a[c]=a[c]+1;if(a[c]===1)if(this.m_host)this.m_host.onRegisterRichApiEvent(d,e)};b.prototype.unregister=function(b,c,e){c=this.normalizeTargetId(c);var d=this.m_eventIdControlMapByTarget[c];if(d){var a=d[e];if(a)if(a[b]>0)if(a[b]===1){if(this.m_host)this.m_host.onUnregisterRichApiEvent(c,e);delete a[b]}else a[b]=a[b]-1}};b.prototype.isEventRegistered=function(a,d){a=this.normalizeTargetId(a);var b=this.m_eventIdControlMapByTarget[a];if(!b)return false;var c=b[d];if(!c)return false;for(var e in c)return true;return false};b.prototype.fireEvent=function(c,g,i){var j=this;c=this.normalizeTargetId(c);var d=this.m_eventIdControlMapByTarget[c];if(!d)return;var e=d[g];if(!e)return;for(var f in e){var a=this.m_richApiMessageEntriesByControl[f];if(!a){a=[];this.m_richApiMessageEntriesByControl[f]=a}var h=[b.s_richapiMessageCategoryEvent,g,c,JSON.stringify(i)];a.push(h)}if(!this.m_batchFireEventScheduled){this.m_batchFireEventScheduled=true;setTimeout(function(){j.batchFireEvent()},0)}};b.prototype.batchFireEvent=function(){this.m_batchFireEventScheduled=false;var a=this.m_richApiMessageEntriesByControl;this.m_richApiMessageEntriesByControl={};for(var b in a){var c=a[b];this.m_host&&this.m_host.sendRichApiMessageEventEntriesToControl(b,c)}};b.prototype.normalizeTargetId=function(b){return a.Utility.isNullOrUndefined(b)?"":b};b.s_richapiMessageCategoryEvent=65536;return b}();a.EventManager=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(b){var a=function(){function a(){}a.accessDenied="AccessDenied";a.apiNotFound="ApiNotFound";a.generalException="GeneralException";a.invalidArgument="InvalidArgument";a.invalidOperation="InvalidOperation";a.invalidRequest="InvalidRequest";return a}();b.ErrorCodes=a})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(b){this.m_context=b;this.m_requestMessage=JSON.parse(this.m_context.request.body);this.m_objectPaths={};this.m_perfLogger=new a.PerfLogger;this.m_resolvedObjects={};this.m_traceIds=[];this.m_objectPathIdToSafeForCellEditModeMap={}}b.prototype.process=function(){var c=this;this.m_context.response.writer.startObjectScope();this.m_context.response.writer.writeName(a.Constants.results);this.m_context.response.writer.startArrayScope();for(var b=a.Utility.createPromiseFromResult(null),e=this.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.RichApiExtendedLogging"),d=0;d<this.m_requestMessage.Actions.length;d++){var f=new a.JsonWriter,j=this.createProcessOneActionFunc(f,this.m_requestMessage.Actions[d],d);if(e){var g=this.startMark(this.m_requestMessage.Actions[d].Id.toString());b=b.then(g)}b=b.then(j);var i=this.createWriteActionWriterFunc(this.m_context.response.writer,f);b=b.then(i);if(e){var h=this.endMark(this.m_requestMessage.Actions[d].Id.toString());b=b.then(h)}}return b.then(function(){e&&c.writePerformanceMetrics();c.m_context.response.writer.endScope();c.writeTraceIds(c.m_context.response.writer);c.m_context.response.writer.endScope()})["catch"](function(a){e&&c.writePerformanceMetrics();c.processError(a)})};b.prototype.startMark=function(b){var c=this;return function(){return a.Utility.createPromiseFromResult(null).then(function(){c.m_perfLogger.startMark(b)})}};b.prototype.endMark=function(b){var c=this;return function(){return a.Utility.createPromiseFromResult(null).then(function(){c.m_perfLogger.endMark(b)})}};b.prototype.writePerformanceMetrics=function(){var c=this.m_perfLogger.getEntries();if(c.length===0)return;var b=this.m_context.response.writer;b.startObjectScope();b.writeName(a.Constants.performanceMetadata);b.startArrayScope();for(var d=0;d<c.length;d++){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(c[d].name);b.writeName(a.Constants.latency);b.writeValue(c[d].latency);b.endScope()}b.endScope();b.endScope();this.m_perfLogger.clear()};b.prototype.isChangeGateEnabled=function(b){if(window.OSF&&window.OSF.DisabledChangeGates){var a=window.OSF.DisabledChangeGates;return a.indexOf(b)===-1}return true};b.prototype.processError=function(f){var d=this.m_context.response.reset(),c=this.m_context.response.writer,e=a.UtilityInternal.convertToRichApiException(f);c.startObjectScope();c.writeName(a.Constants.error);b.writeError(c,e,this.m_currentActionIndex);this.writeTraceIds(c);if(!d.isEmpty){c.writeName(a.Constants.processedResults);c.writeRawValueFrom(d)}c.endScope();a.Logger.SendULSTraceTag(JSON.stringify(e),this.m_context.host.hostName(),50,35211328)};b.writeError=function(b,c,d){b.startObjectScope();b.writeName(a.Constants.code);b.writeValue(c.code);b.writeName(a.Constants.message);b.writeValue(c.message);if(!a.Utility.isNullOrEmptyString(c.location)){b.writeName(a.Constants.location);b.writeValue(c.location)}if(d>=0){b.writeName(a.Constants.actionIndex);b.writeValue(d)}b.endScope()};b.prototype.createProcessOneActionFunc=function(e,d,c){var b=this;return function(){return a.Utility.createPromiseFromResult(null).then(function(){b.m_currentActionIndex=c;return b.processOneAction(e,d)})}};b.prototype.createWriteActionWriterFunc=function(c,b){return function(){if(b.isEmpty)throw a.Utility.createInvalidOperationException();c.writeRawValueFrom(b)}};b.prototype.processOneAction=function(c,b){switch(b.ActionType){case 1:return this.processActionInstantiate(c,b);case 3:return this.processActionMethod(c,b);case 2:return this.processActionQuery(c,b);case 4:return this.processActionSetProperty(c,b);case 5:return this.procesActionTrace(c,b);case 6:return this.processActionRecursiveQuery(c,b);default:throw a.Utility.createInvalidOperationException();}};b.prototype.processActionInstantiate=function(b,c){var d=this;return this.getObjectFromObjectPathId(c.ObjectPathId).then(function(b){var a=d.shouldNotKeepReference(c.ObjectPathId);return d.invokeKeepReferenceIfNecessary(a,b)}).then(function(e){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(c.Id);b.writeName(a.Constants.value);if(e)return d.writeObjectBasicIds(b,e).then(function(){b.endScope()});else{b.writeValueNull();b.endScope()}})};b.prototype.writeObjectBasicIds=function(c,e){var f=this,d=this.m_context.typeReg.getType(e.getTypeName());c.startObjectScope();var b=a.Utility.createPromiseFromResult(null);b=b.then(function(){var b=d.tryGetProperty(a.Constants.id);if(b)return a.UtilityInternal.invokePropertyGetAsync(f.m_context,d,b,e).then(function(b){c.writeName(a.Constants.id);c.writeValue(b)})});b=b.then(function(){var b=d.tryGetProperty(a.Constants.idPrivate);if(b)return a.UtilityInternal.invokePropertyGetAsync(f.m_context,d,b,e).then(function(b){c.writeName(a.Constants.idPrivate);c.writeValue(b)})});b=b.then(function(){var b=d.tryGetProperty(a.Constants.referenceId);if(b)return a.UtilityInternal.invokePropertyGetAsync(f.m_context,d,b,e).then(function(b){if(typeof b=="string"&&!a.Utility.isNullOrEmptyString(b)){c.writeName(a.Constants.referenceId);c.writeValue(b)}})});b=b.then(function(){c.endScope()});return b};b.prototype.processActionMethod=function(b,d){var c=this;return this.getObjectFromObjectPathId(d.ObjectPathId).then(function(f){if(!f)c.writeActionNullObjectResult(b,d);else{var g=c.m_context.typeReg.getType(f.getTypeName()),e=g.getMethod(d.Name);return c.resolveMethodArguments(d.ArgumentInfo,e.parameters).then(function(h){return a.UtilityInternal.invokeMethodAsync(c.m_context,g,e,f,h).then(function(g){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(d.Id);b.writeName(a.Constants.value);var f=c.m_context.typeReg.tryGetType(e.returnTypeName);a.UtilityInternal.writeValue(b,c.m_context,f,g);b.endScope()})})}})};b.prototype.processActionQuery=function(b,c){var d=this;return this.getObjectFromObjectPathId(c.ObjectPathId).then(function(e){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(c.Id);b.writeName(a.Constants.value);if(e){var h=d.m_context.typeReg.getType(e.getTypeName()),f=new a.RESTfulQuery;f.init(c.QueryInfo.Select,c.QueryInfo.Expand,c.QueryInfo.Top,c.QueryInfo.Skip);var g=d.shouldNotKeepReference(c.ObjectPathId);return d.writeQueryResult(b,f,e,h,-1,null,1,g).then(function(){b.endScope()})}else{b.writeValueNull();b.endScope()}})};b.prototype.processActionRecursiveQuery=function(c,b){var e=this;if(a.Utility.isNullOrUndefined(b.RecursiveQueryInfo))throw a.Utility.createInvalidArgumentException("action.RecursiveQueryInfo");var f={};if(b.RecursiveQueryInfo.Queries)for(var g in b.RecursiveQueryInfo.Queries)f[g.toLowerCase()]=b.RecursiveQueryInfo.Queries[g];var d={Queries:f,MaxDepth:b.RecursiveQueryInfo.MaxDepth};if(a.Utility.isNullOrUndefined(d.MaxDepth))d.MaxDepth=a.Constants.maxRecursiveQueryDepth;if(d.MaxDepth<0||d.MaxDepth>a.Constants.maxRecursiveQueryDepth)throw a.Utility.createInvalidArgumentException("action.RecursiveQueryInfo.MaxDepth");return this.getObjectFromObjectPathId(b.ObjectPathId).then(function(f){c.startObjectScope();c.writeName(a.Constants.actionId);c.writeValue(b.Id);c.writeName(a.Constants.value);if(f){var g=e.m_context.typeReg.getType(f.getTypeName()),h=new a.RESTfulQuery;e.tryGetQueryForType(d,g,h);var i=e.shouldNotKeepReference(b.ObjectPathId);return e.writeQueryResult(c,h,f,g,-1,d,1,i).then(function(){c.endScope()})}else{c.writeValueNull();c.endScope()}})};b.prototype.processActionSetProperty=function(d,b){var c=this;return this.getObjectFromObjectPathId(b.ObjectPathId).then(function(e){if(e){var g=c.m_context.typeReg.getType(e.getTypeName()),f=g.getProperty(b.Name);return c.resolveMethodArguments(b.ArgumentInfo,f.parameters).then(function(b){return a.UtilityInternal.invokePropertySetAsync(c.m_context,g,f,e,b[0])}).then(function(){c.writeActionNullResult(d,b)})}else c.writeActionNullObjectResult(d,b)})};b.prototype.writeActionNullResult=function(b,c){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(c.Id);b.writeName(a.Constants.value);b.writeValueNull();b.endScope()};b.prototype.writeActionNullObjectResult=function(b,c){b.startObjectScope();b.writeName(a.Constants.actionId);b.writeValue(c.Id);b.writeName(a.Constants.value);b.startObjectScope();b.writeName(a.Constants.isNull);b.writeValue(true);b.endScope();b.endScope()};b.prototype.procesActionTrace=function(d,b){var c=this;return a.Utility.createPromiseFromResult(null).then(function(){c.m_traceIds.push(b.Id);c.writeActionNullResult(d,b)})};b.prototype.shouldNotKeepReference=function(a){return this.m_requestMessage.ObjectPaths[a].D};b.prototype.getObjectFromObjectPathId=function(b){var c=this,a=this.m_objectPaths[b];if(a)return a.then(function(a){return c.invokeOnAccess(a)});a=this.createObjectFromObjectPath(this.m_requestMessage.ObjectPaths[b]);a=a.then(function(a){c.m_resolvedObjects[b]=a;return a});this.m_objectPaths[b]=a;return a.then(function(a){return c.invokeOnAccess(a)})};b.prototype.getResolvedObjectFromObjectPathId=function(c){var b=this.m_resolvedObjects[c];if(a.Utility.isUndefined(b))throw a.Utility.createInvalidRequestException();return b};b.prototype.createObjectFromObjectPath=function(b){switch(b.ObjectPathType){case 1:return this.createObjectFromObjectPathGlobalObject(b);case 5:return this.createObjectFromObjectPathIndexer(b);case 3:return this.createObjectFromObjectPathMethod(b);case 2:return this.createObjectFromObjectPathNewObject(b);case 4:return this.createObjectFromObjectPathProperty(b);case 6:return this.createObjectFromObjectPathReferenceId(b);case 7:return a.Utility.createPromiseFromResult(null)}throw a.Utility.createInvalidOperationException();};b.prototype.createObjectFromObjectPathGlobalObject=function(){var b=this.m_context.request.globalObject;return a.Utility.createPromiseFromResult(b)};b.prototype.createObjectFromObjectPathIndexer=function(b){var c=this;return this.getObjectFromObjectPathId(b.ParentObjectPathId).then(function(d){if(!d)return null;var e=c.m_context.typeReg.getType(d.getTypeName()),f=e.getIndexerMethod();return a.UtilityInternal.invokeMethodAsync(c.m_context,e,f,d,b.ArgumentInfo.Arguments)})};b.prototype.createObjectFromObjectPathMethod=function(b){var c=this;return this.getObjectFromObjectPathId(b.ParentObjectPathId).then(function(d){if(!d)return null;var e=c.m_context.typeReg.getType(d.getTypeName()),f=e.getMethod(b.Name);return c.resolveMethodArguments(b.ArgumentInfo,f.parameters).then(function(b){return a.UtilityInternal.invokeMethodAsync(c.m_context,e,f,d,b)})})};b.prototype.createObjectFromObjectPathNewObject=function(b){var d=b.Name,c=this.m_context.typeReg.getType(d),e=a.UtilityInternal.createObject(this.m_context,c);return a.Utility.createPromiseFromResult(e)};b.prototype.createObjectFromObjectPathProperty=function(b){var c=this;return this.getObjectFromObjectPathId(b.ParentObjectPathId).then(function(d){if(!d)return null;var e=c.m_context.typeReg.getType(d.getTypeName()),f=e.getProperty(b.Name);return a.UtilityInternal.invokePropertyGetAsync(c.m_context,e,f,d)})};b.prototype.createObjectFromObjectPathReferenceId=function(e){var d=e.Name,b=this.m_context.typeReg.getType(this.m_context.request.globalObject.getTypeName()),c=b.getMethod(a.Constants.getObjectByReferenceId);return a.UtilityInternal.invokeMethodAsync(this.m_context,b,c,this.m_context.request.globalObject,[d])};b.prototype.resolveMethodArguments=function(f,d){for(var c=[],b=0;b<d.length&&b<f.Arguments.length;b++)c.push(f.Arguments[b]);for(var b=0;b<d.length&&b<c.length;b++){var h=this.m_context.typeReg.tryGetType(d[b].parameterTypeName);if(!a.Utility.isNullOrEmptyString(d[b].fallbackComplexTypeName)){var i=this.m_context.typeReg.getType(d[b].fallbackComplexTypeName);c[b]=this.resolveComplexTypeIfNecessary(c[b],i)}else if(d[b].parameterTypeName.indexOf("DateTime")>=0)c[b]=this.convertStringValueToDateValue(c[b]);else if(h)c[b]=this.resolveEnumIntValueIfHasEnumType(c[b],h)}var g=a.Utility.createPromiseFromResult(null);if(f.ReferencedObjectPathIds){for(var e=[],b=0;b<c.length;b++)this.collectObjectPathIdInfos(e,[b],c[b],f.ReferencedObjectPathIds[b]);for(var b=0;b<e.length;b++){var j=this.createGetObjectFromObjectPathIdAndStoreParameterArgFunc(e[b].objectPathId,c,e[b].indices);g=g.then(j)}}return g.then(function(){return a.Utility.createPromiseFromResult(c)})};b.prototype.convertStringValueToDateValue=function(c){if(a.Utility.isNullOrUndefined(c))return null;if(typeof c==="string"){if(!b.s_regexISODate.test(c))throw a.Utility.createInvalidArgumentException("value");var f=Date.parse(c);if(a.Utility.isNullOrUndefined(f))throw a.Utility.createInvalidArgumentException("value");return new Date(f)}if(Array.isArray(c)){for(var d=c,e=0;e<d.length;e++)d[e]=this.convertStringValueToDateValue(d[e]);return d}return c};b.prototype.resolveComplexTypeIfNecessary=function(d,e){if(Array.isArray(d)){for(var f=d,g=0;g<f.length;g++)f[g]=this.resolveComplexTypeIfNecessary(f[g],e);return f}if(typeof d=="object"){var j=a.UtilityInternal.createObject(this.m_context,e);for(var i in d){var c=e.tryGetProperty(i);if(c&&!c.isReadonly){var b=d[i],h=this.m_context.typeReg.tryGetType(c.propertyTypeName);if(!a.Utility.isNullOrEmptyString(c.fallbackComplexTypeName)){var k=this.m_context.typeReg.getType(c.fallbackComplexTypeName);b=this.resolveComplexTypeIfNecessary(b,k)}else if(typeof b==="object"&&b&&typeof b[a.Constants.objectPathIdPrivate]==="number"&&b[a.Constants.objectPathIdPrivate]>0)b=this.getResolvedObjectFromObjectPathId(b[a.Constants.objectPathIdPrivate]);else if(h)b=this.resolveEnumIntValueIfHasEnumType(b,h);a.UtilityInternal.invokePropertySet(this.m_context,e,c,j,b,false)}}return j}return d};b.prototype.resolveEnumIntValueIfHasEnumType=function(a,b){if(Array.isArray(a)&&b.arrayItemTypeInfo)for(var d=a,c=0;c<d.length;c++)d[c]=this.resolveEnumIntValueIfHasEnumType(d[c],b.arrayItemTypeInfo);else if(b.isEnum&&typeof a==="string")a=b.getEnumFieldValue(a);return a};b.prototype.collectObjectPathIdInfos=function(g,d,e,a){if(Array.isArray(a)&&Array.isArray(e))for(var i=a,h=e,b=0;b<h.length;b++){for(var c=[],f=0;f<d.length;f++)c.push(d[f]);c.push(b);this.collectObjectPathIdInfos(g,c,h[b],i[b])}else a>0&&a===e&&g.push({objectPathId:a,indices:d})};b.prototype.createGetObjectFromObjectPathIdAndStoreParameterArgFunc=function(b,d,a){var c=this;return function(){return c.getObjectFromObjectPathId(b).then(function(e){for(var b=d,c=0;c<a.length-1;c++)b=b[a[c]];b[a[a.length-1]]=e})}};b.prototype.writeTraceIds=function(b){if(this.m_traceIds.length>0){b.writeName(a.Constants.traceIds);b.startArrayScope();for(var c=0;c<this.m_traceIds.length;c++)b.writeValue(this.m_traceIds[c]);b.endScope()}};b.prototype.tryGetQueryForType=function(e,c,f){var d=a.UtilityInternal.getShortTypeName(c.name).toLowerCase(),b=e.Queries[d];if(a.Utility.isNullOrUndefined(b))if(!a.Utility.isNullOrEmptyString(c.childItemTypeName)){d=a.UtilityInternal.getShortTypeName(c.childItemTypeName).toLowerCase();b=e.Queries[d]}if(b){f.init(b.Select,b.Expand,b.Top,b.Skip);return true}return false};b.prototype.writeQueryResult=function(c,g,f,d,l,h,j,i){var e=this;c.startObjectScope();if(l>=0){c.writeName(a.Constants.index);c.writeValue(l)}var b=a.Utility.createPromiseFromResult(null);b=b.then(function(){return e.invokeKeepReferenceIfNecessary(i,f)});var k=d.tryGetItemAtMethod();if(d.supportEnumeration){b=b.then(function(){return e.writeScalarProperties(c,g,f,d,true)});b=b.then(function(){return e.writeChildItemsUsingEnumerator(c,g,f,d,h,j,i)})}else if(k){b=b.then(function(){return e.writeScalarProperties(c,g,f,d,true)});b=b.then(function(){return e.writeChildItemsUsingGetItemAt(c,g,f,d,k,h,j,i)})}else{b=b.then(function(){return e.writeScalarProperties(c,g,f,d,false)});if(h===null||j<h.MaxDepth)b=b.then(function(){return e.writeNavigationProperties(c,g,d,f,h,j+1,i)})}return b.then(function(){c.endScope()})};b.prototype.writeScalarProperties=function(g,h,k,c,e){var d=a.Utility.createPromiseFromResult(null);for(var j in c.properties){var b=c.properties[j];if(b.propertyTypeCategory==a.TypeCategory.primitive||b.propertyTypeCategory==a.TypeCategory.valueObject)if(e||h.shouldSelectProperty(b.lowerCaseName,b.excludedFromDefaultLoad)){var f=this.m_context.typeReg.tryGetType(b.propertyTypeName),i=this.createWriteScalarOnePropertyFunc(g,c,b,k,f);d=d.then(i)}}return d};b.prototype.createWriteScalarOnePropertyFunc=function(c,f,b,g,e){var d=this;return function(){return a.UtilityInternal.invokePropertyGetAsync(d.m_context,f,b,g).then(function(f){c.writeName(b.name);a.UtilityInternal.writeValue(c,d.m_context,e,f)})}};b.prototype.writeNavigationProperties=function(k,f,e,n,d,j,i){var g=a.Utility.createPromiseFromResult(null);for(var m in e.properties){var b=e.properties[m];if(b.propertyTypeCategory==a.TypeCategory.classObject)if(f.shouldExpandProperty(b.lowerCaseName)){var h=this.m_context.typeReg.getType(b.propertyTypeName),c;if(d){c=new a.RESTfulQuery;if(!this.tryGetQueryForType(d,h,c))c=f.createQueryForProperty(b.lowerCaseName)}else c=f.createQueryForProperty(b.lowerCaseName);var l=this.createWiteNavigationOnePropertyFunc(k,e,b,n,c,h,d,j,i);g=g.then(l)}}return g};b.prototype.createWiteNavigationOnePropertyFunc=function(b,j,c,k,i,h,f,g,e){var d=this;return function(){return a.UtilityInternal.invokePropertyGetAsync(d.m_context,j,c,k).then(function(j){b.writeName(c.name);if(a.Utility.isNullOrUndefined(j))b.writeValueNull();else return d.writeQueryResult(b,i,j,h,-1,f,g,e)})}};b.prototype.writeChildItemsUsingEnumerator=function(b,c,k,g,i,j,h){var f=this,d=0;if(c.skip>0)d=c.skip;var e=0;if(c.top>0)e=c.top;return a.UtilityInternal.invokeGetAsyncEnumerator(this.m_context,g,k,d,e).then(function(o){var m=f.m_context.typeReg.getType(g.childItemTypeName),n=d,l=0;if(e>0)l=d+e;b.writeName(a.Constants.items);b.startArrayScope();var k=f.enumeratorLoop(o,n,l,function(d,e){if(a.Utility.isNullOrUndefined(d)){b.writeValueNull();return a.Utility.createPromiseFromResult(null)}else return f.writeQueryResult(b,c,d,m,e,i,j,h)});k=k.then(function(){b.endScope()});return k})};b.prototype.enumeratorLoop=function(d,b,c,e){var f=this;return c===0||b<c?d.moveNext().then(function(g){return g?e(d.get_current(),b).then(function(){return f.enumeratorLoop(d,b+1,c,e)}):a.Utility.createPromiseFromResult(null)}):a.Utility.createPromiseFromResult(null)};b.prototype.writeChildItemsUsingGetItemAt=function(c,d,g,b,i,l,m,k){var j=this,n=this.m_context.typeReg.getType(i.returnTypeName),e=b.tryGetProperty(a.Constants.count),h=b.tryGetMethod(a.Constants.getCount);if(!e&&!h)return a.Utility.createPromiseFromResult(null);var f;if(e)f=a.UtilityInternal.invokePropertyGetAsync(this.m_context,b,e,g);else f=a.UtilityInternal.invokeMethodAsync(this.m_context,b,h,g,[]);return f.then(function(f){var h=0;if(d.skip>0)h=d.skip;var e=f;if(d.top>0){e=h+d.top;if(e>f)e=f}c.writeName(a.Constants.items);c.startArrayScope();return j.getItemAtLoop(b,i,g,h,e,function(b,e){if(a.Utility.isNullOrUndefined(b)){c.writeValueNull();return a.Utility.createPromiseFromResult(null)}else return j.writeQueryResult(c,d,b,n,e,l,m,k)}).then(function(){c.endScope()})})};b.prototype.getItemAtLoop=function(d,c,g,b,f,e){var h=this;return b<f?a.UtilityInternal.invokeMethodAsync(this.m_context,d,c,g,[b]).then(function(a){return e(a,b)}).then(function(){return h.getItemAtLoop(d,c,g,b+1,f,e)}):a.Utility.createPromiseFromResult(null)};b.prototype.invokeOnAccess=function(b){if(b){var d=this.m_context.typeReg.getType(b.getTypeName()),c=d.tryGetMethod(a.Constants.onAccess);if(c)return a.UtilityInternal.invokeMethodAsync(this.m_context,d,c,b,[]).then(function(){return b})}return a.Utility.createPromiseFromResult(b)};b.prototype.invokeKeepReferenceIfNecessary=function(e,b){if(!e&&b&&b!==this.m_context.request.globalObject&&this.m_requestMessage.AutoKeepReference){var d=this.m_context.typeReg.getType(b.getTypeName()),c=d.tryGetMethod(a.Constants.keepReference);if(c)return a.UtilityInternal.invokeMethodAsync(this.m_context,d,c,b,[]).then(function(){return b})}return a.Utility.createPromiseFromResult(b)};b.prototype.preProcessIsSafeForCellEditMode=function(){if(this.m_requestMessage&&this.m_requestMessage.Actions)for(var a=0;a<this.m_requestMessage.Actions.length;a++)if(!this.isSafeForCellEditModeAction(this.m_requestMessage.Actions[a]))return false;return true};b.prototype.isSafeForCellEditModeAction=function(a){switch(a.ActionType){case 5:return true;case 1:return this.isGlobalObject(a.ObjectPathId)||this.isSafeForCellEditModeObjectPath(a.ObjectPathId);case 2:case 4:case 6:case 7:case 8:case 9:return this.isSafeForCellEditModeObjectPath(a.ObjectPathId);case 3:return this.isSafeForCellEditModeObjectPath(a.ObjectPathId)||this.isSafeForCellEditModeGlobalObjectMethod(a.ObjectPathId,a.Name);default:return false}};b.prototype.isGlobalObject=function(b){if(b in this.m_requestMessage.ObjectPaths){var d=this.m_requestMessage.ObjectPaths[b];return d.ObjectPathType===1}var c=new a.RichApiException(a.ErrorCodes.invalidArgument,a.Utility.getLocalizedString(a.ResourceStrings.invalidArgument,"objectPath"));c.location="isGlobalObject";throw c;};b.prototype.isSafeForCellEditModeObjectPath=function(c){if(c in this.m_objectPathIdToSafeForCellEditModeMap)return this.m_objectPathIdToSafeForCellEditModeMap[c];var d=false;if(c in this.m_requestMessage.ObjectPaths){var b=this.m_requestMessage.ObjectPaths[c];if(b.ObjectPathType===2){var f=b.Name;if(this.m_context.typeReg.getType(f).typeFlags&a.TypeFlags.safeForCellEditMode)d=true}else if(b.ObjectPathType===7)d=true;else if(b.ParentObjectPathId>0)d=this.isSafeForCellEditModeObjectPath(b.ParentObjectPathId);this.m_objectPathIdToSafeForCellEditModeMap[c]=d;return d}var e=new a.RichApiException(a.ErrorCodes.invalidArgument,a.Utility.getLocalizedString(a.ResourceStrings.invalidArgument,"objectPath"));e.location="isSafeForCellEditModeObjectPath";throw e;};b.prototype.isSafeForCellEditModeGlobalObjectMethod=function(c,b){return this.isGlobalObject(c)?b===a.Constants.removeReference||b===a.Constants.removeAllReferences||b===a.Constants.getReferenceCount:false};b.s_regexISODate=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/;return b}();a.JsComRequestProcessor=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_scopes=[]}b.prototype.startScope=function(c){var b;if(c==0)b={scopeType:c,object:{}};else b={scopeType:c,object:[]};if(this.m_scopes.length>0){var d=b.object;if(this.m_scopes[this.m_scopes.length-1].scopeType==1)this.m_scopes[this.m_scopes.length-1].object.push(d);else{if(a.Utility.isNullOrEmptyString(this.m_pendingPropertyName))throw a.Utility.createInvalidOperationException();this.m_scopes[this.m_scopes.length-1].object[this.m_pendingPropertyName]=d;this.m_pendingPropertyName=null}}this.m_scopes.push(b);if(a.Utility.isNullOrUndefined(this.m_firstScope))this.m_firstScope=b};b.prototype.endScope=function(){this.m_scopes.splice(this.m_scopes.length-1)};b.prototype.startArrayScope=function(){this.startScope(1)};b.prototype.startObjectScope=function(){this.startScope(0)};b.prototype.writeName=function(b){if(this.m_scopes.length<1||this.m_scopes[this.m_scopes.length-1].scopeType!=0)throw a.Utility.createInvalidOperationException();if(!a.Utility.isNullOrEmptyString(this.m_pendingPropertyName))throw a.Utility.createInvalidOperationException();this.m_pendingPropertyName=b};b.prototype.writeValue=function(b){if(a.Utility.isNullOrUndefined(b))b=null;if(this.m_scopes.length<1)throw a.Utility.createInvalidOperationException();if(this.m_scopes[this.m_scopes.length-1].scopeType==1)this.m_scopes[this.m_scopes.length-1].object.push(b);else{if(a.Utility.isNullOrEmptyString(this.m_pendingPropertyName))throw a.Utility.createInvalidOperationException();this.m_scopes[this.m_scopes.length-1].object[this.m_pendingPropertyName]=b;this.m_pendingPropertyName=null}};b.prototype.writeValueNull=function(){this.writeValue(null)};b.prototype.writeRawValueFrom=function(a){this.writeValue(a.m_firstScope.object)};b.prototype.getJsonString=function(){return this.m_firstScope?JSON.stringify(this.m_firstScope.object):""};Object.defineProperty(b.prototype,"isEmpty",{"get":function(){return this.m_firstScope?false:true},enumerable:true,configurable:true});return b}();a.JsonWriter=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(d,b,g,e,c,f,h){this.m_name=b;this.m_dispatchId=g;this.m_returnTypeName=e;this.m_returnTypeCategory=c;this.m_operationType=f;this.m_parameters=[];this.m_apiName=a.UtilityInternal.getApiName(d,b);this.m_apiFlags=h}Object.defineProperty(b.prototype,"name",{"get":function(){return this.m_name},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"returnTypeCategory",{"get":function(){return this.m_returnTypeCategory},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"returnTypeName",{"get":function(){return this.m_returnTypeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"dispatchId",{"get":function(){return this.m_dispatchId},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"methodOperationType",{"get":function(){return this.m_operationType},enumerable:true,configurable:true});b.prototype.addParameter=function(g,d,c,e,f){var b=new a.ParameterInformation(g,d,c,e,f);this.m_parameters.push(b);return b};Object.defineProperty(b.prototype,"parameters",{"get":function(){return this.m_parameters},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"apiName",{"get":function(){return this.m_apiName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"apiFlags",{"get":function(){return this.m_apiFlags},enumerable:true,configurable:true});return b}();a.MethodInformation=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b;(function(a){a[a.defaultValue=0]="defaultValue";a[a.read=1]="read"})(b=a.OperationType||(a.OperationType={}))})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(f,c,e,d,b){this.m_name=f;this.m_typeName=c;this.m_typeCategory=e;if(a.Utility.isNullOrUndefined(b))b=a.ApiFlags.none;this.m_apiFlags=b;if(this.m_typeCategory===a.TypeCategory.primitive)this.m_fallbackComplexTypeName=d;else if(this.m_typeCategory===a.TypeCategory.valueObject)this.m_fallbackComplexTypeName=a.UtilityInternal.getTypeNameWithoutArraySuffix(c)}Object.defineProperty(b.prototype,"name",{"get":function(){return this.m_name},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"parameterTypeName",{"get":function(){return this.m_typeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"parameterTypeCategory",{"get":function(){return this.m_typeCategory},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"fallbackComplexTypeName",{"get":function(){return this.m_fallbackComplexTypeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"apiFlags",{"get":function(){return this.m_apiFlags},enumerable:true,configurable:true});return b}();a.ParameterInformation=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(b){var a=function(){function a(){this.m_active={};this.m_entries=[]}a.prototype.startMark=function(a){var b=this.getTimestamp();this.m_active[a]={name:a,start:b}};a.prototype.endMark=function(b){var a=this.m_active[b];if(!a)return;var c=this.getTimestamp();a.end=c;a.latency=c-a.start;this.m_entries.push(a);delete this.m_active[b]};a.prototype.getEntries=function(){return this.m_entries.slice()};a.prototype.clear=function(){this.m_active={};this.m_entries=[]};a.prototype.getTimestamp=function(){return typeof performance!=="undefined"&&typeof performance.now==="function"?performance.now():Date.now()};return a}();b.PerfLogger=a})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_maps={}}b.prototype.add=function(b,c,d){var a=this.m_maps[b];if(!a){a={};this.m_maps[b]=a}a[c]=d};b.prototype.get=function(e,d){var b=this.m_maps[e];if(!b)throw a.Utility.createInvalidRequestException();var c=b[d];if(!c)throw a.Utility.createInvalidRequestException();return c};return b}();a.PreviewExecutionRegistration=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(f,e,d){this.m_context=f;this.m_request=new a.RichApiRequest;this.m_request.init(d,null);if(this.m_request.requestType==0){var c=JSON.parse(this.m_request.body);this.m_previewExecutionActions=c.PreviewExecutionActions;delete c.PreviewExecutionActions;d[4]=JSON.stringify(c)}if(!b.s_registration){b.s_registration=new a.PreviewExecutionRegistration;e(b.s_registration)}}b.prototype.process=function(){var d=a.Utility.createPromiseFromResult(null);if(this.m_request.requestType!=0)return d;if(!this.m_previewExecutionActions)return d;for(var f=0;f<this.m_previewExecutionActions.length;f++){var c=this.m_previewExecutionActions[f],e=c.ObjectId;if(typeof e==="number")e=e.toString();if(c.ActionType===3){var g=b.s_registration.get(c.ObjectType,c.Name),h=[this.m_context,c.ObjectId].concat(c.Arguments);d=d.then(function(){return g.apply(null,h)})}else if(c.ActionType===4){var g=b.s_registration.get(c.ObjectType,"Set"+c.Name),h=[this.m_context,c.ObjectId].concat(c.Arguments);d=d.then(function(){return g.apply(null,h)})}}return d};return b}();a.PreviewExecutor=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(g,b,h,c,d,i,e,f){this.m_name=b;this.m_dispatchId=h;this.m_propertyTypeName=c;this.m_propertyTypeCategory=d;this.m_isReadonly=i;this.m_parameters=[];this.m_parameters.push(new a.ParameterInformation("value",c,d,e,f));this.m_apiName=a.UtilityInternal.getApiName(g,b);this.m_lowerCaseName=b.toLowerCase();this.m_camelLowerCaseName=a.UtilityInternal.toCamelLowerCase(b);if(this.m_propertyTypeCategory===a.TypeCategory.primitive)this.m_fallbackComplexTypeName=e;else if(this.m_propertyTypeCategory===a.TypeCategory.valueObject)this.m_fallbackComplexTypeName=a.UtilityInternal.getTypeNameWithoutArraySuffix(c);this.m_apiFlags=f}Object.defineProperty(b.prototype,"name",{"get":function(){return this.m_name},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"lowerCaseName",{"get":function(){return this.m_lowerCaseName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"camelLowerCaseName",{"get":function(){return this.m_camelLowerCaseName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"propertyTypeCategory",{"get":function(){return this.m_propertyTypeCategory},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"propertyTypeName",{"get":function(){return this.m_propertyTypeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"isReadonly",{"get":function(){return this.m_isReadonly},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"fallbackComplexTypeName",{"get":function(){return this.m_fallbackComplexTypeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"dispatchId",{"get":function(){return this.m_dispatchId},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"parameters",{"get":function(){return this.m_parameters},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"apiName",{"get":function(){return this.m_apiName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"apiFlags",{"get":function(){return this.m_apiFlags},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"excludedFromDefaultLoad",{"get":function(){return(this.m_apiFlags&a.ApiFlags.excludedFromDefaultLoad)!==0},enumerable:true,configurable:true});return b}();a.PropertyInformation=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(b){var a=function(){function a(){}a.accessDenied="AccessDenied";a.apiNotFound="ApiNotFound";a.invalidArgument="InvalidArgument";a.invalidOperation="InvalidOperation";a.invalidRequest="InvalidRequest";return a}();b.ResourceStrings=a})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_select=new a.SelectExpandQuery;this.m_expand=new a.SelectExpandQuery;this.m_top=0;this.m_skip=0}Object.defineProperty(b.prototype,"top",{"get":function(){return this.m_top},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"skip",{"get":function(){return this.m_skip},enumerable:true,configurable:true});b.prototype.init=function(b,a,d,c){this.m_select.init(true,b);this.m_expand.init(false,a);this.m_top=d;this.m_skip=c};b.prototype.shouldSelectProperty=function(b,c){return(this.m_select.isEmpty||this.m_select.hasWildcard)&&!c?true:this.m_select.properties[b]?true:this.m_expand.properties[b]?true:b==a.Constants.idLowerCase||b==a.Constants.idPrivateLowerCase||b==a.Constants.referenceIdLowerCase?true:false};b.prototype.shouldExpandProperty=function(a){return this.shouldSelectProperty(a,false)&&(this.m_expand.properties[a]||this.m_select.properties[a])?true:false};b.prototype.createQueryForProperty=function(a){var c=new b;if(this.m_select.properties[a])c.m_select=this.m_select.properties[a];if(this.m_expand.properties[a])c.m_expand=this.m_expand.properties[a];return c};return b}();a.RESTfulQuery=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){}b.ensureTypeRegistration=function(d){if(!b.s_typeReg){var c=new a.TypeRegistration;d&&d(c);c.addAuxEnumTypes();b.s_typeReg=c}};b.initializeCopilotUnsafeApiList=function(a){if(!b.s_copilotUnsafeApiList&&a&&a.length>0)b.s_copilotUnsafeApiList=a.split(";").map(function(a){return a.trim()})};b.isCopilotUnsafeApi=function(a){return b.s_copilotUnsafeApiList?b.s_copilotUnsafeApiList.indexOf(a)>=0:false};b.preProcessIsSafeForCellEditMode=function(e,g){b.ensureTypeRegistration(e);var c=new a.RichApiRequestContext(b.s_typeReg,null);c.request.init(g,null);var d=false;try{if(c.request.requestType===0){var f=new a.JsComRequestProcessor(c);d=f.preProcessIsSafeForCellEditMode()}}catch(h){d=false}return d};b.executeRichApiRequest=function(f,g,e,i){b.ensureTypeRegistration(g);var c=new a.RichApiRequestContext(b.s_typeReg,f);c.request.init(i,e);var d=a.Utility.createPromiseFromResult(null);if(c.request.requestType==0){var h=new a.JsComRequestProcessor(c);d=h.process()}return d.then(function(){return a.Utility.createPromiseFromResult(c.response.toArrayData())})};b.initEventManagerHost=function(c){if(!b.s_eventManager)b.s_eventManager=new a.EventManager;b.s_eventManager.initHost(c)};b.getEventManager=function(){if(!b.s_eventManager)b.s_eventManager=new a.EventManager;return b.s_eventManager};b.previewExecute=function(d,b,e){var c=new a.PreviewExecutor(d,b,e);return c.process()};b.s_copilotUnsafeApiList=null;return b}();a.RichApi=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(b){var a=function(b){__extends(a,b);function a(g,d,e,f){var c=b.call(this,d)||this;Object.setPrototypeOf(c,a.prototype);c.name="OfficeExtension.WacRuntime.RichApiException";c.code=g;c.message=d;c.httpStatusCode=e;c.location=f;return c}return a}(Error);b.RichApiException=a})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){}b.prototype.init=function(c,e){this.m_globalObject=e;this.m_method=c[1];var b=c[2],d=b.indexOf("?");if(d>=0){this.m_path=b.substr(0,d);this.m_query=b.substr(d+1)}else{this.m_path=b;this.m_query=""}if(this.m_method==a.Constants.httpMethodPost&&this.m_path==a.Constants.processQuery)this.m_requestType=0;else this.m_requestType=1;this.m_body=c[4];this.m_requestFlags=c[6]};Object.defineProperty(b.prototype,"requestType",{"get":function(){return this.m_requestType},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"method",{"get":function(){return this.m_method},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"path",{"get":function(){return this.m_path},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"query",{"get":function(){return this.m_query},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"body",{"get":function(){return this.m_body},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"requestFlags",{"get":function(){return this.m_requestFlags},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"globalObject",{"get":function(){return this.m_globalObject},enumerable:true,configurable:true});return b}();a.RichApiRequest=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var c=function(){function b(){}b.prototype.hostName=function(){return""};b.prototype.appId=function(){return""};b.prototype.createInstance=function(){throw a.Utility.createInvalidRequestException();};return b}(),b=function(){function b(d,b){this.m_typeReg=d;this.m_request=new a.RichApiRequest;this.m_response=new a.RichApiResponse;if(!b)b=new c;this.m_richApiHost=b}Object.defineProperty(b.prototype,"request",{"get":function(){return this.m_request},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"response",{"get":function(){return this.m_response},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"typeReg",{"get":function(){return this.m_typeReg},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"host",{"get":function(){return this.m_richApiHost},enumerable:true,configurable:true});return b}();a.RichApiRequestContext=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b;(function(a){a[a.None=0]="None";a[a.WriteOperation=1]="WriteOperation";a[a.RestrictedResourceAccess=2]="RestrictedResourceAccess";a[a.Concurrent=4]="Concurrent";a[a.ConcurrentCheck=8]="ConcurrentCheck";a[a.Undoable=16]="Undoable";a[a.UndoableCheck=32]="UndoableCheck";a[a.DelayForCellEdit=64]="DelayForCellEdit";a[a.UndoPreviewEnabled=128]="UndoPreviewEnabled";a[a.DoesNotMakeContentDirty=256]="DoesNotMakeContentDirty";a[a.OnlyAllowCallableWithoutPermissionApi=512]="OnlyAllowCallableWithoutPermissionApi";a[a.OnlyAllowMakerSafeApi=1024]="OnlyAllowMakerSafeApi";a[a.DonotShowSavingState=2048]="DonotShowSavingState";a[a.PreviewExecution=4096]="PreviewExecution";a[a.AllowImmediateExecution=8192]="AllowImmediateExecution";a[a.SetInvocationResultsOperation=16384]="SetInvocationResultsOperation";a[a.OnlyAllowCopilotSafeApi=32768]="OnlyAllowCopilotSafeApi"})(b=a.RichApiRequestFlags||(a.RichApiRequestFlags={}))})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_writer=new a.JsonWriter}b.prototype.reset=function(){var b=this.m_writer;this.m_writer=new a.JsonWriter;return b};Object.defineProperty(b.prototype,"writer",{"get":function(){return this.m_writer},enumerable:true,configurable:true});b.prototype.toArrayData=function(){var a=[];a[0]=200;a[1]=null;a[2]=this.m_writer.getJsonString();return a};return b}();a.RichApiResponse=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_hasWildcard=false;this.m_properties={}}Object.defineProperty(b.prototype,"hasWildcard",{"get":function(){return this.m_hasWildcard},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"isEmpty",{"get":function(){var a=true;for(var b in this.m_properties){a=false;break}return a},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"properties",{"get":function(){return this.m_properties},enumerable:true,configurable:true});b.prototype.init=function(j,f){if(f)for(var g=0;g<f.length;g++)for(var d=this,i=f[g].split("/"),h=0;h<i.length;h++){var c=i[h];c=c.trim().toLowerCase();if(c=="*"){if(!j)throw a.Utility.createInvalidRequestException();d.m_hasWildcard=true}else{var e=d.m_properties[c];if(!e){e=new b;d.m_properties[c]=e}d=e}}};return b}();a.SelectExpandQuery=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function a(){}return a}();a.Settings=b;a.settings=new b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function a(){}a.SendULSTraceTag=function(e,b,c,d){if(!window.Microsoft||!Microsoft.Office||!Microsoft.Office.WebExtension||!Microsoft.Office.WebExtension.FULSSupported)return;var a=1403;if(b=="WordOnline")a=369;else if(b=="OneNoteOnline")a=372;else return;window.Diag&&Diag.UULS&&Diag.UULS.trace&&Diag.UULS.trace(d,a,c,e)};return a}();a.Logger=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b;(function(a){a[a.none=0]="none";a[a.primitive=1]="primitive";a[a.valueObject=2]="valueObject";a[a.classObject=3]="classObject"})(b=a.TypeCategory||(a.TypeCategory={}))})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b;(function(a){a[a.none=0]="none";a[a.useItemAsIndexerNameInODataId=1]="useItemAsIndexerNameInODataId";a[a.restrictedResource=2]="restrictedResource";a[a.propertySetUndoable=4]="propertySetUndoable";a[a.shouldSkipUndefinedProperties=8]="shouldSkipUndefinedProperties";a[a.safeForCellEditMode=16]="safeForCellEditMode";a[a.propertySetDoesNotMakeContentDirty=32]="propertySetDoesNotMakeContentDirty";a[a.makerSafe=64]="makerSafe";a[a.doPostProcessAfterPatch=128]="doPostProcessAfterPatch";a[a.copilotSafe=256]="copilotSafe"})(b=a.TypeFlags||(a.TypeFlags={}))})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(g,d,e,f,b,c){this.m_name=g;this.m_interfaceId=d;this.m_classId=e;this.m_properties={};this.m_methods={};this.m_enumFields={};this.m_enumFieldLowerCaseNameToValue={};this.m_enumFieldValueToName={};this.m_isEnum=f;if(a.Utility.isNullOrUndefined(b))b=a.TypeCategory.classObject;this.m_typeCategory=b;if(a.Utility.isNullOrUndefined(c))c=a.TypeFlags.none;this.m_typeFlags=c}Object.defineProperty(b.prototype,"name",{"get":function(){return this.m_name},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"isEnum",{"get":function(){return this.m_isEnum},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"isNullableEnum",{"get":function(){return this.m_isNullableEnum},"set":function(a){this.m_isNullableEnum=a},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"classId",{"get":function(){return this.m_classId},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"interfaceId",{"get":function(){return this.m_interfaceId},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"typeCategory",{"get":function(){return this.m_typeCategory},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"typeFlags",{"get":function(){return this.m_typeFlags},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"properties",{"get":function(){return this.m_properties},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"supportEnumeration",{"get":function(){return this.m_supportEnumeration},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"childItemTypeName",{"get":function(){return this.m_childItemTypeName},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"enumFields",{"get":function(){return this.m_enumFields},enumerable:true,configurable:true});Object.defineProperty(b.prototype,"arrayItemTypeInfo",{"get":function(){return this.m_arrayItemTypeInfo},"set":function(a){this.m_arrayItemTypeInfo=a},enumerable:true,configurable:true});b.prototype.addProperty=function(b,g,d,f,h,e,i){var c=new a.PropertyInformation(this.m_name,b,g,d,f,h,e,i);this.m_properties[b.toLowerCase()]=c;return c};b.prototype.addMethod=function(c,g,e,d,f,i,h){var b=new a.MethodInformation(this.m_name,c,g,e,d,f,h);this.m_methods[c.toLowerCase()]=b;return b};b.prototype.addIndexerMethod=function(e,d,c,f){return this.addMethod(b.s_indexerMethodName,e,d,c,a.OperationType.read,null,f)};b.prototype.addEnumField=function(b,a){this.m_enumFields[b]=a;this.m_enumFieldLowerCaseNameToValue[b.toLowerCase()]=a;this.m_enumFieldValueToName[a]=b};b.prototype.setRESTfulOperationMethodNames=function(a,b){this.m_createItemOperationName=a;this.m_deleteOperationName=b};b.prototype.setCollectionInfo=function(b,a){this.m_childItemTypeName=b;this.m_supportEnumeration=a};b.prototype.tryGetIndexerMethod=function(){return this.tryGetMethod(b.s_indexerMethodName)};b.prototype.getIndexerMethod=function(){return this.getMethod(b.s_indexerMethodName)};b.prototype.getMethod=function(b){var d=b.toLowerCase(),c=this.m_methods[d];if(!c){var e=a.UtilityInternal.getApiName(this.m_name,b);throw a.Utility.createApiNotFoundException(e);}return c};b.prototype.tryGetMethod=function(a){a=a.toLowerCase();return this.m_methods[a]};b.prototype.getProperty=function(b){var d=b.toLowerCase(),c=this.m_properties[d];if(!c){var e=a.UtilityInternal.getApiName(this.m_name,b);throw a.Utility.createApiNotFoundException(e);}return c};b.prototype.tryGetProperty=function(a){a=a.toLowerCase();return this.m_properties[a]};b.prototype.getEnumFieldValue=function(c){var b=this.m_enumFieldLowerCaseNameToValue[c.toLowerCase()];if(a.Utility.isUndefined(b))throw a.Utility.createInvalidRequestException();return b};b.prototype.getEnumFieldName=function(a){return this.m_enumFieldValueToName[a]};b.prototype.tryGetItemAtMethod=function(){return this.tryGetMethod(a.Constants.getItemAt)};b.s_indexerMethodName=".indexer";return b}();a.TypeInformation=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){this.m_types={}}b.prototype.getType=function(c){var b=this.m_types[c];if(!b)throw a.Utility.createInvalidRequestException();return b};b.prototype.tryGetType=function(a){return this.m_types[a]};b.prototype.addType=function(b,e,g,d,f){var c=new a.TypeInformation(b,e,g,false,d,f);this.m_types[b]=c;return c};b.prototype.addEnumType=function(b){var c=new a.TypeInformation(b,null,null,true,a.TypeCategory.none,a.TypeFlags.none);this.m_types[b]=c;return c};b.prototype.addAuxEnumTypes=function(){var e=[];for(var l in this.m_types){var b=this.m_types[l];b.isEnum&&!b.isNullableEnum&&e.push(b)}for(var g=0;g<e.length;g++){var b=e[g],d=b.name;d=d+a.Constants.nullableTypeSuffix;var j=this.addEnumType(d);j.isNullableEnum=true;for(var i in b.enumFields)j.addEnumField(i,b.enumFields[i]);var c=b.name+a.Constants.arrayTypeSufix,f=new a.TypeInformation(c,null,null,false,a.TypeCategory.none,a.TypeFlags.none);f.arrayItemTypeInfo=b;this.m_types[c]=f;var h=c+a.Constants.arrayTypeSufix,k=new a.TypeInformation(h,null,null,false,a.TypeCategory.none,a.TypeFlags.none);k.arrayItemTypeInfo=f;this.m_types[h]=k}};return b}();a.TypeRegistration=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(b){var c=function(){function c(){}c.isNullOrUndefined=function(a){return a===null?true:typeof a==="undefined"?true:false};c.isUndefined=function(a){return typeof a==="undefined"?true:false};c.isNullOrEmptyString=function(a){return a===null?true:typeof a==="undefined"?true:a.length==0?true:false};c.trim=function(a){return a.replace(new RegExp("^\\s+|\\s+$","g"),"")};c.caseInsensitiveCompareString=function(b,a){return c.isNullOrUndefined(b)?c.isNullOrUndefined(a):c.isNullOrUndefined(a)?false:b.toUpperCase()==a.toUpperCase()};c.createInvalidArgumentException=function(a){return new b.RichApiException(b.ErrorCodes.invalidArgument,c.getLocalizedString(b.ResourceStrings.invalidArgument,a))};c.createInvalidOperationException=function(){return new b.RichApiException(b.ErrorCodes.invalidOperation,c.getLocalizedString(b.ResourceStrings.invalidOperation))};c.createInvalidRequestException=function(){return new b.RichApiException(b.ErrorCodes.invalidRequest,c.getLocalizedString(b.ResourceStrings.invalidRequest))};c.createApiNotFoundException=function(a){return new b.RichApiException(b.ErrorCodes.apiNotFound,c.getLocalizedString(b.ResourceStrings.apiNotFound,a),c.httpStatusCode_BadRequest,a)};c.createRichApiException=function(e,d,a,c){return new b.RichApiException(e,d,a,c)};c.getLocalizedString=function(d,e){var a=d;if(b.settings.getLocalizedStringFunc)a=b.settings.getLocalizedStringFunc(d);if(!c.isNullOrEmptyString(e))a=a.replace("{0}",e);return a};c.createPromise=function(b){return new a.Promise(b)};c.createPromiseFromResult=function(b){return new a.Promise(function(a){a(b)})};c.getAndValidateArgument=function(d,b,a){return c.validateArgument(d[b],a)};c.validateArgument=function(d,a){var b=d;if(c.isNullOrUndefined(d))if(a===c.s_expectedTypeInt)b=0;else if(a===c.s_expectedTypeNumber)b=0;else if(a===c.s_expectedTypeBoolean)b=false;else if(a===c.s_expectedTypeDate)b=new Date("1899-12-30T00:00:00.000Z");else b=null;else if(a!==c.s_expectedTypeAny)if(typeof a===c.s_scriptTypeFunction){if(!(d instanceof a))throw c.createInvalidArgumentException("value");}else if(a===c.s_expectedTypeInt||a===c.s_expectedTypeIntNullable){if(!c.isInt(b))throw c.createInvalidArgumentException("value");}else if(a===c.s_expectedTypeBoolean||a===c.s_expectedTypeBooleanNullable){if(typeof b!==c.s_scriptTypeBoolean)throw c.createInvalidArgumentException("value");}else if(a===c.s_expectedTypeNumber||a===c.s_expectedTypeNumberNullable){if(typeof b!==c.s_scriptTypeNumber)throw c.createInvalidArgumentException("value");}else if(a===c.s_expectedTypeDate||a===c.s_expectedTypeDateNullable){if(!(b instanceof Date))throw c.createInvalidArgumentException("value");}else if(a===c.s_expectedTypeString){if(typeof b!==c.s_scriptTypeString)throw c.createInvalidArgumentException("value");}else if(a.indexOf(c.s_expectedTypeArrayPrefix)===0){if(!Array.isArray(b))throw c.createInvalidArgumentException("value");}else if(a.indexOf(".")>0){var e=c.getTypeFromTypeName(a);if(!(b instanceof e))throw c.createInvalidArgumentException("value");}return b};c.getTypeFromTypeName=function(e){var b=e.split(".");if(b.length==0)throw c.createInvalidOperationException();for(var a=window,d=0;d<b.length;d++)if(a)a=a[b[d]];else throw c.createInvalidArgumentException("typeName");if(a&&typeof a===c.s_scriptTypeFunction)return a;else throw c.createInvalidArgumentException("typeName");};c.isInt=function(a){return Number(a)===a&&a%1===0};c.httpStatusCode_BadRequest=400;c.s_expectedTypeInt="int";c.s_expectedTypeNumber="number";c.s_expectedTypeBoolean="boolean";c.s_expectedTypeString="string";c.s_expectedTypeDate="date";c.s_expectedTypeAny="any";c.s_expectedTypeArrayPrefix="Array<";c.s_expectedTypeNullableSuffix="?";c.s_expectedTypeIntNullable="int?";c.s_expectedTypeBooleanNullable="boolean?";c.s_expectedTypeNumberNullable="number?";c.s_expectedTypeDateNullable="date?";c.s_scriptTypeNumber="number";c.s_scriptTypeBoolean="boolean";c.s_scriptTypeString="string";c.s_scriptTypeFunction="function";return c}();b.Utility=c})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){var b=function(){function b(){}b.isUpper=function(a){return a==a.toUpperCase()};b.getApiName=function(c,e){var a=e;if(a==".indexer")a="GetItem";a=b.toCamelLowerCase(a);var d=c.lastIndexOf(".");return d>0?c.substr(d+1)+"."+a:c+"."+a};b.toCamelLowerCase=function(c){var a=0;while(a<c.length&&b.isUpper(c.charAt(a)))a++;if(a<c.length){var d=c.substr(0,a);d=d.toLowerCase();return d+c.substr(a)}else return c.toLowerCase()};b.getShortTypeName=function(a){var b=a.lastIndexOf(".");return b>0?a.substr(b+1):a};b.createObject=function(a,c){b.checkCreateObjectPermission(a,c);var d=a.host.createInstance(c.name);return d};b.constructLogMessage=function(c,d,a){var b={AppId:c.host.appId(),ExceptionCode:a.code,ExceptionMessage:a.message};b[d]=a.location;return JSON.stringify(b)};b.invokePropertyGet=function(c,g,d,i){var f=d.dispatchId;try{b.logPropertyGetInvokeUsage(c,d);b.checkPropertyGetPermission(c,g,d);return i.invokePropertyGet(f)}catch(j){var e=b.convertToRichApiException(j);e.location=d.apiName;var h=b.constructLogMessage(c,"PropertyGetError",e);a.Logger.SendULSTraceTag(h,c.host.hostName(),50,35211329);throw e;}};b.invokePropertyGetAsync=function(c,f,d,g){var e=d.dispatchId;return a.Utility.createPromiseFromResult(null).then(function(){b.logPropertyGetInvokeUsage(c,d);b.checkPropertyGetPermission(c,f,d);return g.invokePropertyGetAsync(e)})["catch"](function(f){var e=b.convertToRichApiException(f);e.location=d.apiName;var g=b.constructLogMessage(c,"PropertyGetAsyncError",e);a.Logger.SendULSTraceTag(g,c.host.hostName(),50,35211330);throw e;})};b.logPropertyGetInvokeUsage=function(d,c){if(!a.Utility.isNullOrEmptyString(c.apiName)){var e=c.apiName.split(".");if(e.length>1&&e[1].charCodeAt(0)===b.s_underscoreCharCode)return}var f=JSON.stringify({AppId:d.host.appId(),UsageDataType:1,MethodName:c.apiName});a.Logger.SendULSTraceTag(f,d.host.hostName(),50,35211331)};b.getTypeNameWithoutArraySuffix=function(a){var b=a.indexOf("[");return b>0?a.substr(0,b):a};b.checkCreateObjectPermission=function(d,c){if(c.typeCategory===a.TypeCategory.classObject){b.checkRestrictedResourceTypeFlags(d,c.typeFlags,c.name);b.checkSafeTypeFlags(d,c.typeFlags,c.name)}};b.checkPropertyGetPermission=function(d,e,c){if(e.typeCategory===a.TypeCategory.classObject&&c.propertyTypeCategory===a.TypeCategory.classObject){b.checkRestrictedResourceApiFlags(d,c.apiFlags,c.apiName);b.checkSafeApiFlags(d,c.apiFlags,c.name,c.apiName)}};b.checkPropertyWritePermission=function(d,e,c){if(e.typeCategory===a.TypeCategory.classObject){if((d.request.requestFlags&a.RichApiRequestFlags.WriteOperation)===0)throw b.createAccessDeniedException(c.apiName);b.checkRestrictedResourceApiFlags(d,c.apiFlags,c.apiName);b.checkSafeApiFlags(d,c.apiFlags,c.name,c.apiName)}};b.checkMethodPermission=function(d,e,c){if(e.typeCategory===a.TypeCategory.classObject){if(c.methodOperationType!==a.OperationType.read&&(d.request.requestFlags&a.RichApiRequestFlags.WriteOperation)===0)throw b.createAccessDeniedException(c.apiName);b.checkRestrictedResourceApiFlags(d,c.apiFlags,c.apiName);b.checkSafeApiFlags(d,c.apiFlags,c.name,c.apiName)}};b.checkSafeTypeFlags=function(d,e,c){if((d.request.requestFlags&a.RichApiRequestFlags.OnlyAllowMakerSafeApi)!==0&&(e&a.TypeFlags.makerSafe)===0)throw b.createAccessDeniedException(c);if((d.request.requestFlags&a.RichApiRequestFlags.OnlyAllowCopilotSafeApi)!==0&&((e&a.TypeFlags.copilotSafe)===0||a.RichApi.isCopilotUnsafeApi(c)))throw b.createAccessDeniedException(c);};b.isSpecialApiNotRequirePermissionCheck=function(b){return b===a.Constants.getReferenceCount||b===a.Constants.removeReference||b===a.Constants.removeAllReferences||b===a.Constants.keepReference||b===a.Constants.onAccess};b.checkSafeApiFlags=function(d,e,f,c){if((d.request.requestFlags&a.RichApiRequestFlags.OnlyAllowMakerSafeApi)!==0&&(e&a.ApiFlags.makerSafe)===0)if(!b.isSpecialApiNotRequirePermissionCheck(f))throw b.createAccessDeniedException(c);if((d.request.requestFlags&a.RichApiRequestFlags.OnlyAllowCopilotSafeApi)!==0&&((e&a.ApiFlags.copilotSafe)===0||a.RichApi.isCopilotUnsafeApi(c)))if(!b.isSpecialApiNotRequirePermissionCheck(f))throw b.createAccessDeniedException(c);};b.checkRestrictedResourceTypeFlags=function(c,d,e){if((c.request.requestFlags&a.RichApiRequestFlags.RestrictedResourceAccess)===0&&(d&a.TypeFlags.restrictedResource)!==0)throw b.createAccessDeniedException(e);};b.checkRestrictedResourceApiFlags=function(c,d,e){if((c.request.requestFlags&a.RichApiRequestFlags.RestrictedResourceAccess)===0&&(d&a.ApiFlags.restrictedResource)!==0)throw b.createAccessDeniedException(e);};b.invokePropertySet=function(d,i,c,k,f,g){var h=c.dispatchId;try{g&&b.checkPropertyWritePermission(d,i,c);b.logPropertySetInvokeUsage(d,c);b.validateNotNullIfNecessary(c.apiFlags,f);k.invokePropertySet(h,[f])}catch(l){var e=b.convertToRichApiException(l);e.location=c.apiName;var j=b.constructLogMessage(d,"PropertySetError",e);a.Logger.SendULSTraceTag(j,d.host.hostName(),50,35211332);throw e;}};b.invokePropertySetAsync=function(d,g,c,h,e){var f=c.dispatchId;return a.Utility.createPromiseFromResult(null).then(function(){b.logPropertySetInvokeUsage(d,c);b.checkPropertyWritePermission(d,g,c);b.validateNotNullIfNecessary(c.apiFlags,e);return h.invokePropertySetAsync(f,[e])})["catch"](function(f){var e=b.convertToRichApiException(f);e.location=c.apiName;var g=b.constructLogMessage(d,"PropertySetAsyncError",e);a.Logger.SendULSTraceTag(g,d.host.hostName(),50,35211333);throw e;})};b.logPropertySetInvokeUsage=function(b,c){var d=JSON.stringify({AppId:b.host.appId(),UsageDataType:2,MethodName:c.apiName});a.Logger.SendULSTraceTag(d,b.host.hostName(),50,35211334)};b.validateNotNullIfNecessary=function(b,c){if((b&a.ApiFlags.notNull)!==0)if(a.Utility.isNullOrUndefined(c))throw a.Utility.createInvalidArgumentException("value");};b.validateMethodParameterNotNullIfNecessary=function(d,g){for(var c=d.parameters,a=0;a<c.length;a++){var e=c[a].apiFlags,f=g[a];b.validateNotNullIfNecessary(e,f)}};b.invokeMethod=function(d,h,c,j,f){var g=c.dispatchId;try{b.logMethodInvokeUsage(d,c);b.checkMethodPermission(d,h,c);b.validateMethodParameterNotNullIfNecessary(c,f);return j.invokeMethod(g,f)}catch(k){var e=b.convertToRichApiException(k);e.location=c.apiName;var i=b.constructLogMessage(d,"MethodCallError",e);a.Logger.SendULSTraceTag(i,d.host.hostName(),50,35211335);throw e;}};b.invokeMethodAsync=function(d,g,c,h,e){var f=c.dispatchId;return a.Utility.createPromiseFromResult(null).then(function(){b.logMethodInvokeUsage(d,c);b.checkMethodPermission(d,g,c);b.validateMethodParameterNotNullIfNecessary(c,e);return h.invokeMethodAsync(f,e)})["catch"](function(f){var e=b.convertToRichApiException(f);e.location=c.apiName;var g=b.constructLogMessage(d,"MethodCallAsyncError",e);a.Logger.SendULSTraceTag(g,d.host.hostName(),50,35211336);throw e;})};b.logMethodInvokeUsage=function(d,c){if(!a.Utility.isNullOrEmptyString(c.apiName)){var e=c.apiName.split(".");if(e.length>1&&e[1].charCodeAt(0)===b.s_underscoreCharCode)return}var f=JSON.stringify({AppId:d.host.appId(),UsageDataType:3,MethodName:c.apiName});a.Logger.SendULSTraceTag(f,d.host.hostName(),50,35211337)};b.invokeGetAsyncEnumerator=function(d,e,b,a,c){return b.getAsyncEnumerator(a,c)};b.writeValue=function(d,e,h,c){if(a.Utility.isNullOrUndefined(c)){d.writeValueNull();return}if(h)c=b.convertEnumValueToStringIfApplicable(h,c);if(Array.isArray(c)){d.startArrayScope();for(var i=c,f=0;f<i.length;f++)b.writeValue(d,e,null,i[f]);d.endScope();return}if(typeof c=="object"&&typeof c.getTypeName=="function"){var j=c.getTypeName(),g=e.typeReg.getType(j);if(g.typeCategory!=a.TypeCategory.valueObject)throw a.Utility.createInvalidOperationException();b.writeComplexTypeValue(d,e,c,g);return}d.writeValue(c)};b.writeComplexTypeValue=function(c,e,j,d){c.startObjectScope();c.writeName("@odata.type");c.writeValue(d.name);var h=(d.typeFlags&a.TypeFlags.shouldSkipUndefinedProperties)==a.TypeFlags.shouldSkipUndefinedProperties;for(var k in d.properties){var f=d.properties[k],i=e.typeReg.tryGetType(f.propertyTypeName),g=b.invokePropertyGet(e,d,f,j);if(g===undefined&&h)continue;c.writeName(f.camelLowerCaseName);b.writeValue(c,e,i,g)}c.endScope()};b.convertEnumValueToStringIfApplicable=function(d,a){if(d.isEnum&&typeof a=="number")return d.getEnumFieldName(a);if(Array.isArray(a)){var f=d.arrayItemTypeInfo;if(f)for(var e=a,c=0;c<e.length;c++)e[c]=b.convertEnumValueToStringIfApplicable(f,e[c])}return a};b.convertToRichApiException=function(b){var d;if(b instanceof a.RichApiException)d=b;else{var c;if(b.message)c=b.message;else c=b.toString();d=new a.RichApiException(a.ErrorCodes.generalException,c)}return d};b.createAccessDeniedException=function(b){var c=a.Utility.getLocalizedString(a.ResourceStrings.accessDenied);return a.Utility.createRichApiException(a.ErrorCodes.accessDenied,c,403,b)};b.s_underscoreCharCode="_".charCodeAt(0);return b}();a.UtilityInternal=b})(b=a.WacRuntime||(a.WacRuntime={}))})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(){})(OfficeExtension||(OfficeExtension={}));var OfficeExtension;(function(a){var b;(function(a){a.OfficeRequire=function(){return null}()})(b=a._Internal||(a._Internal={}));(function(a){var b;(function(a){function b(){return function(){"use strict";function L(a){return typeof a==="function"||typeof a==="object"&&a!==null}function t(a){return typeof a==="function"}function O(a){return typeof a==="object"&&a!==null}var u;if(!Array.isArray)u=function(a){return Object.prototype.toString.call(a)==="[object Array]"};else u=Array.isArray;var y=u,m=0,kb={}.toString,eb,r,g=function(a,b){l[m]=a;l[m+1]=b;m+=2;if(m===2)if(r)r(k);else p()};function X(a){r=a}function gb(a){g=a}var S=typeof window!=="undefined"?window:undefined,x=S||{},B=x.MutationObserver||x.WebKitMutationObserver,hb=typeof process!=="undefined"&&{}.toString.call(process)==="[object process]",fb=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function Z(){var b=process.nextTick,a=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);if(Array.isArray(a)&&a[1]==="0"&&a[2]==="10")b=window.setImmediate;return function(){b(k)}}function J(){var a=new MessageChannel;a.port1.onmessage=k;return function(){a.port2.postMessage(0)}}function T(){return function(){setTimeout(k,1)}}var l=new Array(1e3);function k(){for(var a=0;a<m;a+=2){var b=l[a],c=l[a+1];b(c);l[a]=undefined;l[a+1]=undefined}m=0}var p;if(hb)p=Z();else if(fb)p=J();else p=T();function j(){}var f=void 0,h=1,e=2,n=new w;function F(){return new TypeError("You cannot resolve a promise with itself")}function G(){return new TypeError("A promises callback cannot return that same promise.")}function V(a){try{return a.then}catch(b){n.error=b;return n}}function W(d,c,a,b){try{d.call(c,a,b)}catch(e){return e}}function z(d,b,e){g(function(f){var d=false,g=W(e,b,function(a){if(d)return;d=true;if(b!==a)i(f,a);else c(f,a)},function(b){if(d)return;d=true;a(f,b)},"Settle: "+(f._label||" unknown promise"));if(!d&&g){d=true;a(f,g)}},d)}function C(d,b){if(b._state===h)c(d,b._result);else if(b._state===e)a(d,b._result);else o(b,undefined,function(a){i(d,a)},function(b){a(d,b)})}function A(d,b){if(b.constructor===d.constructor)C(d,b);else{var e=V(b);if(e===n)a(d,n.error);else if(e===undefined)c(d,b);else if(t(e))z(d,b,e);else c(d,b)}}function i(b,d){if(b===d)a(b,F());else if(L(d))A(b,d);else c(b,d)}function E(a){a._onerror&&a._onerror(a._result);s(a)}function c(a,b){if(a._state!==f)return;a._result=b;a._state=h;a._subscribers.length!==0&&g(s,a)}function a(a,b){if(a._state!==f)return;a._state=e;a._result=b;g(E,a)}function o(c,i,d,f){var a=c._subscribers,b=a.length;c._onerror=null;a[b]=i;a[b+h]=d;a[b+e]=f;b===0&&c._state&&g(s,c)}function s(b){var a=b._subscribers,f=b._state;if(a.length===0)return;for(var e,d,g=b._result,c=0;c<a.length;c+=3){e=a[c];d=a[c+f];if(e)v(f,e,d,g);else d(g)}b._subscribers.length=0}function w(){this.error=null}var q=new w;function R(a,b){try{return a(b)}catch(c){q.error=c;return q}}function v(l,d,k,m){var j=t(k),b,o,g,n;if(j){b=R(k,m);if(b===q){n=true;o=b.error;b=null}else g=true;if(d===b){a(d,G());return}}else{b=m;g=true}if(d._state===f)if(j&&g)i(d,b);else if(n)a(d,o);else if(l===h)c(d,b);else l===e&&a(d,b)}function D(b,c){try{c(function(a){i(b,a)},function(c){a(b,c)})}catch(d){a(b,d)}}function d(e,d){var b=this;b._instanceConstructor=e;b.promise=new e(j);if(b._validateInput(d)){b._input=d;b.length=d.length;b._remaining=d.length;b._init();if(b.length===0)c(b.promise,b._result);else{b.length=b.length||0;b._enumerate();b._remaining===0&&c(b.promise,b._result)}}else a(b.promise,b._validationError())}d.prototype._validateInput=function(a){return y(a)};d.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};d.prototype._init=function(){this._result=new Array(this.length)};var U=d;d.prototype._enumerate=function(){for(var a=this,d=a.length,c=a.promise,e=a._input,b=0;c._state===f&&b<d;b++)a._eachEntry(e[b],b)};d.prototype._eachEntry=function(a,c){var b=this,d=b._instanceConstructor;if(O(a))if(a.constructor===d&&a._state!==f){a._onerror=null;b._settledAt(a._state,c,a._result)}else b._willSettleAt(d.resolve(a),c);else{b._remaining--;b._result[c]=a}};d.prototype._settledAt=function(h,i,g){var b=this,d=b.promise;if(d._state===f){b._remaining--;if(h===e)a(d,g);else b._result[i]=g}b._remaining===0&&c(d,b._result)};d.prototype._willSettleAt=function(c,b){var a=this;o(c,undefined,function(c){a._settledAt(h,b,c)},function(c){a._settledAt(e,b,c)})};function db(a){return new U(this,a).promise}var Q=db;function Y(c){var e=this,b=new e(j);if(!y(c)){a(b,new TypeError("You must pass an array to race."));return b}var k=c.length;function g(a){i(b,a)}function h(c){a(b,c)}for(var d=0;b._state===f&&d<k;d++)o(e.resolve(c[d]),undefined,g,h);return b}var P=Y;function I(a){var b=this;if(a&&typeof a==="object"&&a.constructor===b)return a;var c=new b(j);i(c,a);return c}var H=I;function N(d){var c=this,b=new c(j);a(b,d);return b}var K=N,bb=0;function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");}function ab(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}var cb=b;function b(a){this._id=bb++;this._state=undefined;this._result=undefined;this._subscribers=[];if(j!==a){!t(a)&&M();!(this instanceof b)&&ab();D(this,a)}}b.all=Q;b.race=P;b.resolve=H;b.reject=K;b._setScheduler=X;b._setAsap=gb;b._asap=g;b.prototype={constructor:b,then:function(d,f){var b=this,a=b._state;if(a===h&&!d||a===e&&!f)return this;var c=new this.constructor(j),k=b._result;if(a){var i=arguments[a-1];g(function(){v(a,c,i,k)})}else o(b,c,d,f);return c},"catch":function(a){return this.then(null,a)}};return cb}.call(this)}a.Init=b})(b=a.PromiseImpl||(a.PromiseImpl={}))})(b=a._Internal||(a._Internal={}));(function(a){function c(){var a=window.navigator.userAgent,b=a.indexOf("Edge/");if(b>=0){a=a.substring(b+5,a.length);return a<"14.14393"?true:false}return false}function b(){return typeof window==="undefined"&&typeof Promise==="function"?Promise:typeof window!=="undefined"&&window.Promise?c()?a.PromiseImpl.Init():window.Promise:a.PromiseImpl.Init()}a.OfficePromise=b()})(b=a._Internal||(a._Internal={}));var c=b.OfficePromise;a.Promise=c})(OfficeExtension||(OfficeExtension={}));