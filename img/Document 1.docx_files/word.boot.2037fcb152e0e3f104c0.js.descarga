var Microsoft;!function(){"use strict";var t={d:function(e,i){for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Application:function(){return Di},ApplicationEvents:function(){return Ze},CommandIds:function(){return Q},DocRebootSupportMode:function(){return Hi},EventIds:function(){return et},Viewer:function(){return Vi},createApplication:function(){return Bi},createCancellationToken:function(){return hi}});const i=["eurppc"],s="RemoteUls.ashx",o="RemoteTelemetry.ashx";function n(t){return 8===t.toLowerCase().indexOf("ffc")}function r(t){return 8===t.toLowerCase().indexOf("ppc")}function a(t){const e=t.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return e&&e[1]?e[1]:"public"}function c(t,e){if(!e||-1===i.indexOf(e.toLowerCase()))return t;const s=t.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return s?`${s[1]}${e}-${s[3]}`:t}function h(t){const e=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function d(t,e){const i=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");const s=i[2];if(void 0===e)return s;if(e<0)throw new Error("subDomainParts should be at least 1");return s.split(".").slice(-(e+1)).join(".")}function l(t,e,i){i&&(t[e.toLowerCase()]=i)}function u(t,e){t[e.toLowerCase()]=""}function p(t,e){const i=t.toLowerCase(),s=e.toLowerCase();let o=i.indexOf("&"+s+"=");if(-1===o&&(o=i.indexOf("?"+s+"=")),-1===o)return"";const n=o+(e.length+2),r=t.indexOf("&",n);return t.substring(n,-1===r?void 0:r)}function m(t,e,i,s){if(!i)return t;let o=t;const n=o.indexOf("?");let r="&";n===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?r="":-1===n&&(r="?");const a=e.toLowerCase()+"=",c=new RegExp("\\W"+a,"i").exec(o);if("?"!==r&&c){if(s){const t=c.index+1,e=o.indexOf("&",t);o=o.substring(0,t)+a+i+(-1===e?"":o.substring(e))}return o}return o.concat(r,a,i)}function f(t){const e={},i=t.indexOf("?");return-1===i||i===t.length-1||t.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((t=>{if(t){const i=t.indexOf("=");-1!==i&&i!==t.length-1&&(e[t.substring(0,i).toLowerCase()]=t.substring(i+1))}})),e}function w(t){const e=new RegExp("(c[1-5])h?(-)");return t.replace(e,"$1h$2")}function g(t,e,i){const s=new RegExp("[?&]"+e+"=("+(i||"1")+")\\b","i"),o=t.match(s);return!(!o||i&&o[1]!==i)}function S(t,e){const i=p(t,e);return i?decodeURI(i):i}function v(t){return t?t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0]:""}function I(t=!1,e){return{shouldPreconnect:t=>_&&(!e||e(t)),preconnect:e=>function(t){const e=document.createElement("link");e.rel="preconnect",e.href=t,e.crossOrigin="anonymous",document.head.appendChild(e)}(t?w(e):e)}}const _=!0;var b,C,T,y,A;function E(t,e,i){if(!e)return;const s=window.navigator;if(s&&s.sendBeacon)try{return void s.sendBeacon(e,t)}catch{}!function(t,e,i){const s=new XMLHttpRequest;s.readyState!==XMLHttpRequest.UNSENT&&s.readyState!==XMLHttpRequest.DONE||(s.open("POST",e,i),s.send(t))}(t,e,i)}!function(t){t.Unknown="UNKNOWN",t.Initialized="INITIALIZED",t.Prebooted="PREBOOTED",t.Booting="BOOTING",t.Booted="BOOTED",t.Failed="FAILED",t.Disposing="DISPOSING",t.Disposed="DISPOSED"}(b||(b={})),(T=C||(C={}))[T._=0]="msoulscat_ES_EWAJS",T[T.A=1]="msoulscat_ES_EWAJSGrid",T[T.P=6]="msoulscat_ES_EWAJSChart",T[T.U=202]="msoulscat_MSOSP_FileMenuCommands",T[T.R=220]="msoulscat_MSOSP_AddInCommands",T[T.F=225]="msoulscat_MSOSP_OTelJS",T[T.O=227]="msoulscat_MSOSP_OTelJSInWebWoker",T[T.N=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",T[T.$=301]="msoulscat_Wac_WordViewer",T[T.H=306]="msoulscat_Wac_BrowserGeneral",T[T.B=320]="msoulscat_Wac_TaskPane",T[T.J=339]="msoulscat_Wac_OneNoteGeneral",T[T.K=340]="msoulscat_Wac_Ribbon",T[T.Z=356]="msoulscat_Wac_WacFeedback",T[T.X=379]="msoulscat_Wac_WopiPendingApplication",T[T.Y=383]="msoulscat_Wac_Telemetry",T[T.tt=391]="msoulscat_Wac_WacCatchUpActivities",T[T.et=394]="msoulscat_Wac_Dictation",T[T.it=395]="msoulscat_Wac_OneNoteSync",T[T.st=700]="msoulscat_Wac_VisioApp",T[T.ot=1601]="msoulscat_OneNoteOnline_EditableCache",T[T.nt=800]="msoulscat_Wac_PptAnimation",T[T.rt=833]="msoulscat_Wac_PptLive",T[T.ct=834]="msoulscat_Wac_PptMWeb",T[T.ht=835]="msoulscat_Wac_PptGc2General",T[T.dt=836]="msoulscat_Wac_PptGc2GraphicHost",T[T.lt=837]="msoulscat_Wac_PptGc2Operation",T[T.ut=852]="msoulscat_Wac_PptGc2EditCanvas",T[T.ft=844]="msoulscat_Wac_PptDataSync",T[T.wt=848]="msoulscat_Wac_PptFluidRuntime",T[T.gt=815]="msoulscat_Wac_PptShape",T[T.St=817]="msoulscat_Wac_PptSession",T[T.vt=830]="msoulscat_Wac_PptSlideshow",T[T.It=822]="msoulscat_Wac_PptView",T[T._t=846]="msoulscat_Wac_PptVideos",T[T.bt=1303]="msoulscat_Uci_Insights",T[T.Ct=2300]="msoulscat_Wac_VersionHistory",T[T.Tt=302]="msoulscat_Wac_WordPresence",T[T.yt=3e3]="msoulscat_Wac_OAuth",T[T.At=3005]="msoulscat_Wac_WordVersionHistory",T[T.Et=3006]="msoulscat_Wac_LivePersonaCard",T[T.Pt=3012]="msoulscat_Wac_CatchUpFlyout",T[T.Ut=3016]="msoulscat_Wac_WordDesigner",T[T.Rt=3021]="msoulscat_Wac_ModernFontPicker",T[T.Wt=3027]="msoulscat_Wac_UnifiedUiHost",T[T.Ft=3033]="msoulscat_Wac_EquationTools",T[T.Ot=1401]="msoulscat_Osf_Latency",T[T.Mt=1402]="msoulscat_Osf_Notification",T[T.kt=1403]="msoulscat_Osf_Runtime",T[T.Nt=3041]="msoulscat_Wac_AiMaker",T[T.xt=3043]="msoulscat_Wac_AiRewrite",T[T.$t=3044]="msoulscat_Wac_AiInsert",T[T.Ht=3047]="msoulscat_Wac_AiSummarize",T[T.Dt=3048]="msoulscat_Wac_CopilotCompose",T[T.Vt=3049]="msoulscat_Wac_Skittles",T[T.Bt=3050]="msoulscat_Wac_CopilotChat",T[T.Lt=3051]="msoulscat_Wac_Syntex",T[T.Jt=3052]="msoulscat_Wac_WireGraph",T[T.Gt=3053]="msoulscat_Wac_CshCopilot",T[T.zt=3055]="msoulscat_Wac_CopilotProactiveSummary",T[T.qt=3056]="msoulscat_Wac_CopilotProactiveShared",T[T.jt=3057]="msoulscat_Wac_CopilotCursor",T[T.Kt=3059]="msoulscat_Wac_WasmGeneral",T[T.Zt=3060]="msoulscat_Wac_WasmTextLayout",T[T.Xt=3061]="msoulscat_Wac_WasmSmartArt",T[T.Qt=3062]="msoulscat_Wac_WasmClient",T[T.Yt=3063]="msoulscat_Wac_WasmNative",T[T.te=3068]="msoulscat_Wac_UniversalPrint",T[T.ee=4e3]="msoulscat_AIHub_CreateModuleTelemetry",T[T.ie=4001]="msoulscat_AIHub_CreateModuleAugloop",T[T.se=4002]="msoulscat_AIHub_CreateModuleDAS",T[T.oe=4003]="msoulscat_AIHub_CreateModuleConfig",T[T.ne=4004]="msoulscat_AIHub_CreateModuleContext",T[T.re=4005]="msoulscat_AIHub_CreateModuleGraph",T[T.ce=4006]="msoulscat_AIHub_CreateModuleExperiences",T[T.he=4007]="msoulscat_AIHub_CreateModuleHttp",T[T.de=4008]="msoulscat_AIHub_CreateModuleRouting",T[T.le=4009]="msoulscat_AIHub_CreateModuleStorage",T[T.ue=4010]="msoulscat_AIHub_CreateModuleStore",T[T.pe=4011]="msoulscat_AIHub_CreateModuleUI",T[T.me=4012]="msoulscat_AIHub_CreateModuleSharePoint",T[T.fe=4013]="msoulscat_AIHub_CreateModuleLicensing",T[T.we=4100]="msoulscat_AIHub_CreateModuleUI_Artifacts",T[T.ge=4101]="msoulscat_AIHub_CreateModuleUI_BrandKit",T[T.Se=4102]="msoulscat_AIHub_CreateModuleUI_Forms",T[T.ve=4103]="msoulscat_AIHub_CreateModuleUI_Homepage",T[T.Ie=4104]="msoulscat_AIHub_CreateModuleUI_Text",T[T._e=4105]="msoulscat_AIHub_CreateModuleUI_Video",(A=y||(y={}))[A.Error=10]="Error",A[A.Warning=15]="Warning",A[A.Important=20]="Important",A[A.Info=50]="Info",A[A.Verbose=100]="Verbose",A[A.Spam=200]="Spam";const P={BUILD_NUMBER:"###VERSION###",BUILD_NUMBER_MINOR:-1};function U(){try{return P.BUILD_NUMBER}catch(t){return P.BUILD_NUMBER}}var R,W;function F(t,e,i,s=!0){const o={type:e.toString(),payloadJson:JSON.stringify(i)};E(JSON.stringify(o),t,s)}function O(t,e,i){F(t,R.JSAPI_STATE,{application:e,build:U(),state:i})}!function(t){t.JSAPI_STATE="JSAPI_STATE",t.H_V2="H_V2"}(R||(R={})),function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(W||(W={}));const M=1e3;function k(){return window.performance.now()}function N(){return Math.round(window.performance.now()+window.performance.timeOrigin)}class x{getTimeSpentLogging(){return this.be}addLoggingTime(t){this.be+=t}configure(t){const e=k();if(t.uploadCadenceInMs&&(this.Ce=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.Te=t.uploadTriggerSize),t.sessionId&&(this.ye=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.Ae)throw new Error("Remote ULS endpoint is already set");this.Ae=this.Ee(t.remoteUlsEndpoint),this.Pe=N(),this.Ue()}this.be+=k()-e}handleTrace(t){const e=k();t.message.length>3072&&(t.message=t.message.substring(0,3059)+"... [Trimmed]"),this.Re.push(t),(this.Re.length>this.Te||t.level===y.Error)&&this.Ue(),this.be+=k()-e}getUserSessionId(){return this.ye}constructor(t){this.Ce=3e4,this.Te=30,this.We=0,this.Re=[],this.Pe=N(),this.Fe=[],this.ye="",this.be=0,this.flushOnClose=()=>{this.Oe(!1,!1)},this.flush=()=>{this.Ue()},this.flushAndSetNewEndpoint=(t,e)=>{const i=this.Ee(t);i.localeCompare(this.Ae??"",void 0,{sensitivity:"accent"})&&(this.Fe.push((()=>{this.Ae=i,e&&e()})),this.Oe(!0,!0))},this.updateEndpointAndFlush=t=>{this.Ae=this.Ee(t),this.Oe(!0,!0)},this.Ee=t=>t+"?usid="+this.ye+"&officeserverversion="+U(),this.Ue=()=>{window.setTimeout((()=>this.Oe(!0,!0)),0)},this.Oe=(t,e)=>{const i=k();window.clearTimeout(this.Me),this.Ae&&(this.Re.length>0&&(this.We+=1,E(function(t,e,i,s){const o=[],n=t.map((t=>function(t,e,i){const s={};if(s.G=t.tag,s.T=t.timestamp-e,s.M=t.message,s.C=t.category,t.correlationId){let e=i.findIndex((e=>e===t.correlationId));e<0&&(e=i.push(t.correlationId)-1),s.I=e}const o=t.type*M+t.level;return s.D=o,s}(t,s,o))),r=function(t,e,i,s,o){const n={};return n.T=t,n.L=e,n.S=i,n.I=s,o&&o.length>0&&(n.W=o),n.V=1,n}(s,n,e,i,o);return JSON.stringify(r)}(this.Re.splice(0,t?this.Te:this.Re.length),this.ye,this.We,this.Pe),this.Ae,e),this.Pe=N()),0===this.Re.length&&this.Fe.length>0&&(this.Fe.forEach((t=>{"requestIdleCallback"in window?window.requestIdleCallback(t):window.setTimeout(t,0)})),this.Fe=[]),t&&(this.Me=window.setTimeout((()=>{this.Ue()}),this.Re.length>this.Te||this.Fe.length>0?1e3:this.Ce)),this.be+=k()-i)},t&&this.configure(t)}}let $,H=[];var D,V;function B(t){const e=new x(t);function i(t,i,s,o){const n=k();if(function(t){return 1===H[t]}(t))return;const r={timestamp:N(),category:i,tag:t,level:s,type:W.Trace,message:o,correlationId:""};e.addLoggingTime(k()-n),e.handleTrace(r)}return{ULS:{ke:(t,e,s,o)=>{i(t,e,s,o)},shipAssertTag:(t,e,s,o)=>{s&&i(t,e,y.Error,o)},debugAssertTag:(t,e,i,s)=>{throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:e.flush,flushOnClose:e.flushOnClose,setCorrelationId:()=>{}},configure:t=>{e.configure(t)},settingsChangeHandler:t=>{var i,s;i=t.Ne.getValue(D.xe,""),s=t.Ne.getValue(D.$e,""),$&&s===$||(H=[],$=s,i&&i.split(",").forEach((t=>{const e=parseInt(t,10);e&&(H[e]=1)}))),e.configure({uploadCadenceInMs:t.Ne.getValue(D.He,6e4)});const o=t.Ne.getValue(D.De,"").toString();""!==o&&e.flushAndSetNewEndpoint(o)},getTimeSpentLogging:()=>e.getTimeSpentLogging(),getUserSessionId:()=>e.getUserSessionId(),flushAndSetNewEndpoint:(t,i)=>{e.flushAndSetNewEndpoint(t,i)},updateEndpointAndFlush:t=>{e.updateEndpointAndFlush(t)}}}function L(t){if(t){const e=t.lastIndexOf(".");if(-1!==e)return t.substring(e+1).toLowerCase()}return""}function J(t){if(!t)return"";const e=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(Object.getPrototypeOf(t));return JSON.stringify(t,[...e,...i])}function G(t,e){return{isFeatureEnabled:i=>function(t,e,i){if(e)try{return e(t)}catch(t){i&&i.ULS.ke(594883024,C.X,y.Error,"IsFeatureEnabled callback error: "+J(t))}}(i,t,e)}}function z(t,e){const i={};if(Object.keys(V).forEach((e=>{const s=t.isFeatureEnabled(V[e]);void 0!==s&&(i[V[e]]=s?"1":"0")})),e&&e.wdFlights){const t=e.wdFlights.toLowerCase();for(const e of t.split(","))"et-treatment"!==e&&"et-control"!==e||(i[V.Ve]="et-treatment"===e?"1":"0")}return JSON.stringify(i)}!function(t){t.Be="BootstrapperMaxUlsHeartbeatTime",t.Le="BootstrapperNoCompleteWarning1Time",t.Je="BootstrapperNoCompleteWarning2Time",t.Ge="BootstrapperNoCompleteWarning3Time",t.$e="RemoteUlsETag",t.xe="RemoteUlsSuppressions",t.ze="BootstrapperSettingsFetchPeriod",t.qe="timestamp",t.je="BootstrapperUlsHeartbeatIntervalMs",t.Ke="BootstrapperUlsHeartBeatIsEnabled",t.He="BootstrapperUlsUploadCadenceMs",t.Ze="RequestedCallThrottlingDefaultToViewMinimumValue",t.De="BulsEndpointUrl",t.Xe="EnableCommonHostDiagnosticsParams",t.Qe="EnableICNForWord",t.Ye="EnableModernEmbedViewForPowerPoint",t.ti="EnableModernEmbedViewInOneUpForPowerPoint",t.ei="EnableModernEmbedViewForPowerPointGlobalAppUrl",t.ii="EnableModernReadingViewForPowerPoint",t.si="EnableModernViewForPowerPointIPad",t.oi="EnableEarlyFormSubmitMWeb",t.ni="EnableIpadAndTabletRedirection",t.ri="EnableM365IpadRedirection",t.ci="EnablePassingCustomFontCatalogToViewer",t.hi="EnableDefaultToModernForPowerPoint",t.di="ShouldLogJsApiKpisForWord",t.li="WordSwitchToViewInTeamsJsapiV1Enabled",t.pi="EnableWordSessionRefreshTelemetry",t.mi="PowerPointUseEssDCHint",t.fi="PowerPointUseAFDSupportedEssDCHint",t.wi="PowerPointEnableControl24DCsExcludeFromESS",t.gi="PowerPointListOfControl24DCsExcludedFromESS",t.Si="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",t.vi="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",t.Ii="ModernEmbedViewForPowerPointEnabledPercentage",t._i="PowerPointESSCookieLookbackThresholdHour",t.bi="PowerPointSetESSCookieLookbackExpEnabled",t.Ci="ExcelForceViewOnlyInTeamsJsapiV1",t.Ti="EnableWordSessionRefreshLoggingCleanup",t.yi="WordRefreshTelemetryExpirationInDays",t.Ai="IsSpoSandboxFixEnabled",t.Ei="WordConsumptionViewToEditRedirectIsEnabled",t.Pi="WordMobileToUnifiedReadRedirectIsEnabled",t.Ui="WordEditorBizchatSideBySideUnifiedReadIsEnabled",t.Ri="IPadPreviewerExpEnabled",t.Wi="MwacWordEditorExperimentExperienceIsEnabled",t.Fi="IPadTeamsPreviewerEnabled",t.Oi="IPadOutlookPreviewerEnabled",t.Mi="IPadOneDrivePreviewerEnabled",t.ki="IPadM365PreviewerEnabled"}(D||(D={})),function(t){t.Ve="EnterpriseTemplates",t.Ni="ExcelAdaptiveLayoutDownload",t.xi="ExcelLandingPageOfflineTelemetry",t.$i="ExcelLandingPageObserverRetry",t.Hi="H2StaticContent",t.Di="HashedUrl",t.Vi="ODCShareLinkPreload",t.Bi="OfficeComExcelJsApiV2",t.Li="OfficeComPptJsApiV2",t.Ji="OfficeComUiHost",t.Gi="OfficeComWordJsApiV2",t.zi="OfficeHwaUiHost",t.qi="OfficeUnifiedUiHostTeams",t.ji="WordViewToUnifiedRead",t.Ki="DocAspxMsalLoad",t.Zi="WordWebInteractiveReadOnlyMode"}(V||(V={}));class q{add(t){t&&this.Xi.push(t)}remove(t){if(!t)return;const e=this.Xi.indexOf(t);e>-1&&this.Xi.splice(e,1)}removeAll(){this.Xi=[]}dispatch(t,e){this.Xi.forEach((i=>{try{i(t)}catch(t){e&&e(t)}}))}constructor(){this.Xi=[]}}const j="Prod",K="Settings";class Z{updateEnvironment(t){this.Qi=(n(t)?"FF":j)+this.Yi+K,this.ts()}initializePeriodicFetch(t,e){this.Qi=(n(t)?"FF":j)+this.Yi+K,this.ts(),this.es=t+"AppSettingsHandler.ashx?app="+this.Yi+"&usid="+e+"&build="+U(),this.ss||(this.ss=window.setTimeout(this.os,3e4))}getValue(t,e){if(this.ns||this.ts(),!this.ns||!this.ns.hasOwnProperty(t))return e;const i=this.ns[t],s=typeof e;if(typeof i===s)return i;if("string"==typeof i){if("number"===s)return parseInt(i,10);if("boolean"===s)return"true"===i}return e}addSettingsChangeListener(t){this.cs.add(t)}removeSettingsChangeListener(t){this.cs.remove(t)}dispose(){this.ss&&window.clearTimeout(this.ss),this.hs&&self.cancelIdleCallback(this.hs),this.ss=void 0,this.hs=void 0,this.ns=void 0,this.cs.removeAll()}constructor(t,e){this.ds=0,this.ts=()=>{try{if(!window||!window.localStorage)return;const t=window.localStorage.getItem(this.Qi);if(!t)return;const e=JSON.parse(t);this.ls(e)}catch(t){this.us.ULS.ke(592836768,C.X,y.Warning,"Failed to get settings from localStorage: "+J(t))}},this.ls=t=>!!this.ps(t)&&(this.ns=t,this.cs.dispatch({Ne:this},(t=>{this.us.ULS.ke(592836769,C.X,y.Error,"Settings listener error: "+J(t))})),!0),this.ps=t=>{if(t&&"object"==typeof t){if(t.hasOwnProperty(D.qe)&&!isNaN(t.timestamp))return!0;this.us.ULS.ke(592836770,C.X,y.Error,"Received invalid settings")}return!1},this.os=()=>{if(!this.es)return;const t=new XMLHttpRequest;window.location.href.indexOf("wdnetcorerouting=true")>-1?t.setRequestHeader("X-NetCoreRouting","true"):window.location.href.indexOf("wdnetcorerouting=false")>-1&&t.setRequestHeader("X-NetCoreRouting","false"),t.open("GET",this.es),t.responseType="json",t.timeout=5e3,t.send(),t.onload=()=>{if(200===t.status&&t.response?(this.fs(t.response),this.ds=0):(this.us.ULS.ke(592836771,C.X,y.Error,`Fetch settings error. Status: ${t.status}, curErrors: ${this.ds}`),this.ds+=1),this.ds>7)return;let e=this.getValue(D.ze,3e5);this.ds>3&&(e+=(this.ds-3+1)*(e/2)),this.ss=window.setTimeout(this.os,e)}},this.fs=t=>{"requestIdleCallback"in window?(this.hs&&self.cancelIdleCallback(this.hs),this.hs=window.requestIdleCallback((()=>this.ws(t)),{timeout:1e4})):window.setTimeout((()=>this.ws(t)),0)},this.ws=t=>{if(!this.ls(t)||!window||!window.localStorage)return;const e=JSON.stringify(t);try{window.localStorage.setItem(this.Qi,e)}catch(t){this.us.ULS.ke(592836800,C.X,y.Warning,"Failed to set localStorage: "+J(t))}},this.Yi=t,this.Qi=j+t+K,this.us=e,this.cs=new q,this.ts()}}var X,Q,Y,tt,et;!function(t){t.appReboot="appReboot",t.boot="boot",t.closeTab="closeTab",t.createNew="createNew",t.dispose="dispose",t.frameTrust="frameTrust",t.getAuthToken="getAuthToken",t.getHostKeyValue="getHostKeyValue",t.handleBootState="handleBootState",t.postWacToken="postWacToken",t.rename="rename",t.setOverlayContent="setOverlayContent",t.storeHostKeyValue="storeHostKeyValue",t.switchMode="switchMode",t.updateBootComplete="updateBootComplete",t.setWacFlightValue="setWacFlightValue"}(X||(X={})),function(t){t.blurFocus="blurFocus",t.boot="boot",t.completeCreateNew="completeCreateNew",t.continueAccessibilityLoop="continueAccessibilityLoop",t.createNew="createNew",t.dispose="dispose",t.grabFocus="grabFocus",t.moveToFolder="moveToFolder",t.popState="popState",t.sendChannelId="sendChannelId",t.sendConvId="sendConvId",t.teamsUsersReply="teamsUsersReply",t.teamsUserMentionReply="teamsUserMentionReply",t.backButtonPressed="backButtonPressed",t.searchInvoked="searchInvoked",t.bootInterrupted="bootInterrupted",t.getClientUrl="getClientUrl",t.getWebUrl="getWebUrl",t.rename="rename",t.completeSharedFilePicker="completeSharedFilePicker",t.sendAccessToken="sendAccessToken",t.sendAuthToken="sendAuthToken",t.sendCustomAuthConfig="sendCustomAuthConfig",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendFrameTrustResult="sendFrameTrustResult",t.sendHWRTelemetry="sendHWRTelemetry",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.sendDavUrl="sendDavUrl",t.switchMode="switchMode",t.signalShared="signalShared",t.postWacToken="postWacToken"}(Q||(Q={})),function(t){t.gs="App_AccessibilityLoopComplete",t.Ss="Wac_ActionComplete",t.vs="WacInitialize_Ready",t.Is="Wac_AppFailed",t._s="Wac_AppBootState",t.bs="Wac_AppCompleted",t.Cs="BrowserEvent",t.Ts="UI_Close",t.ys="App_CloseTab",t.As="UI_Conversation",t.Es="UI_CopyAndEdit",t.Ps="App_CreateNewDocument",t.Us="Wac_AppDataSavedStatus",t.Rs="UI_Download",t.Ws="UI_PreDownloadFileInClient",t.Fs="UI_Edit",t.Os="Error",t.Ms="UI_FileEmbed",t.ks="UI_FileProperties",t.Ns="File_Rename",t.xs="File_RenameFailed",t.$s="UI_FileVersions",t.Hs="StateChanged",t.Ds="App_IsFrameTrusted",t.Vs="GetAccessToken",t.Bs="App_GetAuthToken",t.Ls="App_GetCustomAuthConfig",t.Js="App_GetHostKeyValue",t.Gs="App_WopiInfoFromUrl",t.zs="App_DavUrlFromIds",t.qs="App_LoadingStatus",t.js="App_SwitchMode",t.Ks="App_MoveToFolder",t.Zs="UI_OpenInMobileApp",t.Xs="UI_OpenInBrowser",t.Qs="UI_OpenInClient",t.Ys="PageChanged",t.eo="App_PushCommentContext",t.io="App_PushState",t.so="App_DocReboot",t.oo="UI_RedeemForCommenting",t.no="App_RefreshSessionInfo",t.ro="UI_ReplyWithChanges",t.ao="UI_ReportAbuse",t.co="App_FilePicker",t.ho="UI_SaveStatus",t.do="WopiSession_Complete_Ack",t.lo="SetOverlayContent",t.uo="UI_Sharing",t.po="UI_ShareForm",t.mo="UI_SignIn",t.fo="App_StoreHostKeyValue",t.wo="App_Unloaded",t.So="App_UlsLog",t.vo="Wac_UnloadingApp",t.Io="App_UpdateBootComplete",t._o="PageCount",t.bo="UI_CheckUserAccessAndGrantPermissions",t.Co="User_Activity",t.To="Edit_Notification",t.yo="UI_Workflow",t.Ao="ZoomChanged",t.Eo="CAAEMessage",t.Po="Excel_HostFrameCacheSave",t.Uo="Excel_HostFrameCacheEvict",t.Ro="Excel_RegenerateFileBundle",t.Wo="App_SwitchToWacFrame",t.Fo="App_SaveSSRData",t.Oo="App_PurgeDataInHostCache",t.Mo="App_SaveHostRenderingV2Data",t.ko="App_SaveHostUtilsData",t.No="AcquireOAuthTokenTeams",t.xo="App_SwitchNotebook",t.$o="FailedBoot_CheckFileInfo",t.Ho="GetTeamsUsers",t.Do="SendTeamsUserMention",t.Vo="NavigateBackToHost",t.Bo="App_GetClientUrlComplete",t.Lo="App_GetWebUrlComplete",t.Jo="App_CopyLinkComplete",t.Go="App_SendConversationId",t.zo="CloseTeamsConversation",t.qo="PageLoaded",t.jo="Visio_BRS",t.Ko="Visio_SendLicenseInfo",t.Zo="Visio_Consumption_CLTComplete",t.Xo="Visio_SwitchMode_FromViewFrame",t.Qo="Visio_ModeSwitch_ToHost_Ack",t.Yo="Visio_UpdateEditUrl",t.tn="Visio_PageViewLoaded",t.en="Visio_ActiveAppFrameLoadFailed",t.sn="Visio_DisposeBkgFrame",t.on="Visio_ReadyToReceiveDocData",t.nn="Visio_DocReboot_HostNav",t.rn="Visio_SwitchToVisioFrame",t.an="WacAppPerfMetric",t.cn="App_ModifyURLState",t.hn="App_WacTokenAck",t.dn="App_InitEnd",t.ln="App_SplashScreenShown",t.un="App_SetWacFlightValue",t.pn="App_PrintRedirect",t.mn="App_RequestFullScreen",t.fn="App_ShowCopilotBottomBar",t.wn="UI_ExternalDocumentShare",t.gn="AddNAATrustedOrigins"}(Y||(Y={})),function(t){t.Sn="Ack",t.vn="WacInitialize_Ready_Ack",t.In="Wac_BeforeUnloadApp",t._n="Blur_Focus",t.bn="Wac_AppFailed_Ack",t.Cn="Wac_AppCompleted_Ack",t.Tn="WopiStartSession_Complete",t.yn="WopiPendingSession_Complete",t.An="Host_AccessibilityLoopComplete",t.Ds="Host_IsFrameTrusted",t.En="Grab_Focus",t.Pn="HostCacheDiagnostic",t.Un="Host_KeyValue",t.Rn="JsApiDiagnostics",t.Ks="Host_MoveToFolder",t.Wn="PageChanged_Ack",t.Fn="App_PopState",t.On="Host_SendChannelId",t.Mn="Host_SendConversationId",t.kn="GetTeamsUsers_Reply",t.Nn="SendTeamsUserMention_Reply",t.xn="Host_BackButtonPressed",t.$n="Host_SearchInvoked",t.Hn="BootInterrupted",t.Dn="Host_GetClientUrl",t.Vn="Host_GetWebUrl",t.Bn="File_Rename",t.co="Host_FilePicker",t.Ln="PostAccessToken",t.Jn="Host_SetAuthToken",t.Gn="Host_SetCustomAuthConfig",t.zn="App_PushCommentContext",t.qn="CanEmbed",t.jn="Host_RefreshSessionInfo",t.Kn="CheckUserAccessAndGrantPermissions_Result",t.Zn="Host_WopiInfoFromUrl",t.Xn="Host_DavUrlFromIds",t.Qn="SetCurrentPage",t.Yn="SetZoomLevel",t.tr="WopiPendingSession_Fail",t.er="SetOverlayContent",t.ir="WopiPendingApplicationComplete_Received",t.sr="Host_SwitchMode",t.nr="Host_Unload",t.rr="PageCount_Ack",t.ar="ZoomChanged_Ack",t.cr="Host_ShareUI",t.hr="Host_Telemetry",t.dr="Visio_ConsumptionCLTComplete_Ack",t.lr="Visio_SwitchMode_FromHF_Ack",t.ur="Visio_SwitchMode_FromHostFrame",t.pr="Visio_FallbackToLegacySwitch",t.mr="Visio_DocumentData",t.wr="Host_PostWacToken"}(tt||(tt={})),function(t){t.AccessibilityLoopCompleted="AccessibilityLoopCompleted",t.ActionCompleted="ActionCompleted",t.BrowserEvent="BrowserEvent",t.CAAEMessage="CAAEMessage",t.Close="Close",t.InitEnd="InitEnd",t.Conversation="Conversation",t.CopyAndEdit="CopyAndEdit",t.CreateNewDocument="CreateNewDocument",t.Download="Download",t.PreDownloadFileInClient="PreDownloadFileInClient",t.Edit="Edit",t.Error="Error",t.FileEmbed="FileEmbed",t.FileProperties="FileProperties",t.FileRenamed="FileRenamed",t.FileVersions="FileVersions",t.FrameStateChanged="FrameStateChanged",t.FrameTrust="FrameTrust",t.GetAccessToken="GetAccessToken",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.GetWopiInfoFromUrl="GetWopiInfoFromUrl",t.GetDavUrlFromIds="GetDavUrlFromIds",t.ModeSwitched="ModeSwitched",t.MoveToFolder="MoveToFolder",t.OpenInMobileApp="OpenInMobileApp",t.OpenInBrowser="OpenInBrowser",t.OpenInClient="OpenInClient",t.PageChanged="PageChanged",t.PushState="PushState",t.Reboot="Reboot",t.RedeemForCommenting="RedeemForCommenting",t.RefreshSessionInfo="RefreshSessionInfo",t.ReplyWithChanges="ReplyWithChanges",t.ReportAbuse="ReportAbuse",t.SharedFilePicker="SharedFilePicker",t.SaveStatus="SaveStatus",t.Share="Share",t.ShareForm="ShareForm",t.SignIn="SignIn",t.SplashScreenShown="SplashScreenShown",t.UserAccessAndPermissions="UserAccessAndPermissions",t.UserActivity="UserActivity",t.UserEditActivity="UserEditActivity",t.Workflow="Workflow",t.ZoomChanged="ZoomChanged",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.LoadingStatus="LoadingStatus",t.SwitchNotebook="SwitchNotebook",t.FailedBootCheckFileInfo="FailedBootCheckFileInfo",t.GetTeamsUsers="GetTeamsUsers",t.SendTeamsUserMention="SendTeamsUserMention",t.NavigateBackToHost="NavigateBackToHost",t.GetClientUrlComplete="GetClientUrlComplete",t.GetWebUrlComplete="GetWebUrlComplete",t.CopyLinkComplete="CopyLinkComplete",t.SendConversationId="SendConversationId",t.CloseTeamsConversation="CloseTeamsConversation",t.PageLoaded="PageLoaded",t.FrameChanged="FrameChanged",t.PrintRedirect="PrintRedirect",t.RequestFullScreen="RequestFullScreen",t.ShowCopilotBottomBar="ShowCopilotBottomBar",t.ExternalDocumentShare="ExternalDocumentShare",t.AddNAATrustedOrigins="AddNAATrustedOrigins"}(et||(et={}));const it={[Q.boot]:{gr:X.boot},[Q.createNew]:{gr:X.createNew},[Q.dispose]:{gr:X.dispose},[Q.postWacToken]:{gr:X.postWacToken},[Q.rename]:{gr:X.rename},[Q.switchMode]:{gr:X.switchMode},[Y._s]:{gr:X.handleBootState},[Y.ys]:{gr:X.closeTab},[Y.Ds]:{gr:X.frameTrust},[Y.Bs]:{gr:X.getAuthToken},[Y.Js]:{gr:X.getHostKeyValue},[Y.so]:{gr:X.appReboot},[Y.un]:{gr:X.setWacFlightValue},[Y.lo]:{gr:X.setOverlayContent},[Y.fo]:{gr:X.storeHostKeyValue},[Y.Io]:{gr:X.updateBootComplete},[Q.blurFocus]:{Sr:tt._n},[Q.continueAccessibilityLoop]:{Sr:tt.An},[Q.grabFocus]:{Sr:tt.En},[Q.moveToFolder]:{Sr:tt.Ks},[Q.popState]:{Sr:tt.Fn},[Q.sendChannelId]:{Sr:tt.On},[Q.sendConvId]:{Sr:tt.Mn},[Q.teamsUsersReply]:{Sr:tt.kn},[Q.teamsUserMentionReply]:{Sr:tt.Nn},[Q.backButtonPressed]:{Sr:tt.xn},[Q.searchInvoked]:{Sr:tt.$n},[Q.bootInterrupted]:{Sr:tt.Hn},[Q.getClientUrl]:{Sr:tt.Dn},[Q.getWebUrl]:{Sr:tt.Vn},[Q.sendAccessToken]:{Sr:tt.Ln},[Q.sendAuthToken]:{Sr:tt.Jn},[Q.sendHWRTelemetry]:{Sr:tt.hr},[Q.sendCustomAuthConfig]:{Sr:tt.Gn},[Q.sendDavUrl]:{Sr:tt.Xn},[Q.sendEmbeddedViewUrl]:{Sr:tt.qn},[Q.sendFrameTrustResult]:{Sr:tt.Ds},[Q.sendSessionInfo]:{Sr:tt.jn},[Q.sendUserAccessAndPermissions]:{Sr:tt.Kn},[Q.sendWopiInfo]:{Sr:tt.Zn},[Q.signalShared]:{Sr:tt.cr},[Q.completeSharedFilePicker]:{Sr:tt.co},[Y.gs]:{vr:et.AccessibilityLoopCompleted},[Y.Ss]:{vr:et.ActionCompleted},[Y.Cs]:{vr:et.BrowserEvent},[Y.Eo]:{vr:et.CAAEMessage},[Y.Ts]:{vr:et.Close},[Y.As]:{vr:et.Conversation},[Y.Es]:{vr:et.CopyAndEdit},[Y.Ps]:{vr:et.CreateNewDocument},[Y.Rs]:{vr:et.Download},[Y.Ws]:{vr:et.PreDownloadFileInClient},[Y.Fs]:{vr:et.Edit},[Y.Os]:{vr:et.Error},[Y.Ms]:{vr:et.FileEmbed},[Y.ks]:{vr:et.FileProperties},[Y.Ns]:{vr:et.FileRenamed},[Y.$s]:{vr:et.FileVersions},[Y.Vs]:{vr:et.GetAccessToken},[Y.zs]:{vr:et.GetDavUrlFromIds},[Y.Ls]:{vr:et.GetCustomAuthConfig},[Y.Gs]:{vr:et.GetWopiInfoFromUrl},[Y.Hs]:{vr:et.FrameStateChanged},[Y.js]:{vr:et.ModeSwitched},[Y.Ks]:{vr:et.MoveToFolder},[Y.Zs]:{vr:et.OpenInMobileApp},[Y.Xs]:{vr:et.OpenInBrowser},[Y.Qs]:{vr:et.OpenInClient},[Y.Ys]:{vr:et.PageChanged},[Y.io]:{vr:et.PushState},[Y.oo]:{vr:et.RedeemForCommenting},[Y.no]:{vr:et.RefreshSessionInfo},[Y.ro]:{vr:et.ReplyWithChanges},[Y.co]:{vr:et.SharedFilePicker},[Y.ao]:{vr:et.ReportAbuse},[Y.ho]:{vr:et.SaveStatus},[Y.uo]:{vr:et.Share},[Y.po]:{vr:et.ShareForm},[Y.mo]:{vr:et.SignIn},[Y.bo]:{vr:et.UserAccessAndPermissions},[Y.Co]:{vr:et.UserActivity},[Y.To]:{vr:et.UserEditActivity},[Y.yo]:{vr:et.Workflow},[Y.Ao]:{vr:et.ZoomChanged},[Y.No]:{vr:et.AcquireOAuthTokenTeams},[Y.qs]:{vr:et.LoadingStatus},[Y.xo]:{vr:et.SwitchNotebook},[Y.$o]:{vr:et.FailedBootCheckFileInfo},[Y.Ho]:{vr:et.GetTeamsUsers},[Y.Do]:{vr:et.SendTeamsUserMention},[Y.Vo]:{vr:et.NavigateBackToHost},[Y.Bo]:{vr:et.GetClientUrlComplete},[Y.Lo]:{vr:et.GetWebUrlComplete},[Y.Jo]:{vr:et.CopyLinkComplete},[Y.Go]:{vr:et.SendConversationId},[Y.zo]:{vr:et.CloseTeamsConversation},[Y.qo]:{vr:et.PageLoaded},[Y.dn]:{vr:et.InitEnd},[Y.ln]:{vr:et.SplashScreenShown},[Y.pn]:{vr:et.PrintRedirect},[Y.mn]:{vr:et.RequestFullScreen},[Y.fn]:{vr:et.ShowCopilotBottomBar},[Y.wn]:{vr:et.ExternalDocumentShare},[Y.gn]:{vr:et.AddNAATrustedOrigins}};function st(){const t=new Uint8Array(31),e=function(t){const e={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){e.crypto=!0;try{return i.getRandomValues(t),e}catch(t){e.exceptions.push(`crypto: ${J(t)}`)}}e.perfNow=!0;for(let i=0;i<t.length;i+=1){try{let t=Math.floor(100*window.performance.now())%10;(t<0||t>9)&&(t=0);for(let e=0;e<t;e+=1)Math.random()}catch(t){e.exceptions.push(`Math.random: ${J(t)}`)}t[i]=Math.floor(16*Math.random())}return e}(t);let i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=15&t[i];return i+=1,("x"===e?s:3&s|8).toString(16)})),e]}var ot;!function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.TeamsElectron=6]="TeamsElectron",t[t.AndroidWebView=7]="AndroidWebView",t[t.Unknown=8]="Unknown"}(ot||(ot={}));const nt=window.navigator,rt=nt?nt.userAgent:void 0;function at(){if(rt){if(rt.indexOf("Firefox")>-1)return ot.Firefox;if(rt.indexOf("Opera")>-1||rt.indexOf("OPR")>-1)return ot.Opera;if(rt.indexOf("Trident")>-1)return ot.IE;if(rt.indexOf("Electron")>-1&&rt.indexOf("Teams")>-1)return ot.TeamsElectron;if(rt.indexOf("Android")>-1&&rt.indexOf("wv")>-1)return ot.AndroidWebView;if(rt.indexOf("Edg")>-1)return ot.Edge;if(rt.indexOf("Chrome")>-1)return ot.Chrome;if(rt.indexOf("Safari")>-1)return ot.Safari}return ot.Unknown}function ct(){try{return!!rt&&rt.indexOf("iPad")>=0||!!rt&&rt.indexOf("Macintosh")>=0&&mt()&&!pt()||!!rt&&rt.indexOf("Android")>=0||mt()}catch{return!1}}function ht(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}function dt(){return at()===ot.IE&&!(at()===ot.IE&&null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11)}function lt(){return at()===ot.IE}function ut(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}function pt(){return!!rt&&rt.indexOf("iPhone")>=0}function mt(){return!!nt&&nt.maxTouchPoints>0}function ft(t,e){e&&Object.keys(e).forEach((i=>{t[i]=e[i]}))}function wt(t,e){try{if(void 0===window.performance)return void e.ULS.ke(595948609,C.X,y.Info,"Performance not supported");const i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void e.ULS.ke(595948610,C.X,y.Info,"No resources under performance");const s=new RegExp(t+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i");for(let t=i.length-1;t>=0;t-=1){const o=i[t],n=o.name.match(s);if(n){let t=JSON.stringify(o);return t=t.replace(new RegExp(o.name,"g"),n[0]),void e.ULS.ke(595948616,C.X,y.Info,t)}}e.ULS.ke(595948484,C.X,y.Info,"Could not find JSAPI resource timing entry")}catch(t){e.ULS.ke(595948617,C.X,y.Info,`Could not trace the resource timing: ${J(t)}`)}}function gt(t){const e={...t.host,sessionId:t.hostSessionId,domain:location?location.host:void 0};delete e.siteId,delete e.webId,delete e.uiHostTabId;const i={};if(t.wdParams){const e=JSON.parse(JSON.stringify(t.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((t=>{e[t]&&(i[t]=e[t])}));const s=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;i.wdprevioussession&&!s.test(i.wdprevioussession)&&delete i.wdprevioussession,i.wdpreviouscorrelation&&!s.test(i.wdpreviouscorrelation)&&delete i.wdpreviouscorrelation}const s={...t.rebootOverride};delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl;const o=t.wopi;return{accessToken:o?{length:o.accessToken.length,expiry:o.expiry}:"N/A",wacToken:o&&o.wacToken?{length:o.wacToken.length}:void 0,bootParams:t.bootParams,build:U(),host:e,intent:t.intent,jsApiVersion:"v2",rebootOverride:s,region:a(t.appBaseUrl),sessionOrigin:t.hostInitDiagnostics?t.hostInitDiagnostics.entryPoint:void 0,sessionContext:t.sessionContext,throttling:t.throttling,ui:t.ui,viewMode:t.viewMode,meeting:t.meeting?{id:t.meeting?.id,isPresenter:t.meeting?.isPresenter}:void 0,wdParams:i}}function St(){const t={perfNowSupported:!0,browser:ot[at()],touchMode:ct(),highContrast:ht(),windows10x:ut()};try{const e=window.navigator,i=e.connection||e.mozConnection||e.webkitConnection;i&&(t.netOnline=e.onLine,t.netDownlink=i.downlink,t.netDownlinkMax=i.downlinkMax,t.netEffectiveType=i.effectiveType,t.netRtt=i.rtt,t.netSaveData=i.saveData,t.netType=i.type),t.deviceMemory=e.deviceMemory,t.logicalProcessors=e.hardwareConcurrency}catch{}return t}function vt(t){return/sharepoint/i.test(t)}var It;function _t(t){const e=window.performance.timing;e&&(t.hostPageNavigationStartTime||(t.hostPageNavigationStartTime=e.navigationStart),t.hostPageFetchStartTime||(t.hostPageFetchStartTime=e.fetchStart),t.hostPageRequestStartTime||(t.hostPageRequestStartTime=e.requestStart),t.hostPageResponseStartTime||(t.hostPageResponseStartTime=e.responseStart),t.hostPageResponseEndTime||(t.hostPageResponseEndTime=e.responseEnd),t.hostPageDomCompleteTime||(t.hostPageDomCompleteTime=e.domComplete));const i=window.performance.navigation;if(i&&(void 0===t.hostPageRedirectCount&&(t.hostPageRedirectCount=i.redirectCount),!t.hostPageNavigationType)){let e="UNKNOWN";switch(i.type){case 0:e="NAVIGATE";break;case 1:e="RELOAD";break;case 2:e="BACK_FORWARD";break;case 255:e="RESERVED"}t.hostPageNavigationType=e}}!function(t){t[t.Unknown=0]="Unknown",t[t.Normal=1]="Normal",t[t.Minor=2]="Minor",t[t.Medium=3]="Medium",t[t.Major=4]="Major",t[t.Critical=5]="Critical"}(It||(It={}));class bt{dispose(){window.removeEventListener("beforeunload",this.Ir,{capture:!0}),window.removeEventListener("pagehide",this._r,{capture:!0}),window.removeEventListener("visibilitychange",this.br,{capture:!0}),window.removeEventListener("unload",this.Cr,{capture:!0})}constructor(t,e){this.Ir=()=>Ct(t,"OnBeforeUnload",e),this._r=()=>Ct(t,"OnPageHide",e),this.br=()=>Ct(t,"VisibilityChange_"+document.visibilityState,e),this.Cr=()=>Ct(t,"OnUnload",e),window.addEventListener("beforeunload",this.Ir,{capture:!0,once:!0}),window.addEventListener("pagehide",this._r,{capture:!0}),window.addEventListener("visibilitychange",this.br,{capture:!0}),window.addEventListener("unload",this.Cr,{capture:!0,once:!0})}}function Ct(t,e,i){t.ULS.ke(595957843,C.X,y.Important,`Page lifecycle: ${e} fired`+(i?", flushing logger":"")),i&&t.ULS.flush()}const Tt=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","https://editor.svc.cloud.microsoft/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000","https://immersivereader.cloud.microsoft","https://forms.office.com"],yt="AddinTrustedOrigin";class At{async isResourceTrustedForMessage(t){if(!t||!t.Resource)return!1;const e=t.Resource,i=t.AddinTrustId,s=function(t){if(!t)return!1;const e=t.toLowerCase();for(const t of Tt)if(t===e||`${t}/`===e)return!0;return!1}(e);if(s||!i)return s;if(this.Tr[i])return Et(e,this.Tr[i]);let o;const n=new Promise((t=>{o=(s,o)=>{i===s&&t(Et(e,o))},this.yr.push(o)}));let r=-1;const a=new Promise((t=>{r=window.setTimeout((()=>{this.us.ULS.ke(560754786,C.X,y.Warning,`isResourceTrustedForMessage - timeout waiting for addinTrustId: ${i}`),t(!1)}),2e3)})),c=await Promise.race([n,a]);return this.yr=this.yr.filter((t=>t!==o)),window.clearTimeout(r),c}dispose(){this.Tr={},this.yr=[],window.removeEventListener("message",this.Ar)}constructor(t){this.Tr={},this.yr=[],this.Ar=t=>{if(t&&t.origin)try{const e=t.data;if("string"==typeof e&&e.includes(yt)){const i=JSON.parse(e),s=i.AddinTrustId;s&&i.MessageId===yt&&(this.us.ULS.ke(560754784,C.X,y.Info,`didReceiveMessage addinTrustId ${s}`),this.Tr[s]=t.origin,this.yr.forEach((e=>{e(s,t.origin)})))}}catch(t){this.us.ULS.ke(560754785,C.X,y.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.us=t,window.addEventListener("message",this.Ar)}}function Et(t,e){try{if(!t||!e)return!1;const i=33,s=126,o=/[?&#%\\]/;for(let e=0;e<t.length;e+=1){const n=t.charCodeAt(e);if(n<i||n>s)return!1;const r=t.charAt(e);if(o.test(r))return!1}const n="api:",r="https:";let a=t;a.substring(0,n.length).toLowerCase()===n&&(a=`${r}${a.substring(n.length)}`);const c=new URL(a);return c.protocol===r&&e.toLowerCase()===c.origin.toLowerCase()}catch{return!1}}class Pt{get diagnostics(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}}raiseEvent(t,e){this.logger.ULS.ke(574654541,C.X,y.Info,`Raising event: ${t}`);try{this.Er(t,e)}catch(t){this.logger.ULS.ke(593506838,C.X,y.Error,`Event handler error: ${J(t)}`)}}addActionHandler(t,e){this.Pr[t]||(this.Pr[t]=[]),this.Pr[t].push(e)}removeActionHandler(t,e){const i=this.Pr[t];if(i&&i.length>0){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}run(t,e,i){if(this.state===b.Disposed&&this.backgroundSession)return this.logger.ULS.ke(525203609,C.X,y.Info,`Redirecting to background session: ${t}`),this.backgroundSession.run(t,e,i);const s=[],o=this.Pr[t];if(o&&o.length>0)s.push(this.Ur(t,e));else{const o=it[t];if(o){const n=o.gr,r=o.Sr;if(n){this.logger.ULS.ke(574654542,C.X,y.Info,`Running flow: ${n}`);const o=this.Rr[n](t,e,this,this.Wr[n],i).catch((t=>(this.Fr(n,t),{completion:"failure",errorSource:"jsapi",error:t})));s.push(o)}else r&&(this.container&&this.container.postMessage(r,e),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.ke(593500189,C.X,y.Warning,`Unhandled command: ${t}`)}return Promise.race(s)}dispose(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.Ne.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.Pr={},!this.pendingReboot){const t=this.application.sessions,e=t.indexOf(this.session);e>-1&&t.splice(e,1)}}constructor(t,e,i,s,o,n,r){this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.appBootState="Unknown",this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.Pr={},this.onMessage=t=>{const e=t.MessageId,i=t.Values||{},s=this.Pr[e];if(s&&s.length>0)this.Ur(e,i);else{const s=it[e];if(s){const o=s.gr,n=s.vr;o?(this.logger.ULS.ke(574654543,C.X,y.Info,`Running flow: ${o}`),this.Rr[o](e,i,this,this.Wr[o]).catch((t=>{this.Fr(o,t)}))):n&&(n===et.Share&&(i.sendTimeAsClickTime=t.SendTime),this.raiseEvent(n,i))}}},this.Fr=(t,e)=>{this.logger.ULS.ke(596459925,C.X,y.Error,`${t} flow error: ${J(e)}`),this.remoteTelemetryUrl&&O(this.remoteTelemetryUrl,this.appInfo.name,"flowException")},this.Ur=(t,e)=>{this.logger.ULS.ke(574654544,C.X,y.Info,`Dispatching action: ${t}`);const i=this.Pr[t].slice().reverse();for(let s=i.length-1;s>-1;s-=1)try{i[s](t,e)}catch(e){this.logger.ULS.ke(596444186,C.X,y.Error,`${t} action handler error: ${J(e)}`)}return Promise.resolve({completion:"success"})},this.state=b.Unknown;const[a,c]=st();this.isLoggerFromOwl=!!i.logger,this.logger=i.logger??B(),this.logger.ULS.ke(593506837,C.X,y.Info,JSON.stringify(c)),this.sessionId=a,this.hostSessionId=i.hostSessionId,this.host=t.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=t.user,this.bootstrapperUrl=t.bootstrapperUrl,this.ui=t.ui||{},this.viewMode=t.viewMode,this.application=s,this.appInfo=e,this.session=o,this.featureManager=G(t.host.capabilities&&t.host.capabilities.isFeatureEnabledCallback,this.logger),this.Ne=new Z(e.name,this.logger),this.preloader=e.preloader,[this.Rr,this.Wr]=n(this.featureManager),this.Er=r,this.clientDiagnostics=St(),this.pageStateObserver=new bt(this.logger,!0),this.authTokenTrustValidator=new At(this.logger)}}class Ut{get id(){return this.Or.sessionId}get diagnostics(){return this.Or.diagnostics}run(t,e,i){return this.Or.run(t,e,i)}boot(t,e){return this.Or.run(Q.boot,t,e)}dispose(t){return this.Or.run(Q.dispose,void 0,t)}constructor(t,e,i,s,o,n){!function(t){if(!t)throw new TypeError("SessionInitParams");if(!t.hostSessionId)throw new TypeError("HostSessionId")}(i),this.Or=new Pt(t,e,i,s,this,n,((t,e)=>o({type:t,data:e,session:this}))),this.Or.state=b.Initialized}}const Rt=365,Wt=864e5;function Ft(t){if(!t)return"";const e=""+document.cookie,i=new RegExp("(?:^|; )"+t+"=([^;]*)"),s=e.match(i);return!s||s.length<2?"":s[1]}function Ot(t,e,i,s=Mt.none,o){const n=t+"="+e;let r="";const a=new Date;a.setTime(a.getTime()+Rt*Wt);let c=new Date;c.setTime(c.getTime()+i*Wt),c>a&&(c=a),c&&(r=";expires="+c.toUTCString());const h=n+r+";SameSite="+Mt[s];return document.cookie=o?h+"; Secure":h,!(!document.cookie||-1===document.cookie.indexOf(n))||s===Mt.none&&Ot(t,e,i,Mt.doNotSet,o)}var Mt,kt;!function(t){t[t.doNotSet=0]="doNotSet",t[t.none=1]="none",t[t.lax=2]="lax",t[t.strict=3]="strict"}(Mt||(Mt={}));class Nt{setTargetOrigin(t){const e=h(t).toLowerCase();this.Mr&&this.Mr!==e&&this.us.ULS.ke(593232847,C.X,y.Warning,`Updating origin: [${v(this.Mr)}]->[${v(e)}]`),this.Mr=e,this.kr=d(e,2),this.Nr=n(e),this.$r=r(e)}setTargetFrame(t,e){this.Hr=t,this.Dr=!!e}setMessageHandler(t){this.Vr=t}removeMessageHandler(){this.Vr=void 0}postMessage(t,e,i){if(!this.Hr||!this.Hr.contentWindow)return void this.us.ULS.ke(593232848,C.X,y.Error,"Missing target to send message: "+t);this.us.ULS.ke(593232849,C.X,y.Info,"Sending message: "+t);const s={MessageId:t,SendTime:N(),CorrelationId:i,Values:e};this.Hr.contentWindow.postMessage(JSON.stringify(s),this.Mr)}dispose(){window.removeEventListener("message",this.Br,!1),this.Vr=void 0}constructor(t,e,i,s){this.Mr="",this.kr="",this.Nr=!1,this.$r=!1,this.Dr=!1,this.Lr=!1,this.Br=t=>{let e,i=!1,s=!0,o="",n=!1;if(this.Hr&&this.Hr.contentWindow&&(i=!0,s=t.source===this.Hr.contentWindow),t.origin&&(o=d(t.origin,2).toLowerCase(),n=o===this.kr,!n&&this.Jr&&(o=d(t.origin).toLowerCase(),n=this.Jr.includes(o))),!this.Nr&&(!this.$r||n&&s)||this.us.ULS.ke(593232850,C.X,y.Info,"Window: available["+i+"] valid["+s+"]; Origin: valid["+n+"] expected["+this.kr+"] actual["+o+"]"),!n||this.Dr&&!s)return;try{if("string"!=typeof t.data)return void this.us.ULS.ke(505771930,C.X,y.Info,"Event data is not of type string");e=JSON.parse(t.data)}catch(t){return void this.us.ULS.ke(593232851,C.X,y.Info,`Failed to parse event data: ${J(t)}`)}const r=e.MessageId;if(r){if(this.us.ULS.ke(593232854,C.X,y.Info,`Received message: ${r}, correlation: ${e.CorrelationId}`),r!==Y.bs&&r!==Y.qs||this.setTargetOrigin(t.origin),e.Values&&e.Values.ackExpected&&this.postMessage(tt.Sn,void 0,e.CorrelationId),this.Lr&&r===Y.an)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[e.Values.name]=e.Values.time);if(this.Vr)try{this.Vr(e)}catch(t){this.us.ULS.ke(594556386,C.X,y.Error,`Message handler error: ${J(t)}`)}else this.us.ULS.ke(591933923,C.X,y.Error,"No message handler")}else(this.Nr||this.$r)&&this.us.ULS.ke(593232853,C.X,y.Info,"Missing message id")},this.us=e,this.setTargetOrigin(t),this.Jr=s,i&&this.setMessageHandler(i),this.Lr=!!window.location?.search?.match(/wdpa=1/gi)||"1"===Ft("EnableMetricLogging"),window.addEventListener("message",this.Br,!1)}}function xt(t,e){at()===ot.Safari?t.style.display=e?"none":"block":t.style.visibility=e?"hidden":"visible"}function $t(t,e,i){l(e,kt.Gr,String(i?window.outerHeight:t.offsetHeight)),l(e,kt.zr,String(i?window.outerWidth:t.offsetWidth)),l(e,kt.qr,String(ct())),l(e,kt.jr,String(ht())),l(e,kt.Kr,String(ut())),l(e,kt.Zr,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}}())),l(e,kt.Xr,String(function(){try{return window.matchMedia("(prefers-contrast: more)").matches}catch{return!1}}())),l(e,kt.Qr,String(function(){try{return window.matchMedia("(forced-colors: active)").matches||window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}())),l(e,kt.Yr,String(window.innerHeight)),l(e,kt.ta,String(window.innerWidth))}function Ht(t){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(e){return t&&t.ULS.ke(591525084,C.X,y.Info,`Trust check error: ${J(e)}`),!1}}!function(t){t.ea="access_token",t.ia="access_token_ttl",t.sa="wac_token",t.oa="bundleSrc",t.na="bundleStaleness",t.ra="DocID",t.ca="SiteID",t.ha="WebID",t.da="ETag",t.la="feature_status",t.ua="fileExtension",t.pa="fileGetUrl",t.ma="customFontCatalogUrl",t.fa="fileName",t.wa="fileSize",t.Kr="forceSLR",t.Gr="frameHeightPx",t.zr="frameWidthtPx",t.jr="highContrast",t.ga="highDpi",t.Sa="host_diagnostics",t.va="hostName",t.Ia="huictrls",t._a="owner_id",t.ba="sc",t.Ca="softBlockedBrowser",t.Ta="templateUrl",t.qr="touchMode",t.ya="user_id",t.Aa="hfck",t.Ea="hfcv",t.Pa="timeZoneId",t.Zr="darkCssMedia",t.Qr="forcedColors",t.Xr="prefersContrast",t.Ua="caae",t.Ra="meetingId",t.Wa="meetingTitle",t.Fa="meetingType",t.Oa="scheduledStartTime",t.Ma="scheduledEndTime",t.ka="isPresenter",t.Na="meetingOrganizerId",t.xa="meetingJoinUrl",t.$a="isMeetingTeamsRoom",t.Ha="jsapibuild",t.Da="owlver",t.Va="owlro",t.Ba="caaemode",t.La="traceparent",t.Ja="tracestate",t.Ga="supports_zipit",t.za="sipcn",t.qa="devcs",t.ja="dceit",t.Yr="frameInnerHeightPx",t.ta="frameInnerWidthPx"}(kt||(kt={}));class Dt{get element(){return this.Ka}get frameId(){return this.Za}get formId(){return this.Xa}get isTopFrameTrusted(){return this.Qa}boot(t,e,i,s,o,n,r){this.us=i,this.Ya=new Nt(t,i,this.Vr,s.additionalReceivingDomainList);const a=s.useAdditionalDiv,c=s.permissionsPolicy;this.tc&&!a?(this.tc.setAttribute("allow",c),this.us.ULS.ke(588793045,C.X,y.Info,"Wac frame reused")):(this.tc=function(t,e,i,s,o,n,r,a,c,h){t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.width="100%";const d=t.ownerDocument,l=d.createElement("iframe");if(l.id=e,l.name=e,l.src="",l.title="Office on the web Frame",l.marginWidth="0",l.marginHeight="0",l.style.top="0",l.style.bottom="0",l.style.left="0",l.style.right="0",l.style.height="100%",l.style.width="100%",l.style.display="block",l.style.position="absolute",l.style.backgroundColor="transparent",l.style.border="none",l.frameBorder="0",l.setAttribute("allowfullscreen","true"),l.setAttribute("allowTransparency","true"),l.setAttribute("allow",i),xt(l,r),s&&(t.style.minHeight=s,l.style.minHeight=s),o&&(t.style.minWidth=o,l.style.minWidth=o),a&&l.setAttribute("role","none"),n){const e=d.createElement("div");e.style.top="0",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.height="100%",e.style.width="100%",e.style.backgroundColor="#393a3d",e.style.backfaceVisibility="hidden",s&&(e.style.minHeight=s),o&&(e.style.minWidth=o),e.appendChild(l),t.appendChild(e)}else t.appendChild(l);return c&&l.addEventListener("load",c,{once:!0}),h&&l.addEventListener("error",h,{once:!0}),l}(this.Ka,this.Za,c,s.minHeight,s.minWidth,a,s.isInvisible,s.setNoneRole,n,r),this.us.ULS.ke(588793046,C.X,y.Info,"Wac frame created")),o(),this.Ya.setTargetFrame(this.tc,s.enforceSameWindow),a&&(this.ec=this.tc.parentElement),s.useFrameFixForTeams&&i.ULS.ke(509143245,C.X,y.Info,"Frame fix enabled for teams uiHost"),$t(this.tc,e,s.useFrameFixForTeams),e.parentOrigin=window.origin||"",this.ic=function(t,e,i,s,o){const n=t.ownerDocument,r=n.createElement("form");r.id=i,r.name=i,r.action=s,r.target=e,r.method="POST";for(const t in o){const e=n.createElement("input");e.type="hidden",e.name=t,e.value=o[t],r.appendChild(e)}return t.appendChild(r),r}(this.Ka,this.Za,this.Xa,t,e),this.ic.submit()}setVisibility(t){this.tc&&xt(this.tc,t)}setMessageHandler(t){this.Vr=t,this.Ya&&this.Ya.setMessageHandler(t)}setWrapperPostMessage(t){this.oc=t}removeMessageHandler(){this.Vr=void 0,this.Ya&&this.Ya.removeMessageHandler()}postMessage(t,e){this.oc?this.oc(t,e):this.Ya&&this.Ya.postMessage(t,e)}dispose(t,e){return new Promise((i=>{if(this.ic&&(this.Ka.removeChild(this.ic),this.ic=void 0),this.Ya&&(this.Ya.dispose(),this.Ya=void 0,this.Vr=void 0),this.oc&&(this.oc=void 0),this.us=void 0,!this.tc||!this.ec&&t)i();else{const t=()=>{this.ec?(this.ec.removeChild(this.tc),this.Ka.removeChild(this.ec)):this.Ka.removeChild(this.tc),this.tc=void 0,this.ec=void 0,i()};e?t():(this.tc.src="about:blank",window.setTimeout(t,0))}}))}constructor(t,e){!function(t){if(!t||!t.appendChild)throw TypeError("Container")}(t),this.Ka=t,this.Za=e,this.Xa=e+"_Form",this.Qa=Ht()}}class Vt{get name(){return this.nc.name}get version(){return U()}addEventListener(t){this.rc.add(t)}removeEventListener(t){this.rc.remove(t)}createContainer(t){const e=`WacFrame_${this.nc.name}_${this.containers.length}`,i=new Dt(t,e);return this.containers.push(i),i}createSession(t){const e=new Ut(this.cc,this.nc,t,this,this.hc,this.dc);return this.sessions.push(e),e}dispose(t){const e=this.sessions.map((e=>e.dispose(t).catch((t=>{}))));return Promise.all(e).then((t=>(this.rc.removeAll(),this.sessions=[],this.containers=[],{completion:"success"})))}constructor(t,e,i){this.sessions=[],this.containers=[],this.hc=t=>{this.rc.dispatch(t)},function(t){if(!t)throw new TypeError("ApplicationInitParams");const e=t.host;if(!e||!e.storageHostName)throw new TypeError("HostInfo");const i=t.user;if(!i||null==i.id)throw new TypeError("UserInfo")}(t),this.cc=t,this.nc=e,this.dc=i,this.rc=new q,function(t){if(t&&(P.BUILD_NUMBER=t,t.includes("."))){const e=t.split(".");P.BUILD_NUMBER_MINOR=parseInt((e[0]||"").concat((e[1]||"").padStart(3,"0")),10)}}(t.host.owlVersion)}}function Bt(t,e,i,s){const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{s&&s(o)}finally{null!=o&&(o.onreadystatechange=()=>{})}}},o.open("POST",t);for(const t in i)o.setRequestHeader(t,i[t]);o.send(e)}let Lt=!1,Jt=!1;function Gt(){Lt=!1}function zt(t,e,i,s,o,n,r){if(e.ULS.ke(595714433,C.X,y.Important,`Starting disposing the application. unloadApp:${t}; disposed:${Lt}; unloading:${Jt}`),Lt||Jt&&t)return void e.ULS.ke(595714908,C.X,y.Info,"Application is already disposed or unloading");const a={logger:e,postMessenger:i,innerApplicationFrame:s,onDisposed:o,onFrameRemoved:n,unloadTimeoutInMs:r||1e3,forceAppUnload:!1,disposeStartTime:N(),appUnloadTimedOut:!1};if(t&&s)return Jt=!0,a.forceAppUnload=!0,(c=a).forceAppUnloadStartTime=N(),c.logger.ULS.ke(595855490,C.X,y.Info,"Sending postmessage to unload app"),c.logger.ULS.flush(),c.postMessenger.registerMessagePayloadHandler(Y.wo,(t=>function(t,e){t.forceAppUnloadEndTime=N(),t.appUnloadedMessageValues=e,t.logger.ULS.ke(595855491,C.X,y.Info,"AppUnloaded received from app"),qt(t)}(c,t))),c.postMessenger.sendPostMessage(c.innerApplicationFrame,tt.nr,{}),void window.setTimeout((()=>function(t){!Jt&&Lt||(t.appUnloadTimedOut=!0,t.logger.ULS.ke(595855492,C.X,y.Info,"ApplicationUnload timed out, forcing dispose"),qt(t))}(c)),c.unloadTimeoutInMs);var c;qt(a)}function qt(t){if(!Lt)try{Lt=!0,Jt=!1,function(t){t.innerApplicationFrame&&(t.innerApplicationFrame.src="about:blank",window.setTimeout((()=>{t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame),t.onFrameRemoved&&t.onFrameRemoved()}),0))}(t),function(t){const e={disposeStartTime:t.disposeStartTime,disposeEndTime:N(),forceAppUnload:t.forceAppUnload,appUnloadTimedOut:t.appUnloadTimedOut};if(t.forceAppUnloadStartTime&&(e.appUnloadStartTime=t.forceAppUnloadStartTime),t.forceAppUnloadEndTime&&(e.appUnloadEndTime=t.forceAppUnloadEndTime),t.appUnloadedMessageValues){const i=t.appUnloadedMessageValues,s=Number(i.hostMessageReceived);t.forceAppUnloadStartTime&&!isNaN(s)&&(e.hostToAppPostMessageLatency=s-t.forceAppUnloadStartTime);const o=Number(i.appMessageSent);!isNaN(o)&&t.forceAppUnloadEndTime&&(e.appToHostPostMessageLatency=t.forceAppUnloadEndTime-o);const n=Number(i.appUnloadStart),r=Number(i.appUnloadEnd);if(isNaN(n)||isNaN(r)||(e.appUnloadLatency=r-n),i.serverTimings){const t=i.serverTimings;for(const i in t)e["st-"+i.toString()]=t[i]}}t.logger.ULS.ke(595855436,C.X,y.Info,"App disposed "+JSON.stringify(e)),t.logger.ULS.flushOnClose()}(t),t.onDisposed&&t.onDisposed()}catch(e){t.logger.ULS.ke(595714434,C.X,y.Error,`Error disposing: ${J(e)}`)}}var jt;!function(t){t.AppInitError="AppInitError",t.ApiDisabledError="ApiDisabledError",t.CannotLoadFirstPage="CannotLoadFirstPage",t.InvalidWopiInfo="InvalidWopiInfo",t.TimeoutWacReady="TimeoutWacReady",t.WacFailed="WacFailed"}(jt||(jt={}));class Kt{}Kt.logger=B();class Zt{constructor(t){this.lc={},this.resetCache=()=>{if(!this.uc)return!1;try{return localStorage.removeItem(this.dataSettingsCacheKey),!0}catch(t){return Kt.logger.ULS.ke(557114832,C.X,y.Error,`${this.dataSettingsCacheKey}: Failure trying to Delete data in localStorage: ${J(t)}`),!1}},this.setCache=t=>{if(t&&this.uc)try{localStorage.setItem(this.dataSettingsCacheKey,JSON.stringify(t))}catch(t){Kt.logger.ULS.ke(557114833,C.X,y.Error,`${this.dataSettingsCacheKey}: Error while saving settings in cache: ${J(t)}`)}},this.getIntegerSetting=t=>{const e=this.mc(t);if(null!=e&&"number"==typeof e){const t=e;if(!isNaN(t))return t}return null},this.getBooleanSetting=t=>{const e=this.mc(t);return null!=e&&"boolean"==typeof e?e:null},this.getStringSetting=t=>{const e=this.mc(t);return null!=e&&"string"==typeof e?e:null},this.mc=t=>{if(!this.uc)return null;try{if(t in this.lc)return this.lc[t];const e=localStorage.getItem(this.dataSettingsCacheKey);if(null!==e){const i=JSON.parse(e)[t];return this.lc[t]=i,i}}catch(e){Kt.logger.ULS.ke(557114834,C.X,y.Error,`${this.dataSettingsCacheKey}: Failure trying to find ${t} setting in localStorage: ${J(e)}`)}return null},this.dataSettingsCacheKey=t,this.uc=!1;try{localStorage&&(this.uc=!0)}catch(t){Kt.logger.ULS.ke(538018719,C.X,y.Warning,`Local storage not supported: ${J(t)}`)}}}class Xt extends Zt{static get Instance(){return Xt.fc||(Xt.fc=new Xt)}constructor(){super(Xt.wc)}}Xt.wc="OneNote_hostUtilsSettingsCache";const Qt="Word";function Yt(t,e){return t+o+(e?"?usid="+e:"")}function te(t,e){return Yt(ie(t),e)}function ee(t,e,i,s,o,n=!1){t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,e){const i=t.SessionInformation;if(i.WdParams||(i.WdParams={}),i.WdParams.wd)return;e.substring(1).split("&").filter((t=>{if(0===t.indexOf("wd")){const e=t.split("=");e[0].length>2&&(i.WdParams[e[0]]=e[1])}}));const s=t.RebootOverrideData;s&&s.previousSessionId&&(i.WdParams.wdprevioussession=s.previousSessionId),Xt.Instance.getBooleanSetting("OneNoteHostSessionOriginFixEnabled")}(t,window.location.search);const r=o||new Z(Qt,i),a=ie(t.ApplicationUrl);return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:t.Diagnostics,ClientDiagnostics:St(),AppInitDiagnostics:{officeSessionId:e,officeBootstrapperVersion:U(),hostName:t.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:e,applicationBasePath:a,remoteTelemetryUrl:Yt(a,e),wopiInfo:t.WopiInfo,forceSingleStepBoot:n,isCreateNew:t.WopiPrecheckInfo.IsNewFile||g(t.ApplicationUrl,"new"),featureManager:s||G(t.FnIsFeatureEnabled,i),Ne:r,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData,pageStateObserver:new bt(i,!0),canSupportInteractiveReadOnly:!1}}function ie(t){const e=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function se(t,e){e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach((i=>t[i]=e.Diagnostics[i]))}function oe(t,e,i){e.ULS.ke(596459999,C.X,i,"SessionTraces: "+JSON.stringify(t))}function ne(t,e){e.stop();const i=e.getVisibilityChangeEvents();null!=i&&i.length>0&&(t.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,t.SessionTraces.tabSwitchDiagnostics=JSON.stringify(i)),e.dispose()}function re(t,e,i){try{const s=function(t,e){const i={...e};delete i.UserId,delete i.OwnerId,delete i.SiteId,delete i.WebId,delete i.Upn,delete i.TenantId,delete i.UiHostTabId,delete i.OriginalWdParam,delete i.WdParams;const s=i,o=e.WdParams?JSON.parse(JSON.stringify(e.WdParams).toLowerCase()):{};s.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((t=>{o[t]&&(s.WdParams[t]=o[t])}));const n=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return s.WdParams.wdprevioussession&&!n.test(s.WdParams.wdprevioussession)&&delete s.WdParams.wdprevioussession,s.WdParams.wdpreviouscorrelation&&!n.test(s.WdParams.wdpreviouscorrelation)&&delete s.WdParams.wdpreviouscorrelation,s.UiEmbedMode=g(t,"uiembed"),s.UiHostName=p(t,"uih")||"N/A",s.HostDomain=location?location.hostname:"",s}(e.applicationUrl,e.sessionInformation);s.Build=U(),s.Region=a(e.applicationUrl);const o={...e.rebootOverrideData};delete o.ackExpected,delete o["ui-language"],delete o.wdUserSession,delete o.rebootMode,delete o.documentUrl,s.RebootOverride=o;const n=e.diagnostics.HostInitDiagnostics;n&&(t.ULS.ke(596444238,C.X,y.Info,"HostInitDiagnostics: "+JSON.stringify(e.diagnostics.HostInitDiagnostics)),s.SessionOrigin=n.entryPoint),i&&t.ULS.ke(595937313,C.X,y.Info,JSON.stringify(i));const r=e.wopiInfo;r&&r.AccessToken&&r.AccessTokenExpiry||t.ULS.ke(595894553,C.X,y.Warning,"There are some missing parameters"),r&&(r.AccessToken&&(s.AccessTokenLength=r.AccessToken.length),s.AccessTokenExpiry=r.AccessTokenExpiry,r.WacToken&&(s.WacTokenLength=r.WacToken.length)),"Microsoft Teams"===e.sessionInformation.HostName&&t.ULS.ke(507122579,C.X,y.Important,"Word setting Force View only for Teams WXP Files session."),s.JsApiVersion="v1",t.ULS.ke(596444237,C.X,y.Important,JSON.stringify({session:s,client:e.diagnostics.ClientDiagnostics}))}catch(e){t.ULS.ke(558155802,C.X,y.Error,`Failed to log initialization info: ${J(e)}`)}}const ae="word-edit",ce="/we/",he="wordeditorframe.aspx",de=ce+he,le="wordeditorstartsession.ashx",ue="word-view",pe="/wv/",me="wordviewerframe.aspx",fe=pe+me;function we(t,e=!1){return e?t.indexOf(ae)>-1||t.toLowerCase().indexOf(he)>0:t.toLowerCase().indexOf(de)>0}function ge(t){return t.toLowerCase().indexOf(me)>0}function Se(t,e=!1){let i=t;return i=i.replace(new RegExp(ae,"i"),ue),i=i.replace(new RegExp(de,"i"),fe),e&&(i=m(i,"WordEditorFailedToLoad","1")),i}function ve(t){let e=t;return e=e.replace(new RegExp(ue,"i"),ae),e=e.replace(new RegExp(fe,"i"),de),e}function Ie(t,e,i){if(void 0!==t){if("1"===t)return!0;if("0"===t)return!1}let s;return!("undefined"==typeof window||!window.navigator?.userAgent)&&(s=window.navigator.userAgent.toLowerCase(),!!function(t,e,i){if(!t)return!1;const s=t.toLowerCase();return!!(e.includes("ipad")||e.includes("macintosh"))&&(i.isTeamsEnabled&&s.includes("teamsipad")||i.isM365Enabled&&s.includes("m365ipad")||i.isOnedriveEnabled&&s.includes("onedriveipad"))}(e,s,{isOutlookEnabled:i.getValue(D.Oi,!1),isTeamsEnabled:i.getValue(D.Fi,!1),isOnedriveEnabled:i.getValue(D.Mi,!1),isM365Enabled:i.getValue(D.ki,!1)})||!(s.indexOf("ipad")>=0)&&(s.indexOf("silk")>=0||(s.includes("android")&&!s.includes("iemobile")?!(s.includes("chrome")&&!s.includes("mobile")):pt()||/android.+mobile/i.test(nt.userAgent))))}function _e(t,e,i,s){let o=!1;const n=t.container?.baseURI,r=("embed.aspx",!!(a=n)&&a.includes("embed.aspx"));var a;const c=!(!t.isCreateNew||t.wopiInfo),h=!(!t.sessionInformation.WdParams||"1"!==t.sessionInformation.WdParams.wdembedfs),d="docx"===L(t.wopiPrecheckInfo.FileName),l=!(!t.sessionInformation.WdParams||"1"!==t.sessionInformation.WdParams.wdreadingview),u=t.Ne.getValue(D.Pi,!1),m=t.sessionInformation.WdParams?.wdmobile,f=Ie(m,t.Ne.getValue(D.Ri,!1)?p(t.applicationUrl,"uih"):void 0,t.Ne);if(o=(!e||u&&f)&&!i&&!r&&(c||d)&&!h&&!l,!o){const t={isUiEmbedModeApplicationUrl:e,isEmbedActionApplicationUrl:i,baseUrlIsForEmbedEndpoint:r,isCreateNewWithoutWopiInfo:c,isEmbeddedFullScreen:h,isFileDocx:d,isReadingViewMode:l};s.ULS.ke(505996418,C.X,y.Important,`canSupportInteractiveReadOnly is false. DebugInfo: ${JSON.stringify(t)}`)}return o}function be(t,e,i){const s=t.featureManager.isFeatureEnabled(V.Zi),o=t.Ne.getValue(D.Ei,!1),n=((s||o)??!1)&&t.canSupportInteractiveReadOnly&&e;if(e&&!n){const e={canSupportInteractiveReadOnly:!!t.canSupportInteractiveReadOnly,interactiveReadOnlyFlightValue:s,interactiveReadOnlySettingValue:o};i.ULS.ke(505996417,C.X,y.Important,`interactive read only  redirection will not happen. DebugInfo: ${JSON.stringify(e)}`)}return n&&i.ULS.ke(505529752,C.X,y.Important,"Will redirect viewer request to unified read"),n}function Ce(t,e,i){const s=t.Ne.getValue(D.Wi,!1),o=t.sessionInformation.WdParams?.wdmobile,n=t.Ne.getValue(D.Ri,!1)?p(t.applicationUrl,"uih"):void 0,r=Ie(o,n,t.Ne),a=s&&t.canSupportInteractiveReadOnly&&e&&r;if(e&&!a){const e={canSupportInteractiveReadOnly:!!t.canSupportInteractiveReadOnly,isMobileRedirectionSettingEnabled:s,isMobileModeRequested:r,wdMobile:o,uiHost:n};i.ULS.ke(504988676,C.X,y.Important,`intractive read only  redirection will not happen. DebugInfo: ${JSON.stringify(e)}`)}return a&&i.ULS.ke(504988675,C.X,y.Important,"Will redirect mobile viewer request to unified read"),a}var Te;!function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",t.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect",t.wordMobileUnifiedReadRedirect="WordMobile_UnifiedReadRedirect"}(Te||(Te={}));const ye="WebApplicationFrame",Ae="office_form";function Ee(t,e,i=!1){let s=t.applicationUrl,o={};if("Microsoft Teams"===t.sessionInformation.HostName&&(o.fvo="1",o.readOnly="1",t.wopiPrecheckInfo.ReadOnly&&(o.mode="Read")),t.sessionInformation.UseBizChatTheme&&(o.ubct="1"),o.jsApi="1",o.jsapiver="v1",i&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,o.sftc="1",t.applicationCustomSettings&&t.applicationCustomSettings.IsCore&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAtMentions&&(o.sams="1"),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){const e=t.sessionInformation.SupportsDocReboot;o.sdr=!0===e?"1":e.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.SupportsAuthToken&&(o.sat="1"),window.docAspxMsalEnabled&&"onedrivecom"!==f(t.applicationUrl).uih&&(t.sessionInformation.AuthTokenStrategy="PairwiseBroker"),t.sessionInformation.AuthTokenStrategy&&(o.ats=t.sessionInformation.AuthTokenStrategy),t.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),t.sessionInformation.TopOrigin&&(o.to=encodeURIComponent(t.sessionInformation.TopOrigin)),t.sessionInformation.IsDeeplyNestedAuthSupportedInTeams&&(o.dnaa="1"),t.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),t.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),t.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),t.sessionInformation.UseDarkTheme&&(o.udt="1"),(t.sessionInformation.HideHeader||"DocGen"===t.sessionInformation.ContentAssemblyMode||"Templatization"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===t.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),t.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),t.sessionInformation.HideChatInHeader&&(o.hch="1"),t.sessionInformation.HideMeInHeader&&(o.hmh="1"),t.sessionInformation.HideSearchInHeader&&(o.hsh="1"),t.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),t.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),t.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),t.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),t.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),t.sessionInformation.HideTitleInViewer&&(o.htv="1"),t.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),t.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),(t.wopiPrecheckInfo.ReadOnly||e.bootFlowType===Te.wordViewToUnifiedReadRedirect||e.bootFlowType===Te.wordMobileUnifiedReadRedirect)&&(o.readOnly="1",t.wopiPrecheckInfo.ReadOnly&&(o.mode="Read")),"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),e.bootFlowType!==Te.wordViewToUnifiedReadRedirect&&e.bootFlowType!==Te.wordMobileUnifiedReadRedirect||(o.iro="1"),t.canSupportInteractiveReadOnly&&(o.csiro="1"),e.bootFlowType===Te.wordMobileUnifiedReadRedirect&&(o.mobile="1",o.hhdr="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.sessionInformation.IsSynthetic&&(o.syn="1"),t.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),t.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),t.sessionInformation.DisableOfficeAddins&&(o.doa="1"),t.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(t.sessionInformation.UiHostIntegrationType)),t.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(t.sessionInformation.MetaUiHostVersion)),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),e.isSingleStepBoot?(e.bootFlowType===Te.unifiedSingleFlush&&(t.isCreateNew||(o.instantedit="1",o.wopicomplete="1")),o.wdRedirectionReason=e.bootFlowType):(o.instantedit="1",o.fileSrc=encodeURIComponent(t.sessionInformation.HostName),o.pmOrigin=encodeURIComponent(h(window.location.href)),t.isCreateNew&&(o.new="1",t.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(o.wdTpl="fromhost"))),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o={...t.applicationCustomSettings.additionalApplicationParameters,...o}),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o={...o,...t.rebootOverrideData.queryOverrides}),t.sessionInformation.AfdFlighting&&(o.afdflight=Math.floor(100*Math.random()+1).toString()),function(t,e,i,s,o){let n=f(t);("teams"===n.uih&&"UnifiedUiHostTeams"!==e.UiHostIntegrationType&&"TeamsModern"!==e.UiHostIntegrationType||"owa"===n.uih)&&(n.hhdr="1");const r=t.indexOf("?"),a=-1===r?t.concat("?"):t.substring(0,r+1);e.UiLocale&&(n.ui=encodeURIComponent(e.UiLocale)),e.DataLocale&&(n.rs=encodeURIComponent(e.DataLocale)),e.HostSessionId&&(n.hid=encodeURIComponent(e.HostSessionId)),e.DisableChat&&(n.dchat="1"),e.SessionContext&&(n.sc=encodeURIComponent(e.SessionContext)),i&&i.WopiSrc&&(n.wopisrc=encodeURIComponent(i.WopiSrc)),e.CookieCompliant&&(n.mscc="1"),s&&(s.entryPoint&&(n.wdorigin=encodeURI(s.entryPoint)),s.userClickTime&&(n.wdhostclicktime=s.userClickTime.toString())),n={...n,...e.WdParams,...o};const c={};for(const t in n)c[t.toLowerCase()]=n[t];const h=[];for(const t in c)c[t]&&h.push(t.concat("=",c[t]));return a.concat(h.join("&"))}(s,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitDiagnostics,o)}function Pe(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}const Ue={[Q.blurFocus]:tt._n,[Q.continueAccessibilityLoop]:tt.An,[Q.grabFocus]:tt.En,[Q.moveToFolder]:tt.Ks,[Q.popState]:tt.Fn,[Q.rename]:tt.Bn,[Q.sendAccessToken]:tt.Ln,[Q.sendAuthToken]:tt.Jn,[Q.sendCustomAuthConfig]:tt.Gn,[Q.sendEmbeddedViewUrl]:tt.qn,[Q.sendSessionInfo]:tt.jn,[Q.sendUserAccessAndPermissions]:tt.Kn,[Q.sendWopiInfo]:tt.Zn,[Q.sendDavUrl]:tt.Xn,[Q.completeSharedFilePicker]:tt.co,[Q.switchMode]:tt.sr,[Q.signalShared]:tt.cr};class Re{registerMessagePayloadHandler(t,e){if(this.gc[t])throw new Error("Duplicate registration!");this.gc[t]=e}removeMessageHandler(t){delete this.gc[t]}sendPostMessage(t,e,i){if(!t||!t.contentWindow)return void this.us.ULS.ke(595948308,C.X,y.Info,"Missing target for SendPostMessage");this.us.ULS.ke(596464334,C.X,y.Info,"Sending message: "+e);const s={MessageId:e,SendTime:N(),Values:i};this.Sc(t.contentWindow,JSON.stringify(s),this.Mr)}activate(t,e){this.vc=t,this.Dr=!!e,this.Ic||(window.addEventListener("message",this._c,!1),this.Ic=!0)}postMessageForCommand(t,e,i){const s=Ue[e];s?(this.us.ULS.ke(595702598,C.X,y.Info,`Sending message ${s} for command ${e}`),this.sendPostMessage(t,s,i)):this.us.ULS.ke(595702599,C.X,y.Warning,`No mapping for command ${e}`)}dispose(){this.gc={},this.Ic&&(window.removeEventListener("message",this._c,!1),this.Ic=!1)}constructor(t,e){if(this.Ic=!1,this.gc={},this.Mr="",this.kr="",this.Dr=!1,this.Nr=!1,this.$r=!1,this.Lr=!1,this.bc=[],this.Cc=!0,this.Tc=(t,e,i)=>{if(!t)return void this.us.ULS.ke(595736136,C.X,y.Info,"Missing target to send Ack back");const s={MessageId:tt.Sn,CorrelationId:i,SendTime:N()};this.us.ULS.ke(595732176,C.X,y.Info,"Sending Ack back"),t.postMessage(JSON.stringify(s),e)},this._c=t=>{let e,i=!1,s=!0,o="",n=!1;if(this.vc&&this.vc.contentWindow&&(i=!0,s=t.source===this.vc.contentWindow),t.origin&&(o=d(t.origin,2).toLowerCase(),n=o===this.kr,!n&&this.Jr&&(o=d(t.origin).toLowerCase(),n=this.Jr.includes(o))),!this.Nr&&(!this.$r||n&&s)||this.us.ULS.ke(595730526,C.X,y.Info,`Window is available: ${i}, window is valid: ${s}, origin is valid: ${n}, expected origin: ${this.kr}, actual origin: ${o}`),!n||this.Dr&&!s)return;try{e=JSON.parse(t.data)}catch(t){return void this.us.ULS.ke(596464282,C.X,y.Info,`Failed to parse event data: ${J(t)}.`)}const r=e.MessageId;if(!r)return void((this.Nr||this.$r)&&this.us.ULS.ke(595730520,C.X,y.Info,"Could not find message id"));if(this.us.ULS.ke(595714715,C.X,y.Info,`Received messageId: ${r}, correlation: ${e.CorrelationId}`),r!==Y.bs&&r!==Y.qs||this.yc(t.origin),this.Lr&&r===Y.an)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[e.Values.name]=e.Values.time);e.Values&&e.Values.ackExpected&&this.Tc(t.source,t.origin,e.CorrelationId);const a=this.gc[r];if(!a)return this.us.ULS.ke(596464289,C.X,y.Info,`No handler found for message id: ${r}`),void(this.Cc&&r===Y.Bs&&(this.bc.push(e),this.us.ULS.ke(543207888,C.X,y.Info,`Kept for later process: ${r}`)));this.us.ULS.ke(596464288,C.X,y.Info,`Processing message: ${r}`),r===Y.uo&&(e.Values={...e.Values||{},sendTimeAsClickTime:e.SendTime});try{a(e.Values||{})}catch(t){this.us.ULS.ke(593773704,C.X,y.Error,`Handler error: ${J(t)}`)}this.Cc&&r===Y.bs&&this.Ac()},this.Ac=()=>{this.Cc=!1,this.bc.forEach((t=>{const e=t.MessageId,i=this.gc[e];if(i){this.us.ULS.ke(543207890,C.X,y.Info,`Processing message after boot complete: ${e}`);try{i(t.Values||{})}catch(t){this.us.ULS.ke(543207891,C.X,y.Error,`Handler error: ${J(t)}`)}}else this.us.ULS.ke(543207889,C.X,y.Info,`No handler found after boot complete: ${e}`)})),this.bc=[]},this.Sc=(t,e,i)=>{t.postMessage(e,i)},this.yc=t=>{const e=t.toLowerCase();this.Mr&&this.Mr!==e&&this.us.ULS.ke(596128131,C.X,y.Warning,`Updating origin: [${v(this.Mr)}]->[${v(e)}]`),this.Mr=e,this.kr=d(e,2),this.Nr=n(e),this.$r=r(e)},!t)throw new Error("Missing origin for PostMessageHandler");this.Nr=n(t),this.$r=r(t),this.us=e,this.yc(t),this.Lr=!!window.location?.search?.match(/wdpa=1/gi)||"1"===Ft("EnableMetricLogging")}}const We="Boot_HeartBeat",Fe="_FrameError";class Oe{setFrameError(){this.Ec=!0}setTimeoutStage(t){this.Pc=t,this.Uc=We+"_"+t+(this.Ec?Fe:"")}restart(){const t=this.Rc.getValue(D.Ke,!1);this.Wc=k()+(this.Fc?this.Fc:this.Rc.getValue(D.Be,6e5));const e=this.Nr?3e3:5e3;this.Oc=window.setInterval((()=>{t&&this.us.ULS.ke(595724178,C.X,y.Info,this.Uc),k()>this.Wc&&(this.stop(),this.Mc(),this.kc&&this.kc())}),this.Rc.getValue(D.je,e)),this.Nc.push(window.setTimeout(this.Mc,this.Rc.getValue(D.Le,3e4),1)),this.Nc.push(window.setTimeout(this.Mc,this.Rc.getValue(D.Je,12e4),2)),this.Nc.push(window.setTimeout(this.Mc,this.Rc.getValue(D.Ge,18e4),3))}stop(){this.Wc=0,this.Oc&&(window.clearInterval(this.Oc),this.Oc=void 0),this.Nc.forEach((t=>{window.clearTimeout(t)})),this.Nc=[]}constructor(t,e,i,s,o){this.Wc=0,this.Nc=[],this.Nr=!1,this.Uc=We,this.Ec=!1,this.Pc="FrameCreated",this.Mc=t=>{const e="Boot_NotComplete_"+(t||"Final")+"_"+this.Pc+(this.Ec?Fe:"");this.us.ULS.ke(594901218,C.X,y.Warning,e),this.us.ULS.flush()},this.Nr=t,this.Rc=e,this.us=i,this.kc=s,this.Fc=o,this.restart()}}function Me(t){localStorage.setItem(t.flightKey,t.flightValue.toString())}const ke=(t,e,i,s,o)=>t!==Y.un?Promise.reject("Wrong flow"):new Promise((t=>{const s=e.flightKey,o=e.flightValue;i.logger.ULS.ke(507343134,C.Wt,y.Info,`setWacFlightValue ${s}: ${o}`),Me(e),t({completion:"success"})}));function Ne(t){const e=window.navigator;if(e&&e.virtualKeyboard&&void 0!==e.virtualKeyboard.overlaysContent&&window===top)return e.virtualKeyboard.overlaysContent=t}const xe=(t,e,i,s,o)=>t!==Y.lo?Promise.reject("Wrong flow"):new Promise((t=>{Ne(e.overlayContent),i.container&&i.container.postMessage(tt.er,void 0),t({completion:"success"})}));function $e(t){return Ft(t.hostKey)}const He=(t,e,i,s,o)=>t!==Y.Js?Promise.reject("Wrong flow"):new Promise((t=>{const s=e.hostKey;i.logger.ULS.ke(574408915,C.X,y.Info,`getHostKeyValue ${s}`);const o=$e(e);i.container&&i.container.postMessage(tt.Un,{hostKey:s,hostValue:o}),t({completion:"success"})}));function De(t){Ot(t.hostKey,t.hostValue,Rt)}const Ve=(t,e,i,s,o)=>t!==Y.fo?Promise.reject("Wrong flow"):new Promise((t=>{const s=e.hostKey,o=e.hostValue;i.logger.ULS.ke(574408914,C.X,y.Info,`storeHostKeyValue ${s}: ${o}`),De(e),t({completion:"success"})}));class Be{Boot(){this.us.ULS.ke(596444241,C.X,y.Info,"Initializing WAC frame");const t=Ee(this.xc,this.$c,!0),e=function(t,e){const i={};if(t.wopiInfo&&(i[kt.ea]=t.wopiInfo.AccessToken,i[kt.ia]=Pe(t.wopiInfo),t.wopiInfo.WacToken&&(i[kt.sa]=t.wopiInfo.WacToken)),t.wopiPrecheckInfo.BundleInfo&&t.wopiPrecheckInfo.BundleInfo.Url&&t.wopiPrecheckInfo.BundleInfo.Url.length>0)if(i[kt.oa]=t.wopiPrecheckInfo.BundleInfo.Url,null!=t.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==t.wopiPrecheckInfo.BundleInfo.BundleStaleness){const s=t.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();e.ULS.ke(593503580,C.X,y.Info,"Content bundle staleness - "+s),i[kt.na]=s}else e.ULS.ke(593503581,C.X,y.Info,"Content bundle staleness does not exist");if(t.wopiPrecheckInfo.FileGetUrl&&(i[kt.pa]=t.wopiPrecheckInfo.FileGetUrl),t.wopiPrecheckInfo.CustomFontCatalogUrl&&(i[kt.ma]=t.wopiPrecheckInfo.CustomFontCatalogUrl),t.wopiPrecheckInfo.FileName){const e=L(t.wopiPrecheckInfo.FileName);e&&(i[kt.ua]=e),i[kt.fa]=t.wopiPrecheckInfo.FileName}t.newFileTemplateSource&&t.newFileTemplateSource.FileSize?i[kt.wa]=t.newFileTemplateSource.FileSize.toString():t.wopiPrecheckInfo.FileSize&&(i[kt.wa]=t.wopiPrecheckInfo.FileSize.toString()),t.sessionInformation.UserId&&(i[kt.ya]=t.sessionInformation.UserId),t.sessionInformation.OwnerId&&(i[kt._a]=t.sessionInformation.OwnerId),t.sessionInformation.SessionContext&&(i[kt.ba]=t.sessionInformation.SessionContext),void 0!==t.sessionInformation.SupportsZipIt&&(i[kt.Ga]=t.sessionInformation.SupportsZipIt.toString()),t.diagnostics.HostInitDiagnostics&&(i[kt.Sa]=JSON.stringify({HostInitializeDiagnostics:t.diagnostics.HostInitDiagnostics,ClientDiagnostics:t.diagnostics.ClientDiagnostics})),i[kt.la]=z(t.featureManager,t.sessionInformation.WdParams),t.applicationCustomSettings&&t.applicationCustomSettings.HostUIControls&&(i[kt.Ia]=JSON.stringify(t.applicationCustomSettings.HostUIControls)),i[kt.ga]=String(window.devicePixelRatio>1.24),i[kt.Ca]=String(dt()),i[kt.va]=t.sessionInformation.HostName;const s=t.newFileTemplateSource;s&&s.FileGetUrl&&(i[kt.Ta]=s.FileGetUrl),s&&s.DocUniqueId?i[kt.ra]=s.DocUniqueId:t.wopiPrecheckInfo.DocUniqueId&&(i[kt.ra]=t.wopiPrecheckInfo.DocUniqueId),s&&s.ETag?i[kt.da]=s.ETag:t.wopiPrecheckInfo.ETag&&(i[kt.da]=t.wopiPrecheckInfo.ETag),"Templatization"!==t.sessionInformation.ContentAssemblyMode&&"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(i[kt.Ua]="1"),t.sessionInformation.ContentAssemblyMode&&(i[kt.Ba]=t.sessionInformation.ContentAssemblyMode);const o=t.sessionInformation.Meeting;o&&(o.id&&(i[kt.Ra]=o.id),o.title&&(i[kt.Wa]=o.title),o.type&&(i[kt.Fa]=o.type),o.scheduledStartTime&&(i[kt.Ma]=o.scheduledStartTime),o.scheduledEndTime&&(i[kt.Ma]=o.scheduledEndTime),o.joinUrl&&(i[kt.xa]=encodeURIComponent(o.joinUrl)),o.organizerId&&(i[kt.Na]=o.organizerId),o.isPresenter&&(i[kt.ka]=o.isPresenter.toString()),o.isMeetingTeamsRoom&&(i[kt.$a]=o.isMeetingTeamsRoom.toString()));const n=t.sessionInformation.OwlVersion;n&&(i[kt.Da]=n);const r=t.sessionInformation.OwlRollout;r&&(i[kt.Va]=r);const a=t.sessionInformation.SupportsInPlaceCreateNew;a&&(i[kt.za]=a.toString()),t.sessionInformation.DisableEmbedViewCodeSnippet&&(i[kt.qa]="1"),t.sessionInformation.DisableCoEditInTeams&&(i[kt.ja]="1"),i[kt.Ha]=U();const c=t.sessionInformation.TraceParent;if(c){i[kt.La]=c;const e=t.sessionInformation.TraceState;e&&(i[kt.Ja]=e)}return i}(this.xc,this.us);if(this.Hc.registerMessagePayloadHandler(Y._s,this.Dc),this.Hc.registerMessagePayloadHandler(Y.ys,this.Vc),this.xc.sessionInformation.SupportsFrameTrustCheck||this.Hc.registerMessagePayloadHandler(Y.Ds,this.Bc),this.Hc.registerMessagePayloadHandler(Y.lo,this.Lc),this.Hc.registerMessagePayloadHandler(Y.Js,this.Jc),this.Hc.registerMessagePayloadHandler(Y.fo,this.Gc),this.Hc.registerMessagePayloadHandler(Y.un,this.zc),this.$c.ignoreWacFramePostMessages||this.qc(n(t)),this.jc(t,e),this.$c.ignoreWacFramePostMessages){const t=this.Kc();this.Zc(t)}return this.us.ULS.ke(595661019,C.X,y.Info,"Created Wac Frame"),this.vc}constructor(t,e,i,s,o,n){if(this.Xc=!1,this.jc=(t,e)=>{this.Qc.officeFrameCreateTime=N(),this.Yc.frameCreateStartTime=this.Qc.officeFrameCreateTime;const i=this.xc.applicationCustomSettings&&this.xc.applicationCustomSettings.appFrameName;this.vc=function(t,e,i,s,o,n,r){const a=function(t,e,i){const s=t.ownerDocument.createElement("iframe");s.name=i||ye,s.id=ye,s.src="",s.title="Office Online Frame",s.width="100%",s.height="100%",s.marginWidth="0",s.marginHeight="0",s.style.left="0",s.style.top="0",s.style.right="0",s.style.bottom="0",s.style.display="block",s.style.position="absolute",s.style.backgroundColor="transparent",s.style.border="none",s.frameBorder="0",s.setAttribute("allowfullscreen","true"),s.setAttribute("allowTransparency","true");const o=h(e);return s.setAttribute("allow",`microphone ${o}; autoplay ${o}; camera ${o}; clipboard-read ${o}; clipboard-write ${o}; keyboard-map ${o}; display-capture ${o}`),t.appendChild(s),s}(t,e,r);return function(t,e,i,s){$t(t,s);const o=e.ownerDocument,n=o.createElement("form");n.id=Ae,n.name=Ae,n.action=i,n.target=t.name,n.method="POST";for(const t in s){const e=o.createElement("input");e.type="hidden",e.name=t,e.value=s[t],n.appendChild(e)}return e.appendChild(n),n.submit(),t}(a,t,e,i)}(this.xc.container,t,e,this.xc.featureManager,this.us,this.xc.sessionId,i),this.Hc.activate(this.vc)},this.qc=t=>{this.Hc.registerMessagePayloadHandler(Y.bs,this.th),this.Hc.registerMessagePayloadHandler(Y.Is,this.eh),this.Me=window.setTimeout(this.ih,15e3),this.sh=new Oe(t,this.xc.Ne,this.us,(()=>{O(this.xc.remoteTelemetryUrl,Qt,"bootTimeout")}))},this.zc=t=>{const e=t.flightKey,i=t.flightValue;this.us.ULS.ke(507343133,C.Wt,y.Info,`storeWacFlightKeyValue ${e}: ${i}`);try{Me(t)}catch(t){this.us.ULS.ke(507340380,C.Wt,y.Error,`Handler error: ${J(t)}`)}},this.Dc=t=>{const e=t&&t.state?t.state:"unknown";this.us.ULS.ke(595714271,C.X,y.Info,`WAC Boot App state:[${e}]`)},this.Bc=t=>{const e=Ht(this.us);this.us.ULS.ke(595653903,C.X,y.Info,`Top frame is trusted: ${e}`),this.oh(tt.Ds,{isTopFrameTrusted:e})},this.Lc=t=>{const e=Ne(t&&t.overlayContent);this.us.ULS.ke(587487432,C.X,y.Info,`Overlay content: ${e}`),this.oh(tt.er,void 0)},this.th=t=>{if(this.us.ULS.ke(595986314,C.X,y.Info,"Received wac complete message"),this.us.ULS.flush(),window.clearTimeout(this.Me),this.sh&&this.sh.stop(),this.Xc)return void this.us.ULS.ke(596444234,C.X,y.Info,"Received multiple wac complete or failure messages");this.Xc=!0,this.oh(tt.Cn,{}),se(this.Qc,t);const e=this.Kc();this.Zc(e),this.xc.Ne.getValue(D.Xe,!1)&&(this.xc.diagnostics.HostInitDiagnostics||(this.xc.diagnostics.HostInitDiagnostics={}),_t(this.xc.diagnostics.HostInitDiagnostics)),this.nh(this.xc.diagnostics)},this.Vc=()=>{this.us.ULS.ke(579342464,C.X,y.Info,"Received close tab message");try{window.close()}catch{this.us.ULS.ke(579213188,C.X,y.Warning,"Failed to close the browser tab")}},this.Kc=()=>({innerApplicationFrame:this.vc}),this.eh=t=>{if(this.us.ULS.ke(595986315,C.X,y.Error,"Received wac failed message"),this.us.ULS.flush(),window.clearTimeout(this.Me),this.sh&&this.sh.stop(),this.Xc)return void this.us.ULS.ke(596444235,C.X,y.Info,"Received multiple wac complete or failure messages");this.Xc=!0,this.oh(tt.bn,{});const e={errorType:jt.WacFailed,errorObject:{}};t&&(e.errorObject=t.Error,this.Yc.error=e),this.rh(e)},this.Jc=t=>{const e=t.hostKey;this.us.ULS.ke(574433173,C.X,y.Info,`GetHostKeyValue ${e}`);const i=$e(t);null!=i&&this.oh(tt.Un,{hostKey:e,hostValue:i})},this.Gc=t=>{const e=t.hostKey,i=t.hostValue;this.us.ULS.ke(574433174,C.X,y.Info,`storeHostKeyValue ${e}: ${i}`),De(t)},this.ih=()=>{this.Xc||this.us.ULS.ke(596444236,C.X,y.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.Yc))},this.nh=t=>{this.oh(tt.Rn,{HostInitializeDiagnostics:t.HostInitDiagnostics,ClientDiagnostics:t.ClientDiagnostics})},this.oh=(t,e)=>{this.vc&&this.vc.contentWindow?this.Hc.sendPostMessage(this.vc,t,e):this.us.ULS.ke(595955718,C.X,y.Info,"Attempted to send postmessage: "+t)},void 0===e)throw new TypeError("bootFlowInfo");if(e.isSingleStepBoot&&void 0===t.wopiInfo)throw new TypeError("wopiInfo");this.xc=t,this.$c=e,this.us=i,this.Hc=s,this.Zc=o,this.rh=n,this.Qc=t.diagnostics.AppInitDiagnostics,this.Yc=t.diagnostics.SessionTraces,this.Yc.wopiInitializeTime=N()}}class Le{Complete(t,e){if(this.hh)this.us.ULS.ke(596444184,C.X,y.Warning,"Complete called after Complete/Fail already called");else{this.us.ULS.ke(596444185,C.X,y.Info,"Complete called."),this.xc.diagnostics.HostInitDiagnostics&&(this.xc.diagnostics.HostInitDiagnostics.hostCompleteCallTime=N()),this.hh=!0,this.dh=t,this.Yc.wopiPendingCompleteTime=N();try{this.$c.isSingleStepBoot?this.lh():this.uh(),this.ph&&this.oh(tt.ir,{}),this.mh(e)}catch(t){this.us.ULS.ke(596444186,C.X,y.Error,`Unexpected script error: ${J(t)}`),O(this.xc.remoteTelemetryUrl,Qt,"bootException")}finally{this.us.ULS.flush()}}}Fail(t){this.hh?this.us.ULS.ke(596444187,C.X,y.Warning,"Fail called after Complete/Fail already called"):(this.us.ULS.ke(596444188,C.X,y.Warning,"Fail called. Reason: "+(t?JSON.stringify(t):"N/A")),this.hh=!0,this.$c.isSingleStepBoot?this.fh():this.wh(t),this.us.ULS.flush())}Dispose(t,e,i){zt(t||!1,this.us,this.Hc,this.vc,(()=>{delete this.vc,e&&e(),this.gh(),this.Hc.dispose()}),void 0,i)}PostWacToken(t,e,i){!function(t,e,i,s,o,n){const r=N();s.ULS.ke(507774684,C.X,y.Important,"postWacToken flow initiated");const a=()=>{n&&n.flush&&n.flush()};o?o.then((o=>{const c=()=>i.sendPostMessage(o,tt.wr,{wacToken:t,postWacTokenStart:e});c();const h=window.setInterval(c,100);i.registerMessagePayloadHandler(Y.hn,(t=>{s.ULS.ke(507597019,C.X,y.Info,`postWacToken flow completed in ${N()-r} ms`),window.clearInterval(h),window.clearTimeout(d),n&&(n.PostWacTokenResult="success",n.PostWacTokenEndTime=N(),t&&void 0!==t.TokenAlreadySet&&(n.TokenAlreadySet=t.TokenAlreadySet),a())}));const d=window.setTimeout((()=>{s.ULS.ke(507597018,C.X,y.Warning,"postWacToken flow timed out after 60000 ms"),window.clearInterval(h),n&&(n.PostWacTokenResult="timeout",n.PostWacTokenEndTime=N(),a())}),6e4)})).catch((t=>{s.ULS.ke(507873094,C.X,y.Warning,`This should never reject, error: ${J(t)}`),n&&(n.PostWacTokenResult="Unexpected JSAPI V1 error",n.PostWacTokenEndTime=N(),a())})):(s.ULS.ke(507846862,C.X,y.Warning,"`Promise` does not exist natively for this browser."),n&&(n.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",n.PostWacTokenEndTime=N(),a()))}(t,e,this.Hc,this.us,this.Sh,i)}Boot(){this.$c.isSingleStepBoot||this.Ih(),this.us.ULS.flush()}constructor(t,e,i,s,o,n,r){this.ph=!1,this._h=!1,this.hh=!1,this.bh=null,this.Ch=!0,this.Th=!1,this.yh=!1,this.Ih=()=>{this.us.ULS.ke(596444231,C.X,y.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout(this.Ah,5e3),this.Hc.registerMessagePayloadHandler(Y.vs,this.Eh),this.Hc.registerMessagePayloadHandler(Y.do,this.Ph);const t=new Be(this.xc,this.$c,this.us,this.Hc,this.Zc,this.rh);this.vc=t.Boot(),this.Uh&&this.Uh(this.vc)},this.uh=()=>{const t={ParallelizeStartSession:this.Ch,WacFrameIsLoaded:this.ph,WacAcceptsStartSessionComplete:this.Th};this.us.ULS.ke(596444232,C.X,y.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(t)),!this.Ch||this.ph&&!this.Th?this.ph&&this.Rh():this.Wh()},this.lh=()=>{this.us.ULS.ke(596444233,C.X,y.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.xc.wopiInfo=this.dh;const t=new Be(this.xc,this.$c,this.us,this.Hc,this.Zc,this.rh);this.vc=t.Boot(),this.Uh(this.vc)},this.wh=t=>{this.ph?(this.us.ULS.ke(595968481,C.X,y.Warning,"Fail called and wacframe is able to accept postmessages"),this.Fh(t)):(this.us.ULS.ke(595968482,C.X,y.Warning,"Fail was called on the session prior to WacReady."),this.bh=t)},this.Fh=t=>{this.us.ULS.ke(596444189,C.X,y.Warning,"Fail called, sending the failure postmessage to IFrame"),this.oh(tt.tr,t)},this.fh=()=>{this.us.ULS.ke(596444190,C.X,y.Warning,"Fail called during single step boot, calling host failure callback..."),this.rh({errorType:jt.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},this.Ah=()=>{this.ph||(this.us.ULS.ke(596444191,C.X,y.Warning,"Timeout Wac Ready"),this.rh({errorType:jt.TimeoutWacReady,errorObject:void 0}))},this.Oh=()=>{this.hh||(this.Yc.timeoutCompleteOrFail=N(),this.us.ULS.ke(596444192,C.X,y.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.Yc)))},this.Mh=(t,e,i)=>{this.yh||(this.us.ULS.ke(596444193,C.X,y.Info,"SessionCompletion timed out with no ack."),this.kh(t,e,i+1))},this.Eh=t=>{if(this.Yc.readyMessageReceiveTime=N(),this.oh(tt.vn,{}),this.ph)return void this.us.ULS.ke(596444194,C.X,y.Info,"Received multiple ready messages - frame is already loaded.");this.ph=!0,this.Th=t&&t.CanAcceptStartSessionComplete;const e={AcceptStartSessionComplete:this.Th,ParallelizeStartSession:this.Ch,StartSessionResponseAvailable:!!this.Nh,WopiInfoAvailable:!!this.dh};this.us.ULS.ke(596444195,C.X,y.Info,"HandleWacReadyMessage - "+JSON.stringify(e)),this.hh&&(this.bh?this.Fh(this.bh):this.oh(tt.ir,{})),this.Ch&&this.Th?this.Nh&&this.xh():this.dh&&this.Rh(),se(this.Qc,t)},this.Ph=t=>{this.yh=!0,this.Yc.sessionCompleteAckReceivedTime=N()},this.oh=(t,e)=>{this.Hc.sendPostMessage(this.vc,t,e)},this.$h=(t,e)=>{this.kh(t,e,1)},this.kh=(t,e,i)=>{if(i>3)return void this.us.ULS.ke(596444224,C.X,y.Error,`Attempted to call complete, but received no ack from the frame. Time: ${N()}`);this.us.ULS.ke(596444225,C.X,y.Info,`Sending completion message to frame. Attempt number: ${i}, Time: ${N()}`);const s=N();1===i&&(this.Nh&&this.Nh.Diagnostics&&(this.Nh.Diagnostics.completeMessageCreateTime=s),this.Yc.completeMessageCreateTime=s),e.Diagnostics.completeMessageSendTime=s,this.Yc.completeMessageSendTime=s,this.oh(t,e),window.setTimeout((()=>this.Mh(t,e,i)),1e3)},this.Wh=()=>{this.us.ULS.ke(596444226,C.X,y.Info,"Making parallelized startSession request.");const t=this.Hh(this.dh),e="access_token="+encodeURIComponent(this.dh.AccessToken)+"&access_token_ttl="+encodeURIComponent(Pe(this.dh));this.Yc.startSessionStartTime=N(),Bt(t,e,{"Content-Type":"application/x-www-form-urlencoded"},this.Dh)},this.Dh=t=>{if(this.Yc.startSessionCompleteTime=N(),this.Yc.startSessionResponseStatus=t.status,this.Nh={StartSessionResponse:{RequestStatus:t.status,ResponseText:t.responseText},Diagnostics:{wopiPendingInitializeTime:this.Yc.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Yc.wopiPendingCompleteTime,startSessionStartTime:this.Yc.startSessionStartTime,startSessionCompleteTime:this.Yc.startSessionCompleteTime,readyMessageReceiveTime:this.Yc.readyMessageReceiveTime}},this.us.ULS.ke(596444227,C.X,y.Info,`StartSession request completed with status code: ${this.Nh.StartSessionResponse.RequestStatus}, Time: ${N()}`),this.ph&&this.Th)return void this.xh();const e={WacFrameIsLoaded:this.ph,InitializeCompleted:this._h};this.us.ULS.ke(596444228,C.X,y.Info,"StartSessionCompleted not called - "+JSON.stringify(e))},this.Rh=()=>{if(this._h)return;this._h=!0,this.us.ULS.ke(596444229,C.X,y.Info,"Sending wopi info to the frame.");const t={WopiDetails:{WopiSrc:this.dh.WopiSrc,AccessToken:this.dh.AccessToken,AccessTokenTtl:Pe(this.dh)},Diagnostics:{wopiPendingInitializeTime:this.Yc.wopiPendingInitializeTime,wopiPendingCompleteTime:this.Yc.wopiPendingCompleteTime,readyMessageReceiveTime:this.Yc.readyMessageReceiveTime}};this.dh.WacToken&&(t.WopiDetails.WacToken=this.dh.WacToken),this.$h(tt.yn,t)},this.xh=()=>{200===this.Nh.StartSessionResponse.RequestStatus?this._h||(this._h=!0,this.$h(tt.Tn,this.Nh)):this.Rh()},this.Hh=t=>{let e=this.xc.applicationBasePath+le;const i=Ee(this.xc,this.$c,!1);return e+="?"+i.substring(i.indexOf("?")+1),e=m(e,"WOPISrc",encodeURIComponent(t.WopiSrc)),e=m(e,"build",encodeURIComponent(U())),e=m(e,"WacUserType",encodeURIComponent("WOPI")),this.xc.wopiPrecheckInfo.FileGetUrl&&(e=m(e,"fileGetUrlPresent","1")),e},this.mh=t=>{if(this.xc.isCreateNew){if(!t||!t.NewFilePath)return void this.us.ULS.ke(596444230,C.X,y.Info,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",t.NewFilePath),t.UpdatedPageTitle&&(document.title=t.UpdatedPageTitle)}},this.xc=t,this.$c=e,this.Qc=t.diagnostics.AppInitDiagnostics,this.us=i,this.Hc=s,this.Zc=n,this.rh=r,Promise&&(this.Sh=new Promise((t=>this.Uh=t))),this.Yc=t.diagnostics.SessionTraces,this.Yc.wopiPendingInitializeTime=N(),this.gh=o,Gt(),window.setTimeout(this.Oh,5e3)}}class Je{Complete(t){this.xc.diagnostics.HostInitDiagnostics&&(this.xc.diagnostics.HostInitDiagnostics.hostCompleteCallTime=N()),this.Vh.Complete(t)}Fail(t){this.Vh.Fail(t)}Dispose(t,e,i){zt(t||!1,this.us,this.Hc,this.vc,(()=>{delete this.vc,e&&e(),this.gh(),this.Hc.dispose()}),void 0,i)}PostWacToken(t,e,i){this.Vh.PostWacToken(t,e,i)}Boot(){if(this.Bh)return void this.us.ULS.ke(595932544,C.$,y.Info,"Mobile Endpoint detected, skipping first page viewer optimization");if(this.xc.sessionInformation&&this.xc.sessionInformation.WdParams&&"1"===this.xc.sessionInformation.WdParams.wdignorefpo)return void this.us.ULS.ke(507561551,C.$,y.Info,"wdignorefpo request detected, skipping first page viewer optimization");this.us.ULS.ke(595989253,C.$,y.Info,"Boot WordViewer"),this.Hc.registerMessagePayloadHandler(Y._o,this.Lh),this.Hc.registerMessagePayloadHandler(Y.Ys,this.Jh),this.Hc.registerMessagePayloadHandler(Y.Ao,this.Gh);const t=this.xc.rebootOverrideData;t&&t.reason&&"translate"===t.reason.toLowerCase()?this.us.ULS.ke(591209105,C.$,y.Info,"Skip first page optimization"):this.xc.wopiPrecheckInfo.BundleInfo?this.zh(this.xc.wopiPrecheckInfo.BundleInfo,this.xc.container,(()=>{this.qh=N(),this.us.ULS.ke(595998873,C.$,y.Info,"FirstPageFromHostLoadTime: "+this.qh),this.Qc.documentLoadedTime=this.Qc.documentLoadedTime||this.qh,this.vc&&this.vc.contentWindow&&this.jh(this.vc,this.qh)}),(t=>{this.Kh(),this.us.ULS.ke(595994571,C.$,y.Warning,"Cannot load first page from cache"),this.Qc.errorObject=t})):this.us.ULS.ke(596121033,C.$,y.Warning,"Missing Bundle Info"),window.setTimeout(this.Zh,6e4)}constructor(t,e,i,s,o,n,r){this.Xh=!1,this.Qh=!1,this.Bh=!1,this.jh=(t,e)=>{this.Hc.sendPostMessage(t,tt.Pn,{HostCacheLoadTime:e})},this.zh=(t,e,i,s)=>{if(this.us.ULS.ke(595989254,C.$,y.Info,"Kick off OptimizationView"),this.xc.applicationCustomSettings&&this.xc.applicationCustomSettings.ForceAccessibilityMode)return;if(!t.Url)return void this.us.ULS.ke(595722645,C.$,y.Info,"Missing Url in provided Bundle Info, from host: "+this.xc.sessionInformation.HostName);const o=e.ownerDocument;if(!o)return;this.Yh=o.createElement("div"),this.Yh.id="FirstPageContainer",this.Yh.style.left="0",this.Yh.style.textAlign="center",this.Yh.style.width="1px",this.Yh.style.bottom="0",this.Yh.style.zIndex="900",this.Yh.style.height="1px",this.Yh.style.position="absolute",this.Yh.style.padding="0 29px",this.Yh.style.right="0",this.Yh.style.overflow="auto",this.Yh.style.marginLeft="auto",this.Yh.style.marginRight="auto",this.Yh.style.maxWidth="100%",this.td?this.Yh.style.top="0":this.Yh.style.top="90px",e.appendChild(this.Yh);const n=o.createElement("img");n.id="FirstPageImage",n.style.marginTop="11px",n.style.marginBottom="11px",n.style.maxWidth="100%",n.style.border="solid 1px #d2d5d8",n.draggable=!1,n.onload=()=>{this.us.ULS.ke(595989255,C.$,y.Info,"OptimizationView Loaded"),this.Yh.style.width="",this.Yh.style.height="",i()},n.onerror=t=>{s({errorType:jt.CannotLoadFirstPage,errorObject:"string"==typeof t?t:t.returnValue})},n.src=t.Url.replace("{0}","p1.img"),this.Yh.appendChild(n)},this.ed=()=>{if(!this.Qh&&this.Xh&&(!this.td||this.sd&&this.od&&this.nd)){this.Hc.removeMessageHandler(Y._o),this.Hc.removeMessageHandler(Y.Ys),this.Hc.removeMessageHandler(Y.Ao);const t={isCore:this.td,pageCount:this.od,currentPage:this.sd,zoomLevel:this.nd,innerApplicationFrame:this.vc};this.Zc(t),this.us.ULS.ke(595989256,C.$,y.Info,"Word Viewer Initialize Complete"),this.Qh=!0,this.us.ULS.flush()}},this.rd=t=>{this.us.ULS.ke(595986312,C.$,y.Info,"SuccessCallbackProxy called"),this.vc=t.innerApplicationFrame,this.qh&&this.jh(this.vc,this.qh),this.Kh();const e=this.Qc.documentLoadedTime;e&&this.qh&&this.qh<e?(this.Qc.documentLoadedTime=this.qh,this.Qc.documentLoadedFromWopiPrecheckInfo=!0,this.us.ULS.ke(595994572,C.$,y.Info,"First page load from cache was faster")):this.Qc.documentLoadedFromWopiPrecheckInfo=!1,this.hd(),this.Xh=!0,this.us.ULS.ke(595986313,C.$,y.Info,"WordViewerInitializer received wac complete message"),this.ed(),this.us.ULS.flush()},this.dd=t=>{this.us.ULS.ke(595972122,C.$,y.Error,"FailureCallbackProxy called"),this.Qh=!0,this.rh(t)},this.Kh=()=>{this.Yh&&this.Yh.parentElement&&this.Yh.parentElement.removeChild(this.Yh)},this.Zh=()=>{if(!this.Qh){this.Yc.timeoutAppInitialize=N();const t="Didn't receive app initialize post messages. {'appComplete': "+this.Xh+", 'currentPage': "+(void 0!==this.sd)+", 'zoomLevel': "+(void 0!==this.nd)+", 'pageCount': "+(void 0!==this.od)+"}";this.us.ULS.ke(596120771,C.$,y.Warning,t)}},this.Lh=t=>{if(!t||"number"!=typeof t.pageCount)throw new TypeError("values: PageCount not found");this.od=t.pageCount,this.oh(tt.rr,{}),this.ed()},this.Jh=t=>{if(!t||"number"!=typeof t.newPage)throw new TypeError("values: CurrentPage not found");this.sd=t.newPage,this.oh(tt.Wn,{}),this.ed()},this.Gh=t=>{if(!t||"number"!=typeof t.newLevel)throw new TypeError("values: ZoomLevel not found");this.nd=t.newLevel,this.oh(tt.ar,{}),this.ed()},this.hd=()=>{this.sd&&this.oh(tt.Wn,{}),this.od&&this.oh(tt.rr,{}),this.nd&&this.oh(tt.ar,{})},this.oh=(t,e)=>{this.vc&&this.vc.contentWindow?this.Hc.sendPostMessage(this.vc,t,e):this.us.ULS.ke(595955717,C.$,y.Info,"Attempted to send WordViewer postmessage: "+t)},this.xc=t,this.Qc=t.diagnostics.AppInitDiagnostics,this.us=i,this.Hc=s,this.Yc=t.diagnostics.SessionTraces,this.gh=o;const a=window.navigator.userAgent;a.indexOf("Mobi")>=0&&a.indexOf("iPad")<0&&(this.Bh=!0),this.Zc=n,this.rh=r,this.ld=this.Bh?n:this.rd,this.ud=this.Bh?r:this.dd,this.td=!(!this.xc.applicationCustomSettings||!this.xc.applicationCustomSettings.IsCore),this.xc.sessionInformation&&this.xc.sessionInformation.WdParams&&(this.xc.applicationCustomSettings&&this.xc.applicationCustomSettings.ForceAccessibilityMode?this.xc.sessionInformation.WdParams.wdAccPdf="1":this.td&&(this.xc.sessionInformation.WdParams.wdAccPdf="0")),this.Vh=new Le(this.xc,e,i,s,o,this.ld,this.ud)}}class Ge{registerEventHandler(t){this.gc.push(t)}removeEventHandler(t){if(t){const e=this.gc.indexOf(t);this.gc.splice(e,1)}}stop(){document.removeEventListener("visibilitychange",this.pd)}getVisibilityChangeEvents(){return this.md}dispose(){this.stop(),this.gc=[],this.md=[]}constructor(){if(this.md=[],this.gc=[],this.pd=()=>{const t={visibility:document.visibilityState,time:N(),initialState:!1};this.md.push(t);for(const e of this.gc)e&&e(t)},"hidden"===document.visibilityState){const t={visibility:document.visibilityState,time:N(),initialState:!0};this.md.push(t)}document.addEventListener("visibilitychange",this.pd)}}class ze{GetVersion(){return U()}GetMinContentVersion(){throw new Error("Not implemented")}Prefetch(t){if(null!=t&&void 0!==t){const e=document.createElement("link");e.rel="prefetch";let i=t.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),e.href=i;const s=document.getElementsByTagName("head")[0];null!=s&&void 0!==s&&s.appendChild(e)}}InitializeWopiPending(t,e,i,o,n,r){let a,d,l,u,m=!1;try{i?d=i:[d,l]=st(),O(te(t.ApplicationUrl,d),Qt,"init");const f=N();let S;!function(t){if(void 0===t)throw new TypeError("initParams");const e=t.Container;if(void 0===e||void 0===e.appendChild)throw new TypeError("Container");const i=t.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");const s=t.ApplicationUrl;if(void 0===s||"string"!=typeof s)throw new TypeError("ApplicationUrl");const o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(t),t.ApplicationUrl=c(t.ApplicationUrl,p(t.ApplicationUrl,"region")),t.ApplicationUrl=function(t,e){if(!t)return t;let i=t;const s=i.indexOf("?"),o="region".toLowerCase()+"=",n=i.toLowerCase().indexOf(o,s);if(n>=0){const t=i.indexOf("&",n);return i=i.substring(0,n)+(-1===t?"":i.substring(t+1)),"&"===i.slice(-1)&&(i=i.slice(0,-1)),i}return t}(t.ApplicationUrl),function(t){const e=t.RebootOverrideData;if(e){let i=e.mode;i&&(i=i.toLowerCase(),"view"===i&&we(t.ApplicationUrl)?t.ApplicationUrl=Se(t.ApplicationUrl):"edit"===i&&ge(t.ApplicationUrl)&&(t.ApplicationUrl=ve(t.ApplicationUrl)))}}(t),a=e||B({remoteUlsEndpoint:ie(t.ApplicationUrl)+s,sessionId:d}),u=ee(t,d,a,n,r,this.fd.forceSingleStepBoot),r||(u.Ne.addSettingsChangeListener(a.settingsChangeHandler),u.Ne.initializePeriodicFetch(u.applicationBasePath,d)),u.diagnostics.HostInitDiagnostics&&(u.diagnostics.HostInitDiagnostics.hostInitializeCallTime=f),re(a,u,l),m=!0;const v=t.BootstrapperUrl;v&&(S=this.gd(v,a));const I=()=>{u.Ne.dispose(),u.pageStateObserver.dispose(),window.clearInterval(S)},_=h(t.ApplicationUrl),b=o||new Re(_,a),T=new Ge,A=function(t,e){let i={isSingleStepBoot:t.forceSingleStepBoot,bootFlowType:t.forceSingleStepBoot?Te.forceSingleStepBoot:Te.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(t.forceSingleStepBoot){const s=t.applicationUrl,o=ge(s),n=g(s,"uiembed"),r=g(s,"embed");t.canSupportInteractiveReadOnly=_e(t,n,r,e),Ce(t,o,e)?i={isSingleStepBoot:!0,bootFlowType:Te.wordMobileUnifiedReadRedirect,ignoreWacFramePostMessages:!1}:be(t,o,e)&&(i={isSingleStepBoot:!0,bootFlowType:Te.wordViewToUnifiedReadRedirect,ignoreWacFramePostMessages:!1})}else i=function(t,e){const i=t.applicationUrl,s=we(i),o=ge(i),n=g(i,"uiembed"),r=g(i,"embed");return e.ULS.ke(595640900,C.X,y.Info,`gotUiEmbedUrl:${n}, gotEditUrl:${s}, gotViewUrl:${o}`),!s&&t.wopiPrecheckInfo.IrmEnabled?{isSingleStepBoot:!0,bootFlowType:n?Te.wordUiEmbedIrmEnabledEarlyRedirect:Te.unifiedIrmEnabled,ignoreWacFramePostMessages:!1}:(t.canSupportInteractiveReadOnly=_e(t,n,r,e),Ce(t,o,e)?{isSingleStepBoot:!0,bootFlowType:Te.wordMobileUnifiedReadRedirect,ignoreWacFramePostMessages:!1}:be(t,o,e)?{isSingleStepBoot:!0,bootFlowType:Te.wordViewToUnifiedReadRedirect,ignoreWacFramePostMessages:!1}:s?(e.ULS.ke(575980770,C.X,y.Info,`readOnly:${t.wopiPrecheckInfo.ReadOnly}`),t.wopiPrecheckInfo.ReadOnly&&n?{isSingleStepBoot:!0,bootFlowType:Te.wordUiEmbedReadOnlyEarlyRedirect,ignoreWacFramePostMessages:!1}:!function(t){return t.Ne.getValue(D.Qe,!1)?null==t.wopiInfo||null==t.wopiInfo.WopiSrc||""===t.wopiInfo.WopiSrc:null==t.wopiInfo}(t)||lt()?{isSingleStepBoot:!0,bootFlowType:Te.unifiedSingleFlush,ignoreWacFramePostMessages:!1}:{isSingleStepBoot:!1,bootFlowType:Te.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1}):{isSingleStepBoot:!0,bootFlowType:o?Te.unifiedViewActionUrl:Te.unifiedNotEditOrViewActionUrl,ignoreWacFramePostMessages:!o})}(t,e);if(i.isSingleStepBoot){const s={singleStepBootIsRequired:!0,singleStepBootReason:i.bootFlowType,irmEnabled:t.wopiPrecheckInfo.IrmEnabled,readOnly:t.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:i.ignoreWacFramePostMessages};e.ULS.ke(596444182,C.X,s.irmEnabled?y.Warning:y.Info,JSON.stringify(s))}else e.ULS.ke(596444183,C.X,y.Info,"Received input valid for two step flow");return i}(u,a),E=function(t,e,i,s,o,n,r){return a=>{const c=t.diagnostics;ne(c,s),oe(c.SessionTraces,i,y.Info);const h=Ke(c);i.ULS.ke(596448985,C.X,y.Important,JSON.stringify(h)),O(t.remoteTelemetryUrl,Qt,"bootSuccess");const d=r(t.sessionId,i,e,o,a);try{n(d,h)}catch(t){i.ULS.ke(595719171,C.X,y.Error,`Exception thrown from host's success callback: ${J(t)}`)}wt(qe,i),je(i)}}(u,b,a,T,I,t.FnOnInitializeSuccess,this.Sd),P=function(t,e,i,s){return o=>{const n=t.diagnostics;ne(n,i),oe(n.SessionTraces,e,y.Warning);const r=Ke(n);e.ULS.ke(596448986,C.X,y.Error,JSON.stringify({error:o,appInitDiagnostics:r})),O(t.remoteTelemetryUrl,Qt,"bootFailure");try{s(o,r)}catch(t){e.ULS.ke(595719172,C.X,y.Error,`Exception thrown from host's failure callback: ${J(t)}`)}wt(qe,e),je(e)}}(u,a,T,t.FnOnInitializeFailure);t.FnOnAppModeSwitched&&b.registerMessagePayloadHandler(Y.js,t.FnOnAppModeSwitched);{const e="Microsoft Teams"===t.SessionInformation.HostName,i=[Te.unifiedViewActionUrl,Te.wordUiEmbedReadOnlyEarlyRedirect,Te.wordUiEmbedIrmEnabledEarlyRedirect];if(e||this.fd.useViewerInitializer||i.includes(A.bootFlowType)){!this.fd.useViewerInitializer&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"}),(A.bootFlowType===Te.wordUiEmbedReadOnlyEarlyRedirect||e)&&(u.applicationUrl=Se(u.applicationUrl,!0)),A.bootFlowType!==Te.wordViewToUnifiedReadRedirect&&A.bootFlowType!==Te.wordMobileUnifiedReadRedirect||(a.ULS.ke(506585945,C.X,y.Info,"Redirecting Viewer request to unified read : "+A.bootFlowType),u.applicationUrl=ve(u.applicationUrl)),u.sessionInformation.HideViewerToolbar&&(u.applicationCustomSettings?u.applicationCustomSettings.IsCore=!0:u.applicationCustomSettings={IsCore:!0},delete u.sessionInformation.HideViewerToolbar);const i=new Je(u,A,a,b,I,E,P);return i.Boot(),i}A.bootFlowType!==Te.wordViewToUnifiedReadRedirect&&A.bootFlowType!==Te.wordMobileUnifiedReadRedirect||(a.ULS.ke(578324612,C.X,y.Info,"Redirecting Viewer request to unified read : "+A.bootFlowType),u.applicationUrl=ve(u.applicationUrl))}t.WopiPrecheckInfo.ReadOnly&&t.FnOnAppModeSwitched&&t.FnOnAppModeSwitched({NewMode:"view"});const U=p(u.applicationUrl,"uih");if(v&&this.fd.preconnector&&this.fd.preconnector.shouldPreconnect(U)&&this.fd.preconnector.preconnect(v),v&&this.fd.preloader&&this.fd.preloader.shouldPreload(u.applicationUrl))try{let t=v;u.featureManager.isFeatureEnabled(V.Hi)&&(a.ULS.ke(595645891,C.X,y.Info,"HTTP2 preload enabled"),t=w(v));let e=u.sessionInformation.UiLocale;e||(e=decodeURIComponent(p(u.applicationUrl,"ui"))),this.fd.preloader.preload(t,e,a,u.featureManager)}catch(t){a.ULS.ke(595943884,C.X,y.Error,"Error preloading")}const R=new Le(u,A,a,b,I,E,P);return R.Boot(),R}catch(e){return a&&(a.ULS.ke(596459925,C.X,y.Error,`${jt.AppInitError}: ${J(e)}`),m||re(a,u||ee(t,d,a,n,r,this.fd.forceSingleStepBoot),l),a.ULS.flushOnClose()),void(t&&(t.ApplicationUrl&&O(te(t.ApplicationUrl,d),Qt,"bootException"),t.FnOnInitializeFailure&&t.FnOnInitializeFailure({errorType:jt.AppInitError,errorObject:e})))}}constructor(t,e){this.gd=(t,e)=>window.setInterval((()=>{this.Prefetch({BootstrapperUrl:t}),e.ULS.ke(595895774,C.X,y.Info,"Prefetching "+function(t){if(!t)return"";const e=-1===t.indexOf("#")?t.length:t.indexOf("#");let i=t.lastIndexOf("/",e);if(-1!==i&&i+1===t.indexOf("://")+3)return"";i+=1;let s=t.indexOf("?");if(s=s>=e?-1:s,-1!==s&&i>s)return"";const o=-1===s?e:s;return i>=o?"":t.substring(i,o)}(t))}),36e5),this.Sd=t,this.fd=e}}const qe="word";function je(t){t.ULS.ke(590914655,C.X,y.Info,`Time spent logging: ${t.getTimeSpentLogging()}`)}function Ke(t){return{...t.AppInitDiagnostics,...t.HostInitDiagnostics,SessionTraces:t.SessionTraces}}var Ze;!function(t){t.BrowserEvent="BrowserEvent",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.Disposed="Disposed",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.DavUrlFromIds="DavUrlFromIds",t.ModeSwitched="ModeSwitched",t.CreateNewDocument="App_CreateNewDocument",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.SetOverlayContent="SetOverlayContent",t.MoveToFolder="MoveToFolder",t.SharedFilePicker="SharedFilePicker"}(Ze||(Ze={}));class Xe{GetApplicationType(){return Qt}GetVersion(){return U()}GetSessionId(){return this.vd}RegisterEventHandler(t,e){switch(t){case Ze.Unloaded:case Ze.Disposed:case Ze.DocumentReboot:case Ze.WopiInfoFromUrl:case Ze.DavUrlFromIds:case Ze.GetAuthToken:case Ze.GetCustomAuthConfig:case Ze.MoveToFolder:case Ze.SharedFilePicker:case Ze.SetOverlayContent:case Ze.FileShare:if(this.gc[t])throw new Error("Duplicate registration");this.gc[t]=e;break;default:this.Hc.registerMessagePayloadHandler(t,e)}}RemoveEventHandler(t,e){switch(t){case Ze.Unloaded:case Ze.Disposed:case Ze.DocumentReboot:case Ze.FileShare:case Ze.WopiInfoFromUrl:case Ze.DavUrlFromIds:case Ze.GetAuthToken:case Ze.GetCustomAuthConfig:case Ze.MoveToFolder:case Ze.SharedFilePicker:case Ze.SetOverlayContent:if(this.gc[t]!==e)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.gc[t];break;default:this.Hc.removeMessageHandler(t)}}RegisterErrorHandler(t){}RemoveErrorHandler(t){}PostCommand(t,e){this.Hc.postMessageForCommand(this.vc,t,e)}Dispose(t,e){zt(t||!1,this.us,this.Hc,this.vc,(()=>{delete this.vc,this.Id(),this.Hc.dispose(),this._d(Ze.Unloaded,{})}),(()=>{try{this._d(Ze.Disposed,{}),this.gc={}}catch(t){this.us.ULS.ke(589108815,C.X,y.Error,`onFrameRemoved error: ${J(t)}`)}}),e)}constructor(t,e,i,s,o){this.gc={},this.bd=()=>{this.Hc.registerMessagePayloadHandler(Y.so,this.Cd),this.Hc.registerMessagePayloadHandler(Y.Gs,this.Td),this.Hc.registerMessagePayloadHandler(Y.zs,this.yd),this.Hc.registerMessagePayloadHandler(Y.Bs,this.Ad),this.Hc.registerMessagePayloadHandler(Y.uo,this.Ed),this.Hc.registerMessagePayloadHandler(Y.Ls,this.Pd),this.Hc.registerMessagePayloadHandler(Y.Ks,this.Ud),this.Hc.registerMessagePayloadHandler(Y.co,this.Rd)},this._d=(t,e)=>{const i=this.gc[t];if(i)try{i(e||{})}catch(t){this.us.ULS.ke(593773706,C.X,y.Error,`Handler error: ${J(t)}`)}},this.Cd=t=>{t.previousSessionId=this.vd,this._d(Ze.DocumentReboot,t)},this.Td=t=>{this._d(Ze.WopiInfoFromUrl,t)},this.yd=t=>{this._d(Ze.DavUrlFromIds,t)},this.Ad=t=>{Promise?this.Wd.isResourceTrustedForMessage(t).then((e=>{e?this._d(Ze.GetAuthToken,t):this.Hc.sendPostMessage(this.vc,tt.Jn,{AuthToken:"",Error:"accessDenied",RequestId:t.RequestId,IdentityType:t.IdentityType})}),(()=>{this.Hc.sendPostMessage(this.vc,tt.Jn,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:t.RequestId,IdentityType:t.IdentityType})})):this.Hc.sendPostMessage(this.vc,tt.Jn,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:t.RequestId,IdentityType:t.IdentityType})},this.Ed=t=>{this._d(Ze.FileShare,t)},this.Pd=t=>{this._d(Ze.GetCustomAuthConfig,t)},this.Ud=t=>{this._d(Ze.MoveToFolder,t)},this.Rd=t=>{this._d(Ze.SharedFilePicker,t)},this.vd=t,this.us=e,this.vc=o.innerApplicationFrame,this.Hc=i,this.Id=s,this.Wd=new At(e),this.bd(),Gt()}}class Qe extends Xe{SetCurrentPage(t){this.Fd?this.Od({errorType:jt.ApiDisabledError,errorObject:{isCoreMode:this.td}}):(this.Md=t,this.Hc.sendPostMessage(this.vc,tt.Qn,{newPage:this.Md}),window.setTimeout((()=>{this.Md!==this.kd&&this.us.ULS.ke(596444179,C.$,y.Info,'Did not receive the page change update. {"RequestedPage": '+this.Md+', "CurrentPage": '+this.kd+"}")}),5e3))}GetPageCount(){return this.Fd&&this.Od({errorType:jt.ApiDisabledError,errorObject:{isCoreMode:this.td}}),this.od}GetCurrentPage(){return this.Fd&&this.Od({errorType:jt.ApiDisabledError,errorObject:{isCoreMode:this.td}}),this.kd}SetZoomLevel(t){this.Fd?this.Od({errorType:jt.ApiDisabledError,errorObject:{isCoreMode:this.td}}):(this.Nd=Number(t.toFixed(2)),this.Hc.sendPostMessage(this.vc,tt.Yn,{newLevel:this.Nd}),window.setTimeout((()=>{this.Nd!==this.nd&&this.us.ULS.ke(596444180,C.$,y.Info,'Did not receive the zoom change update. {"RequestedZoom": '+this.Nd+', "CurrentZoom": '+this.nd+"}")}),5e3))}GetZoomLevel(){return this.Fd&&this.Od({errorType:jt.ApiDisabledError,errorObject:{isCoreMode:this.td}}),this.nd}GetIsDisabled(){return this.Fd}GetApplicationType(){return"Word Viewer"}RegisterEventHandler(t,e){switch(t){case Ze.ZoomChanged:case Ze.PageChanged:case Ze.IsDisabled:if(this.gc[t])throw new Error("Duplicate registration");this.gc[t]=e;break;default:this.Hc.registerMessagePayloadHandler(t,e)}}RemoveEventHandler(t,e){switch(t){case Ze.ZoomChanged:case Ze.PageChanged:case Ze.IsDisabled:if(this.gc[t]!==e)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.gc[t];break;default:this.Hc.removeMessageHandler(t)}}RegisterErrorHandler(t){this.xd=t}RemoveErrorHandler(t){if(this.xd!==t)throw new Error("The handler requested to be removed does not exist");delete this.xd}constructor(t,e,i,s,o){super(t,e,i,s,o),this.Od=t=>{const e={errorType:t.errorType,errorObject:t.errorObject};if(!e.errorType||!e.errorObject)throw new TypeError("Error object is missing errorType or errorObject");this.xd&&this.xd(e)},this.$d=t=>{this.nd=t.newLevel,this._d(Ze.ZoomChanged,t)},this.Hd=t=>{this.kd=t.newPage,this._d(Ze.PageChanged,t)},this.Dd=t=>{this.Fd=t.isDisabled,this._d(Ze.IsDisabled,t)},this.vc=o.innerApplicationFrame,this.Hc=i,this.us=e,this.gc={},this.td=o.isCore,this.kd=o.currentPage,this.nd=o.zoomLevel,this.od=o.pageCount,this.Fd=!this.td,this.Hc.registerMessagePayloadHandler(Y.Ao,this.$d),this.Hc.registerMessagePayloadHandler(Y.Ys,this.Hd),this.Hc.registerMessagePayloadHandler(Y.Hs,this.Dd),this.Hc.registerMessagePayloadHandler(Y.Os,this.Od)}}const Ye=(t,e,i,s,o)=>t!==Y.so?Promise.reject("Wrong flow"):new Promise((t=>{let s;if(i.pendingReboot=!0,e.queryOverrides)try{s=JSON.parse(e.queryOverrides)}catch(t){i.logger.ULS.ke(592217694,C.X,y.Error,`Failed to parse queryOverrides: ${s}`)}i.raiseEvent(et.Reboot,{...e,previousSessionId:i.sessionId,queryOverrides:s}),t({completion:"success"})}));function ti(t){return!(!(t&&t.source&&t.accessToken)||!t.expiry&&0!==t.expiry)}function ei(t){const e={};l(e,"jsapi","1"),l(e,"jsapiver","v2"),l(e,"corrid",t.sessionId),l(e,"usid",t.sessionId),l(e,"newsession","1"),l(e,"sftc","1"),t.hostSessionId&&l(e,"hid",encodeURIComponent(t.hostSessionId));const i=t.host;i.uiHostName&&l(e,"uih",i.uiHostName),i.uiHostIntegrationType&&l(e,"uihit",encodeURIComponent(i.uiHostIntegrationType)),i.metaUiHostVersion&&l(e,"muv",encodeURIComponent(i.metaUiHostVersion)),i.topOrigin&&l(e,"to",encodeURIComponent(i.topOrigin)),i.isDeeplyNestedAuthSupportedInTeams&&l(e,"dnaa","1");const s=i.capabilities;s&&(s.accessibilityLoop&&l(e,"accloop","1"),s.rebootDoc&&l(e,"sdr",s.rebootDoc.toString()),s.createNewDoc&&l(e,"scnd","1"),s.authToken&&l(e,"sat","1"),window.docAspxMsalEnabled&&"onedrivecom"!==i.uiHostName&&(s.authTokenStrategy="PairwiseBroker"),s.authTokenStrategy&&l(e,"ats",s.authTokenStrategy),s.customAuthConfig&&l(e,"cac","1"),s.refreshAccessToken&&l(e,"rat","1"),s.atMentions&&l(e,"sams","1"),s.moveToFolder&&l(e,"mtf","1"),s.noBrowserModalDialogs&&l(e,"nbmd","1"),s.commonFilePicker&&l(e,"sfp","1"),s.directDownload&&l(e,"sdd","1"),s.directPrint&&l(e,"sdp","1"),s.disableOfficeAddins&&l(e,"doa","1"));const o=t.ui;o.language&&l(e,"ui",encodeURIComponent(o.language)),o.uiEmbed&&l(e,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&l(e,"hhdr","1"),o.highContrast&&l(e,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&l(e,"hodflp","1"),o.hideAppLauncherInHeader&&l(e,"halh","1"),o.hideChatInHeader&&l(e,"hch","1"),o.hideMeInHeader&&l(e,"hmh","1"),o.hideSearchInHeader&&l(e,"hsh","1"),o.hideWorkflowInHeader&&l(e,"hwfh","1"),o.hideSettingsInHeader&&l(e,"hsth","1"),o.showAppIconInHeader&&l(e,"sih","1"),o.useNeutralColorInHeader&&l(e,"unh","1"),o.openLinksInNewWindow&&l(e,"onw","1"),o.useDarkTheme&&l(e,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||l(e,"readOnly","1");const n=t.wopi;n&&n.source&&l(e,"wopisrc",encodeURIComponent(n.source));const r=t.bootParams;r&&(r.dataLanguage&&l(e,"rs",encodeURIComponent(r.dataLanguage)),r.readOnly&&(l(e,"readonly","1"),l(e,"mode","Read")),r.disableChat&&l(e,"dchat","1"),r.cookieCompliant&&l(e,"mscc","1"),r.useBizChatTheme&&l(e,"ubct","1"),r.isNewFile&&(l(e,"new","1"),r.isFromHostTemplate&&l(e,"wdtpl","fromhost"))),t.user.isLicensed&&l(e,"islicenseduser","1"),t.user.isSynthetic&&l(e,"syn","1"),t.actNavId&&l(e,"actnavid",t.actNavId),t.sessionContext&&l(e,"sc",encodeURIComponent(t.sessionContext));const a=t.wdParams;if(a)for(const t in a)l(e,t,a[t]);const c=t.preseededSession;c&&(c.key&&l(e,"preseededsessionkey",encodeURIComponent(c.key)),c.id&&l(e,"preseededwacsessionid",encodeURIComponent(c.id)));const h=t.throttling;h&&(h.protection&&l(e,"ctp",h.protection),h.request&&l(e,"rct",h.request));const d=t.hostInitDiagnostics;d&&(d.entryPoint&&l(e,"wdorigin",encodeURI(d.entryPoint)),d.userClickTime&&l(e,"wdhostclicktime",d.userClickTime.toString()));const p=t.rebootOverride;return p&&p.previousSessionId&&l(e,"wdprevioussession",p.previousSessionId),u(e,"region"),t.bootParams?.afdFlighting&&l(e,"afdflight",Math.floor(100*Math.random()+1).toString()),e}function ii(t,e,i){let s={...f(t.appUrl),...ei(t),...i};const o=t.rebootOverride;return o&&o.queryOverrides&&(s={...s,...o.queryOverrides}),function(t,e,i){const s=[];for(const t in i)i[t]&&s.push(t+"="+i[t]);return t+e+(s.length>0?"?"+s.join("&"):"")}(t.appBasePath,e,s)}const si="sideLoadingIsEnabled";const oi=(t,e,i,o,r)=>t!==Q.boot?Promise.reject("Wrong flow"):new Promise((t=>{const a=N();var d;i.state=b.Booting,i.pendingReboot=!1,function(t,e,i=!1){if(!t)throw new TypeError("SessionBootParams");const s=t.appUrl,o=t.appBaseUrl;if(!s&&!o)throw new TypeError("Either appUrl or appBaseUrl should exist");if(s&&"string"!=typeof s)throw new TypeError("AppUrl");if(o&&"string"!=typeof o)throw new TypeError("AppBaseUrl");const n=t.file;if(!n||!i&&!n.name)throw new TypeError("FileInfo");const r=t.container;if(!r||!(r instanceof Dt)&&!r.appendChild)throw new TypeError("Container");if(!e&&!ti(t.wopi))throw new TypeError("WopiInfo")}(e,i.skipWopiValidation,i.skipFileNameCheck),i.intent=e.intent,i.file=e.file,i.customFontCatalogUrl=e.customFontCatalogUrl,i.wopi=e.wopi,i.contentBundle=e.contentBundle,i.newFileTemplate=e.newFileTemplate,i.ownerId=e.ownerId,i.sessionContext=e.sessionContext,i.actNavId=e.actNavId,i.preseededSession=e.preseededSession,i.throttling=e.throttling,i.meeting=e.meeting,i.tenantId=e.tenantId,i.wdParams=(d=e.wdParams,function(t,e){const i={};return e&&Object.keys(e).forEach((t=>{i[t.toLowerCase()]=e[t]})),t.split("&").forEach((t=>{if(/^wd\w+=.+/i.test(t)){const e=t.split("=");i[e[0].toLowerCase()]=e[1]}})),i}(window.location.search?.substring(1)||"",d)),i.pinnedTarget=e.pinnedTarget,i.rebootOverride=e.rebootOverride,i.bootParams=e.bootParams||{},i.hostInitDiagnostics={...e.diagnostics,hostInitializeCallTime:a};let u=!1;const m=i.preseededSession;i.appInfo.usePreseededSessionId&&m&&m.id&&(i.sessionId=m.id,u=!0);let f=!1;const v=e.hostGeneratedSessionId;if(!u&&v&&(i.sessionId=v,f=!0),i.Ne.getValue(D.Xe,!1)&&_t(i.hostInitDiagnostics),e.appUrl){const t=e.appUrl;i.appUrl=t;const s=i.bootParams;if(g(t,"new")&&(s.isNewFile=!0),!s.dataLanguage){const e=S(t,"rs");e&&(s.dataLanguage=e)}const o=i.ui;if(g(t,"uiembed")&&(o.uiEmbed=!0),!o.language){const e=S(t,"ui");e&&(o.language=e)}if(!i.hostInitDiagnostics.entryPoint){const e=S(t,"wdorigin");e&&(i.hostInitDiagnostics.entryPoint=e)}if(!i.host.uiHostName){const e=S(t,"uih");e&&(i.host.uiHostName=e)}}else i.appUrl="";let I;if(i.appBaseUrl=e.appBaseUrl?e.appBaseUrl.toLowerCase():h(e.appUrl).toLowerCase(),i.appBaseUrl=c(i.appBaseUrl,p(i.appUrl,"region")),i.Ne.updateEnvironment(i.appBaseUrl),o.initializeAppContext(i,t,e),i.appBasePath=o.buildAppBasePath(i),e.rebootOverride&&(u||f||([i.sessionId,I]=st()),i.pageStateObserver=new bt(i.logger,!0),i.authTokenTrustValidator=new At(i.logger)),i.logger.ULS.ke(38580693,C.X,y.Info,`User session id: ${i.sessionId}, is preseeded: ${u}, is host generated: ${f}`),i.remoteTelemetryUrl=o.buildRemoteTelemetryUrl(i),O(i.remoteTelemetryUrl,i.appInfo.name,"init"),!i.isLoggerFromOwl){let t=i.Ne.getValue(D.De,"").toString();t||(t=i.appBasePath+s),i.logger.configure({remoteUlsEndpoint:t,sessionId:i.sessionId})}if(i.Ne.initializePeriodicFetch(i.appBasePath,i.sessionId),I&&i.logger.ULS.ke(590966790,C.X,y.Info,JSON.stringify(I)),function(t){try{const e=t.hostInitDiagnostics;t.logger.ULS.ke(558155803,C.X,y.Info,"HostInitDiagnostics: "+(e?JSON.stringify(e):"N/A")),t.logger.ULS.ke(596444237,C.X,y.Important,JSON.stringify({session:gt(t),client:t.clientDiagnostics}))}catch(e){t.logger.ULS.ke(558155804,C.X,y.Error,`Failed to log init info: ${J(e)}`)}}(i),o.onContextReady&&o.onContextReady(i),i.appInitDiagnostics={officeSessionId:i.sessionId,officeBootstrapperVersion:U(),hostName:i.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(()=>{i.logger.ULS.ke(504411206,C.X,y.Important,"documentLoadedWithTabSwitch changed on document visibility event"),i.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),window.addEventListener("visibilitychange",(()=>{i.logger.ULS.ke(504411205,C.X,y.Important,"documentLoadedWithTabSwitch changed on window visibility event"),i.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!i.container){const t=e.container;i.container=t instanceof Dt?t:i.application.createContainer(t)}i.container.setMessageHandler(i.onMessage);const _=!!o.ignoreCompletionMessage&&o.ignoreCompletionMessage(i),T=(t,e)=>{i.successTime=N(),_||(i.container.postMessage(tt.Cn,void 0),ft(i.appInitDiagnostics,e.Diagnostics)),i.Ne.addSettingsChangeListener(i.logger.settingsChangeHandler),o.onSuccess&&o.onSuccess(i,e),i.logger.ULS.ke(596448985,C.X,y.Important,JSON.stringify(i.diagnostics)),O(i.remoteTelemetryUrl,i.application.name,"bootSuccess"),i.logger.ULS.flush(),i.container.postMessage(tt.Rn,{HostInitializeDiagnostics:i.hostInitDiagnostics,ClientDiagnostics:i.clientDiagnostics}),i.state=b.Booted,E({completion:"success"}),wt(i.appInfo.name,i.logger)},A=(t,e)=>{i.failureTime=N(),o.onFailure&&o.onFailure(i,e.Error),i.logger.ULS.ke(596448986,C.X,y.Error,JSON.stringify({error:e.Error,diagnostics:i.diagnostics})),O(i.remoteTelemetryUrl,i.application.name,"bootFailure"),i.logger.ULS.flush(),i.state=b.Failed,E({completion:"failure",error:e.Error,errorSource:"app",documentLoadedWithTabSwitch:i.appInitDiagnostics?.documentLoadedWithTabSwitch}),wt(i.appInfo.name,i.logger)},E=e=>{_||(i.bootHeartBeat&&i.bootHeartBeat.stop(),i.removeActionHandler(Y.bs,T),i.removeActionHandler(Y.Is,A)),t(e)};r&&r.subscribe((()=>{E({completion:r.reason||"cancelled",documentLoadedWithTabSwitch:i.appInitDiagnostics?.documentLoadedWithTabSwitch})})),_||(i.addActionHandler(Y.bs,T),i.addActionHandler(Y.Is,A)),function(t){(function(t){return"wdjs"in t||"wd1js"in t})(t)&&("true"!==window.sessionStorage.getItem(si)?Ot(si,"false",0):function(t,e){const i=Ft(t);return"true"===i||"false"!==i&&!1}(si)||Ot(si,"true",1))}(i.wdParams);const P=o.buildBootRequestParams(i),R=ii(i,P.appPageName,P.queryParamsOverrides),W=function(t,e){const i=function(t){const e={};l(e,"highdpi",String(window.devicePixelRatio>1.24)),l(e,"softblockedbrowser",String(dt())),l(e,"hostname",t.hostName),l(e,"feature_status",z(t.featureManager,t.wdParams)),l(e,"jsapibuild",U());const i=t.wopi;i&&(l(e,"access_token",i.accessToken),l(e,"access_token_ttl",i.expiry.toString()),i.wacToken&&l(e,"wac_token",i.wacToken));const s=t.customFontCatalogUrl;s&&l(e,"customfontcatalogurl",s);const o=t.contentBundle;if(o){if(o.url){l(e,"bundlesrc",o.url);const i=o.staleness,s=null!=i;s&&l(e,kt.na,i.toString()),t.logger.ULS.ke(577783775,C.X,y.Info,"Content bundle staleness: "+(s?i:"N/A"))}o.bundleUrlNoAuth&&l(e,"bundleurlnoauth",o.bundleUrlNoAuth),o.bundleCode&&l(e,"bundlecode",o.bundleCode)}const n=t.file,r=n.name;if(r){l(e,"filename",r);const t=L(r);t&&l(e,"fileextension",t)}n.getUrl&&l(e,"filegeturl",n.getUrl),n.downloadCode&&l(e,"filedownloadcode",n.downloadCode),n.urlNoAuth&&l(e,"fileurlnoauth",n.urlNoAuth),n.size&&l(e,"filesize",n.size.toString()),n.eTag&&l(e,"etag",n.eTag),n.cTag&&l(e,"revid",n.cTag),n.uniqueId&&l(e,"docid",n.uniqueId),void 0!==n.immutableReason&&l(e,"immutableReason",n.immutableReason.toString()),void 0!==n.supportsZipIt&&l(e,"supports_zipit",n.supportsZipIt.toString());const a=t.newFileTemplate;a&&(a.getUrl&&l(e,"templateurl",a.getUrl),a.size&&l(e,"filesize",a.size.toString()),a.eTag&&l(e,"etag",a.eTag),a.uniqueId&&l(e,"docid",a.uniqueId)),t.user.id&&l(e,"user_id",t.user.id),t.ownerId&&l(e,"owner_id",t.ownerId),t.sessionContext&&l(e,"sc",t.sessionContext);const c=t.ui;c.controls&&l(e,"huictrls",JSON.stringify(c.controls)),"Templatization"!==c.contentAssemblyMode&&"DocGen"!==c.contentAssemblyMode&&"ContentAssemblyEdit"!==c.contentAssemblyMode&&"ContentAssemblyView"!==c.contentAssemblyMode||l(e,"caae","1"),c.contentAssemblyMode&&l(e,"caaemode",c.contentAssemblyMode);const h=t.meeting;h&&(h.id&&l(e,"meetingId",h.id),h.title&&l(e,"meetingTitle",h.title),h.type&&l(e,"meetingType",h.type),h.scheduledStartTime&&l(e,"scheduledStartTime",h.scheduledStartTime),h.scheduledEndTime&&l(e,"scheduledEndTime",h.scheduledEndTime),h.isPresenter&&l(e,"isPresenter",h.isPresenter.toString()),h.organizerId&&l(e,"meetingOrganizerId",h.organizerId),h.joinUrl&&l(e,"meetingJoinUrl",encodeURIComponent(h.joinUrl)),h.isMeetingTeamsRoom&&l(e,"isMeetingTeamsRoom",h.isMeetingTeamsRoom.toString()));const d=t.host;d.owlVersion&&l(e,"owlver",d.owlVersion),d.owlRollout&&l(e,"owlro",d.owlRollout);const u=d.capabilities;return u&&(u.supportsInPlaceCreateNew&&l(e,"sipcn",u.supportsInPlaceCreateNew.toString()),u.disableEmbedViewCodeSnippet&&l(e,"devcs","1"),u.disableCoEditInTeams&&l(e,"dceit","1")),e}(t);return Object.keys(e).forEach((t=>{e[t]?i[t]=e[t]:delete i[t]})),i}(i,P.postDataOverrides);if(i.bootstrapperUrl&&i.preconnector&&i.preconnector.shouldPreconnect(i.hostName)&&i.preconnector.preconnect(i.bootstrapperUrl),i.bootstrapperUrl&&i.preloader&&i.preloader.shouldPreload(R,i.host.origin,i))try{o.beforePreload&&o.beforePreload(i);let t=i.bootstrapperUrl;i.featureManager.isFeatureEnabled(V.Hi)&&(i.logger.ULS.ke(590966791,C.X,y.Info,"HTTP2 preload enabled"),t=w(t)),i.preloader.preload(t,i.ui.language,i.logger,i.featureManager)}catch(t){i.logger.ULS.ke(590966792,C.X,y.Error,"Error preloading")}o.beforeContainerBoot&&o.beforeContainerBoot(i,R),i.container.boot(R,W,i.logger,o.buildContainerBootParams(i),(()=>{i.appInitDiagnostics.officeFrameCreateTime=N(),i.appBootState="FrameCreated"}),(()=>{i.appInitDiagnostics.officeFrameLoadTime=N(),i.logger.ULS.ke(506012820,C.X,y.Important,"Frame loaded"),"FrameCreated"===i.appBootState&&(i.appBootState="FrameLoaded",i.bootHeartBeat&&i.bootHeartBeat.setTimeoutStage(i.appBootState))}),(()=>{i.appInitDiagnostics.officeFrameErrorTime=N(),i.logger.ULS.ke(506012819,C.X,y.Error,"Frame error"),i.bootHeartBeat&&i.bootHeartBeat.setFrameError()})),_?T(Y.bs,{Diagnostics:{bootSuccessWithoutCompletionMessage:!0}}):(i.bootHeartBeat=new Oe(n(i.appBaseUrl),i.Ne,i.logger,(()=>{i.timeoutTime=N(),o.onTimeout&&o.onTimeout(i),O(i.remoteTelemetryUrl,i.application.name,"bootTimeout"),E({completion:"timeout",error:{documentLoadedWithTabSwitch:i.appInitDiagnostics.documentLoadedWithTabSwitch},timeoutStage:i.appBootState}),r&&r.cancel()}),r&&o.overrideBootTimeout?Math.min(r.timeoutInMs,o.overrideBootTimeout(i)):r?r.timeoutInMs:o.overrideBootTimeout?o.overrideBootTimeout(i):void 0),o.beforeBootCompletionMessage&&o.beforeBootCompletionMessage(i))})).catch((t=>{throw i.failureTime=N(),o.onException&&o.onException(i,t),i.remoteTelemetryUrl&&O(i.remoteTelemetryUrl,i.application.name,"bootException"),i.bootHeartBeat&&i.bootHeartBeat.stop(),{error:t.toString(),errorStack:t.stack}})),ni=(t,e,i)=>new Promise((e=>{i.logger.ULS.ke(590111070,C.X,y.Error,`Unsupported flow: ${t}`),e({completion:"failure"})})),ri=(t,e,i,s,o)=>t!==Q.createNew?Promise.reject("Wrong flow"):new Promise((n=>{const r={wopiPendingInitializeTime:N()},a=!!(s&&s.parallelizeStartSessionRequest&&s.buildStartSessionRequestParams)&&s.parallelizeStartSessionRequest(i);let c,h,d=!1,l=!1,u=!1,p=!1,m=!1,f=!1;if(lt()||s&&s.fallBackToSingleStepBootFlow&&s.fallBackToSingleStepBootFlow(i,e))return void function(){i.logger.ULS.ke(578074079,C.X,y.Info,"Waiting for WOPI info to start boot");const t=(t,n)=>{if(d)i.logger.ULS.ke(578074080,C.X,y.Warning,"completeCreateNew already called");else{if(d=!0,r.wopiPendingCompleteTime=N(),"failure"===n.state)return R(n.reason),i.state=b.Failed,void s({completion:"failure"});ai(n.newFile),i.run(Q.boot,{...e,wopi:n.wopi},o).then((t=>{s(t)}))}};i.addActionHandler(Q.completeCreateNew,t);const s=e=>{i.removeActionHandler(Q.completeCreateNew,t),n(e)};o&&o.subscribe((()=>{s({completion:"cancelled"})}))}();const w=(t,e)=>{d?i.logger.ULS.ke(587236372,C.X,y.Warning,"completeCreateNew already called"):(d=!0,r.wopiPendingCompleteTime=N(),"failure"!==e.state?(c=e.wopi,ti(c)?(i.wopi=c,i.logger.ULS.ke(587286030,C.X,y.Info,"WOPI info received. Access token: "+JSON.stringify({length:c.accessToken.length,expiry:c.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:a,wacFrameLoaded:l,wacCanAcceptStartSessionResponse:u})),!a||l&&!u?l&&T():S(),l&&i.container&&i.container.postMessage(tt.ir,void 0),ai(e.newFile)):g("InvalidWopiInfo")):g(e.reason))},g=t=>{R(t),l&&i.container&&i.container.postMessage(tt.tr,void 0)},S=()=>{i.logger.ULS.ke(587233056,C.X,y.Info,"Making parallelized StartSession request");const e=s.buildStartSessionRequestParams(i,t,c),o=ii(i,e.appPageName,e.queryParamsOverrides),n="access_token="+encodeURIComponent(c.accessToken)+"&access_token_ttl="+encodeURIComponent(c.expiry.toString());r.startSessionStartTime=N(),Bt(o,n,{"Content-Type":"application/x-www-form-urlencoded"},v)},v=t=>{const e=N();r.startSessionCompleteTime=e,i.logger.ULS.ke(587233057,C.X,y.Info,`StartSession request completed. Status code: ${t.status}, time: ${e}`),h={RequestStatus:t.status,ResponseText:t.responseText},l&&u?_():i.logger.ULS.ke(587233058,C.X,y.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:l,wacCanAcceptStartSessionResponse:u,wopiInfoSent:m,startSessionResponseSent:f}))},I=(t,e)=>{r.readyMessageReceiveTime=N(),i.container&&i.container.postMessage(tt.vn,void 0),l||(l=!0,u=e.CanAcceptStartSessionComplete,i.logger.ULS.ke(587321567,C.X,y.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:a,wacCanAcceptStartSessionResponse:u,startSessionResponseAvailable:!!h,wopiInfoAvailable:!!c})),d&&i.container&&i.container.postMessage(c?tt.ir:tt.tr,void 0),a&&u?_():T(),ft(i.appInitDiagnostics,e.Diagnostics))},_=()=>{f||m||!h||(200===h.RequestStatus?(f=!0,r.completeMessageCreateTime=N(),A(tt.Tn,{StartSessionResponse:h,Diagnostics:r},3)):T())},T=()=>{f||m||!c||(m=!0,r.completeMessageCreateTime=N(),s&&s.sendCreateNewWopiInfo?s.sendCreateNewWopiInfo(i):A(tt.yn,{WopiDetails:{WopiSrc:c.source,AccessToken:c.accessToken,AccessTokenTtl:c.expiry.toString()},Diagnostics:r},3))},A=(t,e,s)=>{const o=N();s<=0?i.logger.ULS.ke(587233165,C.X,y.Error,`Attempted to complete but no ack. Time: ${o}`):(i.logger.ULS.ke(587233166,C.X,y.Info,`Sending complete message. Retries left: ${s-1}, Time: ${o}`),r.completeMessageSendTime=o,i.container&&i.container.postMessage(t,e),window.setTimeout(E,1e3,t,e,s-1))},E=(t,e,s)=>{p||(i.logger.ULS.ke(587233167,C.X,y.Info,`Timeout session complete ack. Retries left: ${s}`),A(t,e,s))},P=(t,e)=>{p=!0},U=t=>{i.removeActionHandler(Q.completeCreateNew,w),i.removeActionHandler(Y.vs,I),i.removeActionHandler(Y.do,P),n(t)};function R(t){i.logger.ULS.ke(596444188,C.X,y.Warning,"Fail with reason: "+(t?JSON.stringify(t):"N/A"))}i.addActionHandler(Q.completeCreateNew,w),i.addActionHandler(Y.vs,I),i.addActionHandler(Y.do,P),o&&o.subscribe((()=>{U({completion:"cancelled"})})),i.skipWopiValidation=!0,i.skipFileNameCheck=!0,i.wopi=void 0,i.run(Q.boot,e,o).then((t=>{i.skipWopiValidation=!1,i.wopi=c,U(t)}))}));function ai(t){t&&(t.path&&history.replaceState({},"",t.path),t.title&&(document.title=t.title))}class ci{get isCancelled(){return this.Vd}get timeoutInMs(){return this.Bd}get reason(){return this.Ld}cancel(){this.Jd(!1)}subscribe(t){this.Vd?t():this.Gd.push(t)}constructor(t){this.Vd=!1,this.Ld="",this.Gd=[],this.Jd=t=>{this.Vd||(this.Vd=!0,this.Ld=t?"timeout":"cancelled",this.Gd.map((t=>t())),this.Gd=[])},this.Bd=t,window.setTimeout((()=>this.Jd(!0)),t)}}function hi(t){return new ci(t)}const di=(t,e,i,s,o)=>t!==Q.dispose?Promise.reject("Wrong flow"):new Promise((t=>{i.logger.ULS.ke(595714433,C.X,y.Important,"start disposing the application");const n=i.host.requireExplicitUnload,r={disposeStartTime:N(),forceAppUnload:n};i.state=b.Disposing;const a=()=>{i.state=b.Disposed,t({completion:"success"})},c=t=>{s&&s.disposeAppSpecificResources&&s.disposeAppSpecificResources(i,e),i.dispose(),r.disposeEndTime=N(),function(t,e,i){if(i){const t=Number(i.hostMessageReceived);e.appUnloadStartTime&&!isNaN(t)&&(e.hostToAppPostMessageLatency=t-e.appUnloadStartTime);const s=Number(i.appMessageSent);!isNaN(s)&&e.appUnloadEndTime&&(e.appToHostPostMessageLatency=e.appUnloadEndTime-s);const o=Number(i.appUnloadStart),n=Number(i.appUnloadEnd);if(isNaN(o)||isNaN(n)||(e.appUnloadLatency=n-o),i.serverTimings){const t=i.serverTimings;for(const i in t)e["st-"+i.toString()]=t[i]}}t.logger.ULS.ke(592524822,C.X,y.Info,"App disposed: "+JSON.stringify(e)),t.logger.ULS.flushOnClose()}(i,r,t),i.container?i.container.dispose(i.pendingReboot,n).then(a):a()};if(n){r.appUnloadStartTime=N();const t=(t,e)=>{r.appUnloadEndTime=N(),c(e)};i.addActionHandler(Y.wo,t),(o||new ci(5e3)).subscribe((()=>{i.state===b.Disposing&&(r.appUnloadTimedOut=!0,c())})),i.container&&i.container.postMessage(tt.nr,void 0)}else c()})),li=(t,e,i,s,o)=>t!==Y.Ds?Promise.reject("Wrong flow"):new Promise((t=>{if(i.host.capabilities&&i.host.capabilities.frameTrustCheck)i.raiseEvent(et.FrameTrust,e);else{const t=!!i.container&&i.container.isTopFrameTrusted;i.logger.ULS.ke(592445957,C.X,y.Info,`Top frame is trusted: ${t}`),i.container&&i.container.postMessage(tt.Ds,{isTopFrameTrusted:t})}t({completion:"success"})})),ui=(t,e,i,s,o)=>t!==Y.Bs?Promise.reject("Wrong flow"):new Promise((t=>{i.authTokenTrustValidator.isResourceTrustedForMessage(e).then((s=>{s?i.raiseEvent(et.GetAuthToken,e):(i.container.postMessage(tt.Jn,{AuthToken:"",Error:"accessDenied",RequestId:e.RequestId,IdentityType:e.IdentityType}),t({completion:"success"}))}),(s=>{i.container.postMessage(tt.Jn,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:e.RequestId,IdentityType:e.IdentityType}),t({completion:"failure",error:s})}))})),pi=(t,e,i,s,o)=>t!==Y._s?Promise.reject("Wrong flow"):new Promise((t=>{const o=e&&e.state?e.state:"Unknown";i.logger.ULS.ke(592839750,C.X,y.Info,`Boot state: [${o}]`),o!==i.appBootState&&(i.appBootState=o,i.bootHeartBeat&&i.bootHeartBeat.setTimeoutStage(o)),s&&s.beforeComplete&&s.beforeComplete(o),t({completion:"success"})})),mi=(t,e,i,s,o)=>{if(t!==Q.postWacToken)return Promise.reject("Wrong flow");const n=k();return i.logger.ULS.ke(507774685,C.X,y.Important,"postWacToken flow initiated"),new Promise((t=>{const s=(t,e)=>{i.logger.ULS.ke(507597017,C.X,y.Info,`postWacToken flow completed in ${k()-n} ms`),window.clearInterval(a),window.clearTimeout(c);const s={completion:"success"};e&&void 0!==e.TokenAlreadySet&&(s.data={TokenAlreadySet:e.TokenAlreadySet}),o(s)},o=e=>{i.removeActionHandler(Y.hn,s),t(e)},r=()=>i.container?.postMessage(tt.wr,e);i.addActionHandler(Y.hn,s),r();const a=window.setInterval(r,100),c=window.setTimeout((()=>{window.clearInterval(a),i.logger.ULS.ke(507844190,C.X,y.Warning,"postWacToken flow timed out after 60000 milliseconds"),o({completion:"timeout"})}),6e4)}))},fi=(t,e,i,s,o)=>t!==Q.rename?Promise.reject("Wrong flow"):new Promise((t=>{const s=(t,i)=>{const s={completion:i.NewName===e.NewName?"success":"failure"};r(s)},n=(t,e)=>{r({completion:"failure"})},r=e=>{i.removeActionHandler(Y.Ns,s),i.removeActionHandler(Y.xs,n),t(e)};i.addActionHandler(Y.Ns,s),i.addActionHandler(Y.xs,n),(o||new ci(5e3)).subscribe((()=>{r({completion:"cancelled"})})),i.container&&i.container.postMessage(tt.Bn,e)})),wi=(t,e,i,s,o)=>t!==Q.switchMode?Promise.reject("Wrong flow"):new Promise((t=>{const s=(t,e)=>{n({completion:"success"})},n=e=>{i.removeActionHandler(Y.js,s),t(e)};i.addActionHandler(Y.js,s),(o||new ci(5e3)).subscribe((()=>{n({completion:"cancelled"})})),i.container&&i.container.postMessage(tt.sr,e)}));function gi(t){const e=t.appContext;e.canSupportInteractiveReadOnly=!1,e.isUnifiedRead=!1}function Si(t){const e=t.Ne.getValue(D.Ai,!1);let i=!1;i=e?we(t.appUrl,e):t.appBaseUrl.indexOf(ae)>-1;const s=t.rebootOverride;if(s){let o=s.mode;o&&(o=o.toLowerCase(),"view"===o&&i?(t.appBaseUrl=Se(t.appBaseUrl),e&&(t.appUrl=Se(t.appUrl))):"edit"!==o||i||(t.appBaseUrl=ve(t.appBaseUrl),e&&(t.appUrl=ve(t.appUrl))))}else{const s=!!t.Ne.getValue(D.Ui,!1),o=!(!t.ui||!t.ui.uiEmbed),n=!(!t.hostName||"OfficeDotCom"!==t.hostName),r=o&&!(!t.bootParams||!t.bootParams.readOnly),a=g(t.appUrl,"embed"),c=!(!t.wdParams||"1"!==t.wdParams.wdembedfs),h=!(!t.bootParams||!t.bootParams.isNewFile||t.wopi),d=!(!t.file||"docx"!==L(t.file.name)),l=!(!t.wdParams||"1"!==t.wdParams.wdreadingview),u=t.Ne.getValue(D.Ri,!1)?t.host?.uiHostName||p(t.appUrl,"uih"):void 0,m=Ie(t.wdParams?.wdmobile,u,t.Ne),f=t.Ne.getValue(D.Wi,!1),w=!a&&(h||d)&&(s&&o&&n||!o||f&&m)&&!c&&!l;t.appContext.canSupportInteractiveReadOnly=!!w;const S=t.Ne.getValue(D.Ei,!1),v=t.featureManager.isFeatureEnabled(V.Zi);if((v||S||f&&m)&&w&&!i)t.appBaseUrl=ve(t.appBaseUrl),e&&(t.appUrl=ve(t.appUrl)),t.appContext.isUnifiedRead=!0,t.appContext.isMobileView=m&&f,t.logger.ULS.ke(559285716,C.X,y.Important,"Redirecting Viewer request to unified read");else{if(!i){const e={canSupportInteractiveReadOnly:{canSupportInteractiveReadOnlyValue:w,isEmbedActionApplicationUrl:a,isUiEmbed:o,isUiEmbedReadOnly:r,isEmbeddedFullScreen:c,isCreateNewWithoutWopiInfo:h,isFileDocx:d,isReadingViewMode:l},interactiveReadOnlyFlightValue:v,interactiveReadOnlySettingValue:S,isMobileModeRequested:m,isMobileModeSettingEnabled:f,uiHost:u};t.logger.ULS.ke(505996416,C.X,y.Important,`Interactive Read Only redirection will not happen. DebugInfo: ${JSON.stringify(e)}`)}i&&!r||t.raiseEvent(et.ModeSwitched,{NewMode:"view"}),i&&r&&(t.appBaseUrl=Se(t.appBaseUrl),e&&(t.appUrl=Se(t.appUrl)))}}return i=e?we(t.appUrl):t.appBaseUrl.indexOf(ae)>-1,t.appBaseUrl+(i?ce:pe)}function vi(t){return e=t.appBasePath,i=t.sessionId,e+o+(i?"?usid="+i:"");var e,i}function Ii(t){if(t.Ne.getValue(D.pi,!1))try{if(t.hostInitDiagnostics&&t.hostInitDiagnostics.hostPageNavigationType&&window&&window.localStorage)if(t.file?.uniqueId){const e="sessionRefresh_"+t.file.uniqueId;if("RELOAD"===t.hostInitDiagnostics.hostPageNavigationType){const i=window.localStorage.getItem(e);null!=i&&(t.logger.ULS.ke(507352900,C.X,y.Warning,"sessionRefreshDiagnostics: "+i),window.localStorage.removeItem(e));const s={previousSessionId:t.sessionId,navigationType:t.hostInitDiagnostics.hostPageNavigationType};window.localStorage.setItem(e,JSON.stringify(s))}else{window.localStorage.removeItem(e);const i={previousSessionId:t.sessionId,navigationType:t.hostInitDiagnostics.hostPageNavigationType};window.localStorage.setItem(e,JSON.stringify(i))}}else t.logger.ULS.ke(507274849,C.X,y.Warning,"No fileId provided");else t.logger.ULS.ke(507274848,C.X,y.Warning,"hostPageNavigationType not available")}catch(e){t.logger.ULS.ke(507340190,C.X,y.Warning,"Error Thrown during logSessionRefreshDiagnostics with error "+e)}}function _i(t,e,i){const s=t.Ne.getValue(D.Ai,!1);let o=!1;o=s?we(t.appUrl,s):t.appBaseUrl.indexOf(ae)>-1;const n=o?e===Q.createNew?le:he:me,r={},a=t.viewMode;a&&(a.hideToolbar&&l(r,o?"hvt":"core","1"),a.hideBreadCrumb&&l(r,"hbcv","1"),a.hideTitle&&l(r,"htv","1"),a.disableFocusOnBoot&&l(r,"disablefocusonboot","1"),a.forceAccessibilityMode&&!a.hideToolbar&&l(r,"wdaccpdf","1"));const c=t.ui;c&&(c.inAppDocPreview&&l(r,"inappdocpreview","1"),c.hideRibbon&&l(r,"hrbn","1"),c.hideInAppBizChat&&l(r,"hiabc","1"));const d=t.wopi,p=t.bootParams;return o&&(d?(t.appContext.canSupportInteractiveReadOnly&&(l(r,"csiro","1"),t.appContext.isMobileView&&(l(r,"mobile","1"),l(r,"hhdr","1"))),p&&p.isNewFile||(t.appContext.isUnifiedRead?(l(r,"iro","1"),l(r,"readonly","1"),p?.readOnly&&l(r,"mode","Read")):l(r,"instantedit","1"),l(r,"wopicomplete","1"))):(l(r,"instantedit","1"),l(r,"filesrc",encodeURIComponent(t.hostName)),l(r,"pmorigin",encodeURIComponent(h(window.location.href)))),e===Q.createNew&&(u(r,"newsession"),l(r,"build",encodeURIComponent(U())),l(r,"wacusertype","WOPI"),t.file.getUrl&&l(r,"filegeturlpresent","1"),i&&l(r,"wopisrc",encodeURIComponent(i.source)))),d&&l(r,"wdredirectionreason",function(t,e,i,s){return t?"Unified_SingleFlush":e?"Unified_IrmEnabled":i&&s?"Unified_UiEmbedReadOnly":"Unified_ViewActionUrl"}(o,!(!p||!p.irmEnabled),!(!c||!c.uiEmbed),!(!p||!p.readOnly))),{appPageName:n,queryParamsOverrides:r,postDataOverrides:{}}}function bi(t,e,i,s,o){if(!t.Ne.getValue(D.di,!1))return;const n=function(t,e,i,s,o){const n=function(t){const e=function(t){if(!t)return{AppMode:"Unknown",AppModeExtended:"Unknown"};const e=t.appUrl,i=t.Ne.getValue(D.Ai,!1);let s=!1;s=i?we(t.appUrl,i):t.appBaseUrl.indexOf(ae)>-1;const o=t.appContext.isUnifiedRead,n=t.appContext.isMobileView,r=t.bootParams?.isNewFile?t.bootParams.isNewFile:g(e,"new"),a=g(t.appUrl,"embed"),c=!!t.wdParams&&"1"===t.wdParams.wdnc;return s?r?{AppMode:"Edit",AppModeExtended:"EDIT_NEW"}:n?{AppMode:"Unified",AppModeExtended:"MOBILE_VIEW"}:o?{AppMode:"Unified",AppModeExtended:"COLLAB_VIEW"}:{AppMode:"Unified",AppModeExtended:"UNIFIED_EDIT"}:a?{AppMode:"View",AppModeExtended:"EMBED_VIEW"}:c?{AppMode:"View",AppModeExtended:"CHROMELESS_VIEW"}:{AppMode:"View",AppModeExtended:"VIEW"}}(t);let i=vt(t.hostName)||t.wopi?.source&&vt(t.wopi?.source)?"SharePoint Online":t.wopi?.source&&function(t){return/\.microsoftpersonalcontent(ppe)?\./i.test(t)}(t.wopi?.source)?"SharePoint Online Consumer":t.host.storageHostName;"OneDrive"===i&&(i="OneDriveWOPI");let s=function(t){return t?t.indexOf("iPhone")>=0||t.indexOf("iPad")>=0?"iOS":t.indexOf("Mac OS X")>=0?"Mac OS X":t.indexOf("Android")>=0?"Android":t.indexOf("Ubuntu")>=0?"Ubuntu":t.indexOf("CrOS")>=0?"Chrome OS":t.indexOf("Fedora")>=0?"Fedora":t.indexOf("Windows")>=0?"Windows":t.indexOf("Linux")>=0?"Linux":"Unknown":"Unknown"}(navigator.userAgent);return{a:t.appInfo.name||"Unknown",b:t.ui.language||"Unknown",c:e.AppMode||"Unknown",d:e.AppModeExtended||"Unknown",e:"",f:t.clientDiagnostics.browser||"Unknown",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:i||"Unknown",o:!1,p:t.user.isLicensed||!1,q:!1,r:t.user.isSynthetic||!1,s:t.ownerId||t.user.id||"Unknown",t:t.tenantId||"Unknown",u:(t.wdParams?.wdjs?.length??0)>0?"-5":"",v:"",w:t.sessionId||"Unknown",x:t.hostInitDiagnostics?.entryPoint||"Unknown",y:t.tenantId||"Unknown",z:t.host.uiHostName||"Unknown",aa:t.appInitDiagnostics?.officeServerVersion||"Unknown",ab:t.file?.name?L(t.file?.name):"Unknown",ac:t.host.uiHostIntegrationType||"Unknown",ad:s,ae:!1,af:t.clientDiagnostics.netDownlink,ag:t.clientDiagnostics.netDownlinkMax,ah:t.clientDiagnostics.netEffectiveType||"Unknown",ai:t.clientDiagnostics.netRtt,aj:t.clientDiagnostics.netSaveData,ak:t.clientDiagnostics.netType||"Unknown",al:""}}(t),r=function(t,e,i,s,o,n,r,a){const c={AreaName:"Boot",FeatureName:"JSAPI",SkipAria:"True"};n&&!isNaN(Number(n))&&(c.BsqmErrorCode=n);return{n:"Boot",e:s,t:yi.FailureBased,a:!0,f:"wordwebsxfc",k:n?{n}:void 0,p:{...c,...r},d:a?Math.round(a):void 0}}(0,0,0,e,0,i,s,o),c={},h=t.appBaseUrl?a(t.appBaseUrl)?.toUpperCase():void 0;h&&(c.ComplianceRegion=h);const d=function(t){if(!t)return;const e=Ci.exec(t);return e&&e.length>1?e[1]:void 0}(t.wopi?.source);return d&&(c.HostDatacenterHint=d),{d:n,k:[r],a:c}}(t,e,i,s,o);F(t.remoteTelemetryUrl,R.H_V2,n)}const Ci=new RegExp("^[a-z+.-]+://([^/:]*(:[0-9]{1,5})?)","i");var Ti,yi;function Ai(t){let e=0;try{const t=Object.keys(window.localStorage).filter((t=>t.startsWith("sessionRefresh_")));if(t.length>0)for(let i=0;i<t.length;i++){const s=t[i];window.localStorage.removeItem(s),e++}}catch(e){t.logger.ULS.ke(506819588,C.X,y.Warning,"Error Thrown during deleteAllSessionRefreshEntries with error "+e)}return e}!function(t){t[t.Failure=0]="Failure",t[t.ImpliedUsageFailure=1]="ImpliedUsageFailure",t[t.ImpliedUsageSuccess=2]="ImpliedUsageSuccess",t[t.Success=3]="Success",t[t.Usage=4]="Usage"}(Ti||(Ti={})),function(t){t[t.FailureBased=0]="FailureBased",t[t.SuccessBased=1]="SuccessBased"}(yi||(yi={}));let Ei,Pi;function Ui(t){const e=t.hostInitDiagnostics?.hostInitializeCallTime?t.successTime-t.hostInitDiagnostics?.hostInitializeCallTime:0;bi(t,Ti.Success,void 0,void 0,e);const i=t.Ne.getValue(D.pi,!1),s=t.Ne.getValue(D.Ti,!1);if(i&&function(t,e){try{if(function(t){const e="refreshTelemExpiry",i=864e5*t.Ne.getValue(D.yi,30);let s=0;try{const o=window.localStorage.getItem(e);null!=o?Date.now()-parseInt(o,10)>=i&&(s=Ai(t),window.localStorage.setItem(e,Date.now().toString())):window.localStorage.setItem(e,Date.now().toString())}catch(e){t.logger.ULS.ke(506819589,C.X,y.Warning,"Error Thrown during checkSessionRefreshExpiry with error "+e)}}(t),window.localStorage&&t.file?.uniqueId){const i="sessionRefresh_"+t.file?.uniqueId,s=window.localStorage.getItem(i);if(s){const t=JSON.parse(s);t.success=e,window.localStorage.setItem(i,JSON.stringify(t))}}}catch(e){t.logger.ULS.ke(506855459,C.X,y.Warning,"Error Thrown during markSessionAsSuccesful with error "+e)}}(t,e),s&&(Ai(t),function(t){try{window.localStorage.removeItem("refreshTelemExpiry")}catch(e){t.logger.ULS.ke(506819587,C.X,y.Warning,"Error Thrown during deleteRefreshTelemExpiryEntry with error "+e)}}(t)),Ri(),!Pi)return;t.container&&t.container.postMessage(tt.Pn,{HostCacheLoadTime:Pi});const o=t.appInitDiagnostics;o.documentLoadedTime?Pi<o.documentLoadedTime?(o.documentLoadedTime=Pi,o.documentLoadedFromWopiPrecheckInfo=!0,t.logger.ULS.ke(577843782,C.X,y.Info,"First page loaded from cache was faster")):o.documentLoadedFromWopiPrecheckInfo=!1:o.documentLoadedTime=Pi}function Ri(){Ei&&Ei.parentElement&&Ei.parentElement.removeChild(Ei)}function Wi(t,e){!function(t,e){const i={storageHost:t.host.storageHostName||"",uiHost:t.host.uiHostName||p(e,"uih"),wdOrigin:t.hostInitDiagnostics.entryPoint||p(e,"wdorigin")};t.logger.ULS.ke(561629318,C.X,y.Info,JSON.stringify(i))}(t,e),function(t){const e=t.Ne.getValue(D.Ai,!1);let i=!1;if(i=e?we(t.appUrl,e):t.appBaseUrl.indexOf(ae)>-1,i)return;t.logger.ULS.ke(577843778,C.X,y.Info,"Boot Word viewer");const s=window.navigator.userAgent;if(s.indexOf("Mobi")>=0&&s.indexOf("iPad")<0)return;const o=t.rebootOverride;if(o&&o.reason&&"translate"===o.reason.toLowerCase())return;const n=t.viewMode;if(n&&n.forceAccessibilityMode)return;const r=t.contentBundle;if(!r||!r.url)return;const a=t.container;if(!a)return;const c=a.element,h=c.ownerDocument;if(!h)return;t.logger.ULS.ke(577843779,C.X,y.Info,"Kick off first page optimization"),Ei=h.createElement("div"),Ei.id="FirstPageContainer",Ei.style.top=n&&n.hideToolbar?"0":"90px",Ei.style.left="0",Ei.style.textAlign="center",Ei.style.width="1px",Ei.style.bottom="0",Ei.style.zIndex="900",Ei.style.height="1px",Ei.style.position="absolute",Ei.style.padding="0 29px",Ei.style.right="0",Ei.style.overflow="auto",Ei.style.marginLeft="auto",Ei.style.marginRight="auto",Ei.style.maxWidth="100%",c.appendChild(Ei);const d=h.createElement("img");d.id="FirstPageImage",d.style.marginTop="11px",d.style.marginBottom="11px",d.style.maxWidth="100%",d.style.border="solid 1px #d2d5d8",d.draggable=!1,d.onload=()=>{t.logger.ULS.ke(577843780,C.X,y.Info,"First page optimization loaded"),Ei.style.width="",Ei.style.height="",Pi=N()},d.onerror=e=>{Ri(),t.logger.ULS.ke(577843781,C.X,y.Warning,"Cannot load first page from cache"),t.appInitDiagnostics.errorObject={errorType:"CannotLoadFirstPage",errorObject:"string"==typeof e?e:e.returnValue}},d.src=r.url.replace("{0}","p1.img"),Ei.appendChild(d)}(t),bi(t,Ti.Usage)}function Fi(t){let e=t.appBaseUrl;const i=t.Ne.getValue(D.Ai,!1);let s=!1;s=i?we(t.appUrl,i):t.appBaseUrl.indexOf(ae)>-1;const o=at()===ot.Firefox&&"OneDrive"===t.hostName&&t.host.origin&&"https://onedrive.live.com"===t.host.origin.toLowerCase();return s&&o&&(e+=" "+(t.host.origin&&t.host.origin.toLowerCase())),{permissionsPolicy:`microphone ${e}; autoplay ${t.appBaseUrl}; camera ${t.appBaseUrl}; clipboard-read ${t.appBaseUrl}; clipboard-write ${t.appBaseUrl}; keyboard-map ${t.appBaseUrl}; display-capture ${t.appBaseUrl}; local-network-access ${t.appBaseUrl}`}}function Oi(t){return!(!t||void 0===t.indexOf||!(t.indexOf("Failed to load resource")>-1||t.indexOf("Resource failed to load")>-1))}function Mi(t,e){const i={WacFailed:"True"};e.errorObject&&(i.ErrorObject=J(e.errorObject));const s=t.hostInitDiagnostics?.hostInitializeCallTime?t.failureTime-t.hostInitDiagnostics?.hostInitializeCallTime:0;let o=function(t){const e=t;let i="JsApiUnknownError";return void 0!==t.errorObject&&null!==t.errorObject&&void 0!==t.errorObject.errorCode?i=t.errorObject.errorCode:e.errorCode?i=e.errorCode:void 0!==t.errorObject&&null!==t.errorObject&&void 0!==t.errorObject.errorType?i=t.errorObject.errorType:t.errorType?i=Oi(t.errorObject)?"JsApiResourceLoadError":t.errorType:Oi(e)&&(i="JsApiResourceLoadError"),i}(e);bi(t,Ti.Failure,o,i,s),t.Ne.getValue(D.pi,!1)&&function(t,e){try{if(window.localStorage&&t.file?.uniqueId){const i="sessionRefresh_"+t.file?.uniqueId,s=window.localStorage.getItem(i);if(s){const t=JSON.parse(s);t.failureInfo=e,window.localStorage.setItem(i,JSON.stringify(t))}}}catch(e){t.logger.ULS.ke(507340189,C.X,y.Warning,"Error Thrown during logSessionRefreshFailure with error "+e)}}(t,o)}function ki(t){const e=t.hostInitDiagnostics?.hostInitializeCallTime?t.timeoutTime-t.hostInitDiagnostics.hostInitializeCallTime:0;bi(t,Ti.Failure,"JsApiTimeout",{TimeoutTime:e},e),t.Ne.getValue(D.pi,!1)&&function(t,e){try{if(window.localStorage&&t.file?.uniqueId){const i="sessionRefresh_"+t.file?.uniqueId,s=window.localStorage.getItem(i);if(s){const t=JSON.parse(s);t.timeout=e,window.localStorage.setItem(i,JSON.stringify(t))}}}catch(e){t.logger.ULS.ke(507274847,C.X,y.Warning,"Error Thrown during logSessionTimeout with error "+e)}}(t,e)}function Ni(t,e){const i=e instanceof Error?e.name:"JsApiException",s={ErrorObject:J(e)};e instanceof Error&&(s.ErrorMessage=e.message);const o=t.hostInitDiagnostics?.hostInitializeCallTime?t.failureTime-t.hostInitDiagnostics?.hostInitializeCallTime:0;bi(t,Ti.Failure,i,s,o)}function xi(){return!0}const $i=()=>[{[X.appReboot]:Ye,[X.boot]:oi,[X.closeTab]:ni,[X.createNew]:ri,[X.dispose]:di,[X.frameTrust]:li,[X.getAuthToken]:ui,[X.getHostKeyValue]:He,[X.handleBootState]:pi,[X.postWacToken]:mi,[X.rename]:fi,[X.setOverlayContent]:xe,[X.setWacFlightValue]:ke,[X.storeHostKeyValue]:Ve,[X.switchMode]:wi,[X.updateBootComplete]:ni},{[X.boot]:{initializeAppContext:gi,buildAppBasePath:Si,buildRemoteTelemetryUrl:vi,onContextReady:Ii,buildBootRequestParams:_i,beforeContainerBoot:Wi,buildContainerBootParams:Fi,onSuccess:Ui,onFailure:Mi,onTimeout:ki,onException:Ni},[X.createNew]:{parallelizeStartSessionRequest:xi,buildStartSessionRequestParams:_i}}];var Hi;!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(Hi||(Hi={}));const Di=new ze((function(t,e,i,s,o){return new Xe(t,e,i,s,o)}),{forceSingleStepBoot:!1,preconnector:I(!0)}),Vi=new ze((function(t,e,i,s,o){return new Qe(t,e,i,s,o)}),{forceSingleStepBoot:!0,useViewerInitializer:!0,preconnector:I(!0)}),Bi=t=>{const e={name:"Word",preconnector:I(!0)};return new Vt(t,e,$i)};((Microsoft=void 0===Microsoft?{}:Microsoft).Office=Microsoft.Office||{}).Word=e}();
//# sourceMappingURL=word.boot.2037fcb152e0e3f104c0.js.map